<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">
  <meta name="google-site-verification" content="lk2gSYFP_NyLNFob-fFnt7fm-I_n1ZYws-WZll7mshg">
  <meta name="msvalidate.01" content="6Jdc01DjYOLguhS5">
  <meta name="baidu-site-verification" content="code-NR10G09zww">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7Ccursive:300,300italic,400,400italic,700,700italic%7CSource+Code+Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/yellow/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.fudenglong.site","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":true,"height":800},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"stickytabs":true,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/local-search.xml","localsearch":{"enable":true,"top_n_per_article":10,"unescape":false,"preload":true,"trigger":"auto"}}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/config.min.js"></script>

    <meta name="description" content="本文介绍23设计模式使用场景及其示例。  创建型设计模式 创建型设计模式主要用于对象的创建过程，旨在将对象的创建和使用分离，使得代码在创建对象时更加灵活、可维护且可复用。它关注的是对象创建的机制，通过隐藏对象创建的具体细节，提供了一种创建对象的统一方式，以满足不同场景下的需求。  单例模式 单例模式适用于整个系统只有一个实例的场景，比如数据库连接池、线程池、系统配置信息管理等。确保在任何时候只有一">
<meta property="og:type" content="article">
<meta property="og:title" content="设计模式及其示例">
<meta property="og:url" content="https://blog.fudenglong.site/2024/11/19/Design-Patterns/example-design-patterns/index.html">
<meta property="og:site_name" content="MichaelFu">
<meta property="og:description" content="本文介绍23设计模式使用场景及其示例。  创建型设计模式 创建型设计模式主要用于对象的创建过程，旨在将对象的创建和使用分离，使得代码在创建对象时更加灵活、可维护且可复用。它关注的是对象创建的机制，通过隐藏对象创建的具体细节，提供了一种创建对象的统一方式，以满足不同场景下的需求。  单例模式 单例模式适用于整个系统只有一个实例的场景，比如数据库连接池、线程池、系统配置信息管理等。确保在任何时候只有一">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.fudenglong.site/2024/11/19/Design-Patterns/example-design-patterns/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F.png">
<meta property="og:image" content="https://blog.fudenglong.site/2024/11/19/Design-Patterns/example-design-patterns/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82.png">
<meta property="og:image" content="https://blog.fudenglong.site/2024/11/19/Design-Patterns/example-design-patterns/%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F.png">
<meta property="og:image" content="https://blog.fudenglong.site/2024/11/19/Design-Patterns/example-design-patterns/%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F.png">
<meta property="og:image" content="https://www.plantuml.com/plantuml/png/SoWkIImgAStDuL9NU3vxtRC5xS_wbZxjNyoLcLUIMfIMc9og499Ob9vQeb3DfG04HQc5fQd59HgQ2bOAmIL5cNdfNBL0hIyMhNxPqFIojVT5GojNSavYSR62OqfYGKbgAbIVTd51Qd9cMcPoFDG4k7uqQHmMG4n_EdC5Ykb5CDCJePPPmQo526Cr36ZQqzRDppVlve8QegTNOmVr9L3TqtNpdlTjWCafwEhQmRrY1TBued7A-pqTSFSyxMbzEc4ril-11ZpPr_r-JoUNGsfU2Z1e0G00">
<meta property="og:image" content="https://blog.fudenglong.site/2024/11/19/Design-Patterns/example-design-patterns/bridge.png">
<meta property="og:image" content="https://www.plantuml.com/plantuml/png/SoWkIImgAStDuL9NUDQrzyN6XI-RLppjQ7k_PzRJlOkUTsrxrhVqQVzYhioyajIYjCJaL8NWZCI2L8LgBWKWI2bABDVGvAe5QdxQklt9tiaGFK_NpNlUjm5an9mse0XNSavYSR62SsPHSWvCftPHQbvAQb5gaPL249G54ITavFFvA-560hKcboJcfPDaAiGak2-VxTZqRFxafpDNe7iKRWBKR8ZHySbWNsXe8eiLmPo1ud2uoN2t-nUavhdxmCMXde28ejccZSqwRHBj2olDoKxCGxSF8ag-VM0BDp_Vl9iB4gDwUZLsq5HX1GrTBcZ4O9T4zJ1O1Oo3K0Hn9G55q2IbguigsRhvHUEKztiw8CdlQK_hqmchaKFdoRxkztiwOOx4Om0miU4pm06e1PXr0000">
<meta property="og:image" content="https://www.plantuml.com/plantuml/png/SoWkIImgAStDuL9NUDQrzyN6XSztjppPlUrPtzAd_OkvClDAKelI4fDJ5PppSmloyrBpIXIgkHI08ByWjIYn93C_JqEJgnQe-Md_jgTh9xpeQdhUjFFzdbdFfhK3JU5ApaaiBbPmoyn9XMhJpalCJRLI22ufoinBXuYWcmHqmDC97MWcFLso4sPOVavAQX5kuv8pCdDIYbBph11EZex5PXF8qQsRds_UpGLodvvUZHsI9wqKdgwRzxnl0nV4Eloo2bgwkiYoK2-ytzC1T_pJdjQd4rP3mXQezyc-xcTJDm2vx_VqFDax6MZKo-OLJplQ57GLdatT0XI1kEpzdaukXzIy563y0000">
<meta property="og:image" content="https://www.plantuml.com/plantuml/png/SoWkIImgAStDuL9NUDQrzyN6XSztjppPlUrPtzAd_OkvClDAKelI4fDJ5PppSmloyrBpIXIgkHI08BKYDRcq95L3awiMgFLfw_OdUoT3j78bvoGM5olufPQKvnTb1wKMbgOMmtHfbnRbM2a4bnHbvgL3179JIpBoKr35aCo6E-l5ujQNIpSydRa2oKqkgSdvHOab-KLGqzDJI-AJOUxKqBH2E1gda-76ljypwzdstK-x5ZpVC_dfsXbFk-Q_QDuBzOfpOd86q77ercd3xKAo2Ie3r95gfU2HM9pXcrXW0_6S3jIJTX0r15ohJPnpdqrV-dJ_z1VhDZpTEnN5qJxvwUd4Effq1u5TjFdvvjrSgF6ifrTZXvHMh1IUhfltl6y35teGubA7xcgIp8FpqCqZh0uZYdLrqUnjtVoYSShxFHtmA7ZMq_XiJkUBHQkX8kjt0fCfqBWd-xhVx-a4sqnT4nrIyrA0EHK0">
<meta property="og:image" content="https://www.plantuml.com/plantuml/png/XL8_IyD05D_pAR9PaGwsMmOf2EBWLlTmDgzj99UJkyjGn46XqAAK3YB5GHUnY5ZGWeWjVXglgLE_Wg-cqUHgIRPxx-Ntv_TUIKZ2PK0zOyrKJzrmE0f7jvkpyNNOx4zwdUXjL3mYXBddrkhIzMlbXf10pMF3n6_35JRpBVE0CIygo83xMCgj9v_LAhvFaYG599cyFQZt-qcdhrglAQfze4V02VuBsyoNd7bfqah0EVZIbdzpbbaj5XQKXDTWLLDWPtaW5vL-vXR2YNCOYDIGRg685jIW_TLxIOal0yfpPMCf9y8fECcei137vBW2Np73tTMqVnO-Zs94YalQPHHsI8Ku44DwYuLOscgYRjB-oa3ZJ2B5bgOzjL2xZW9ioXpGLvlieFwvWUOG8p5qtVdybdv5rdnsUdev6xT-NQkBfke-9YzG3Mu-Fyvdu_Q_aClcCi6roykaY7F918xkGOSiWUy4rFi6">
<meta property="og:image" content="https://www.plantuml.com/plantuml/png/ZP9T2z9G6CVlpwSuTzdB_00IuatMJLTz03cieuxcbEr8IGcPpLR8b58l9eGMWY1OCi5yiRwCppQl_0eT7NCw2ThLTixpxFTx_ZmfZH6LbGiokeDtgmdeTVYnz6P3rthlVDho5ySSGUixaXH6rImHAKxBbPTKokKPVeqmVuebgX8c5PKOVSLKIT4aCQCnmcW2Fpj-v-wYAlyvw8lTziibuh2neFyRjj_uYJiV-5T8b8ccuSSgAUKbyP5C2rHXKUJzaur2v6kGV_T_Fi6mYn6OxmwRfjiPxrOc67rOh-1pqvqEtNRZqjQP3NotC80q4LbHhGHIsU1SI-0dHCi_9QM7Fl51s9FqQtEKPSxriHUqSfR3YR0OLT4fETkrr-WVaSJZRv9X1--6wLVN_8bkB0KXKgVRNgrps1YNITpEpRFPlxMyFnyySm6jdjDREdOtwFruYxad25SOhsP1suXWeAb3UnA9bvFuXd1tfpi_hielSryVWz7mvp_2KbHvNYx8Vm40">
<meta property="og:image" content="https://www.plantuml.com/plantuml/png/SoWkIImgAStDuL9NUDQrzyN6XK-Nj3oVqFQYePKhCwyajIWjCJbLmICnBoKdjKYXcai128fJI-BpKYjAD38WmbOmUKsmD4GqlYYri3Irk4G3Ibif19SKPUQbQtBL0grwshhzoTx9SAiSkP9p4ekB5PppyvABKajIeUOvGYtK1jaMZsuRH8g0OxJ9S8qJTjSuqSKrOETiVhvvDnTwOEZfrTZ1Oy9AuUcwUS_xDg2hSY9AbQE2hYwIAf2DBngdlD_JWHulJtjQdqvO_MH7zvCT3Kzsh89B08rzig_x_PvE3Fk9DDc9iCaEgNafm8G90000">
<meta property="og:image" content="https://www.plantuml.com/plantuml/png/fP0nImGn48Nx_HNXgbN9WUrnBAU7dN1YAnRhPgA1P4QIMJrG2pjBQ_-VuCymRBAicqguT7bltiURsGHkFVVELfrjGn2Nvlw1nKibufEFz0nUhCGTaHsKantMHr5u8gEoeFMal5MPiYNdMbIPiruRPF2wxQ1fKknY3rtFK4R70ZkS4wGTQgsI-p-4reSmhi4HmvQGFTcHq2LWYDEPVNERG6TAPQNEGzFC_61N7a8uxva9QuCAzj4ro7yR52UGiicTfyLAfuWibw-Do9yYLPZpFO-b58lJnUZ6JZ_lNz-V7zK6KFNE_W80">
<meta property="og:image" content="https://www.plantuml.com/plantuml/png/TLDFQzH05B_dKypDbfBq7cIf1n5F7ZoAoB0PDR2PBSaKwn-XnGtMLhQ5je89X6eLHT6sP65toVxvCdcJUDgluCJ9hjaapILXtdk_z_ipsN0OjjcMrL9k8Bu_Jgy-fTDVSNGE7x_pxbSuF5TCoeZz63S9kYi-C6lRwAM2n4F9DbjPHJgwjydCDhqfobP3UIs0mEt7u-DqruEZFRWO2j3Po0D_0kFFuBv9UcVyz3A9EagpXHq7tR7nvbEpwTooRVmynruZBM8HoXnzKRujJnuyb0sKFCkMBq_B4ZQCH_dyIlwkmApALbD8giBCXKen1Tv9TCo3Zj0cgPT1v-GfjeYExZFRf4_aYQPfQ7qTmU45xqUmVyRz7dpnu2hWEzyIVm1ko3yCUNXQj6-UGwrtYsgTYQMWranga6qTRJdc2v9RbBNLcbTEjIGn2_WVnJ098wLsgwQzQlo_Apg2tq7IlLpkHQhQk8Qpde6dkoUpqLvLzfyTBvs-pLAJVgNJ4_23UD2DXmToBF4w1UVUbTQsLRKIcexaJQrT2EzTEFefiee7FufL8IgU76GBDWWrnF_p5m00">
<meta property="og:image" content="https://www.plantuml.com/plantuml/png/jP91Iy9W6CVl-nJlhIBqKBSTmWuTwn9qd_fgWtTBjdTHL92GL2fE8b4wH19A49en8gDbNyR7lPty2aq5aRsliWxjjcVF_h_d_pp_c4aLWreQaPRG8F_5Nkki_iHwFN3jGQa1zgEawXGRAIM1qTPHni2cgHxew4H2_ZF-vDVeyWgIaRg-9fsDP2eTQ5MXs_svjATYKe8efebsB2sE3KvezL0X5fv8ZD_5of1_63WLzbtssjMWycOooSiIdABopDoJgg6czmLbCRF_KPlBtBO8LJFa-5_0ODS42znJ35M94ymZTKN3CjgbXggd_x9KzbQ0SvUzjC1kS4lr2MbTmpeLdMmoYIoOQOOVpkx8Ryxnd4yfc91ez7HZDdaoWlQzL-f8_i53T74dcj_AsvZFvlOITb0KYGIxSWxBtWxTAs6wePY3yZEyDy5se5MUrdtjVgymTAzvXuiOV9f3CNY_2obyfAQKGAhXfiYQMR_VkxlmVn6WOrXFMXhv1G00">
<meta property="og:image" content="https://www.plantuml.com/plantuml/png/nLFBRjD05DtxAxmZ0T8FY51LYJLYmH8Xox9l8WjxN8qdeZmg9OZGbaP9U1HLuL5LBG-1A5Gfj5NJvcSyjhlABt3hiIUJ4gJkcasicNFFlUUUCtC1CochUQvsHUVRItoupe_NelOdtjdI7CA0LamBz5lW0M6-_bZJyKSXO3u50qiP57pgL1rYuabPlos_YzeYCfw-hoUV6-7m0_-n7h_u4zKRSUyPRs_mBwlyvs6okpaQBFFEo-JtVb9lZWOhckMQGQ3GP1slCLXWXkNZG8ILzJkCEgGgRgmQ3NngpFk1mnoVbFLQu3m2SHU02nO3sp0fc3ZT_1dYHY55N1V0ugo0Lf0R1JrqOPAUm8D2KLULvTJCK8Sg8D2ODcLnZ3ytQbeoVNobQ493Md8XLRf2CTQMrlyhDSDQoCV0y8JPgUpCU76V-rwXlYTHsR-42kDvSpyyVercoqpndOzn-rUyUvHvVDCds8z1LdRfHbyyrF7EPjnzZe55CQD1AzdRIFQsCE3ywLV-gXLrkk79EobRn3pNZECnypx8M6VB2-JsxjwRZ9si4CUcRVz_yG9I1IOX3h5X8LkKwkQYbbhKZ_j7sZaVPcQUpEOuh12kQSg3B9NKUoH96c_m5QkF-hJUIuPBasd2pKoBJ_JsCEglXGTjkR2SSKKRR-jggQJqJ1eztbt6dgeHlDNatUzyknSUV5Cp5vwidd7D0R5hdliN">
<meta property="og:image" content="https://www.plantuml.com/plantuml/png/SoWkIImgAStDuL9NUB6ywUdw-IyQMf_rBNtQlvWhCwyajIWjCJbLmJ-fEBMeBBL8ePfB0GXA2r8IIr8rYakJibAJIwmKWY4CJQvQe2bFTkn-kMW6kX4mDL0J4bDIulEXXch065PmUpJ1YefIS_FBKWchoyiloKohXAihre0uv6dhzYTx9p-VrG9nqTDryvxtRNY-SVVxFJrFTYzzqRJm-T8LJtPlVxPWpvCTkvxiw-PApaaiBbO8BibFpWueoanEXRfLkm34iL98CpE1yE4M8HmI7GkH8ifVsiHwJ1k7pvvrJNsnjGKOKK_spW6w7HvlGBz2F0ttAzHFddbbgSKb-KKm7-KbvgPQ0NrQb9cN3X791Al8JSqhYIykAGB6RdebgW8ySGuEwytFD-_cWjcZfrTZXqWqLWeGzt0XWXQa06O4Dda5NLra0q3clsYSydvF1tAq0Vttic7MY_tjwC7qRDhEPvkdFjdH1myPcFvEBeVKl1HWSWS0">
<meta property="og:image" content="https://www.plantuml.com/plantuml/png/SoWkIImgAStDuL9NUBvsslEfIv_rBNtQlvWhCwyajIWjCJbL8RYaAB4aDRrIePfB0GXIArAJIqjIDH9pyqlpIgmKqinCDBbgWTgVxLxujBqVOiZpZRkvadCIYuiLt4fpSe9IKqgJIpBpyz2CqYx9A4ejpiZFIG4R0n4hWYb64YFHJfVCucIGGdJhKg3YyI1XOen_igFhoOxkPzFQ4MOxvmC3fg84PcGnr0ehU311nFDIopKmvJGLh606eDWS3rEAxWIW6vwsRdw-UJSNrd3KqwknWniEDFlfkddF-pPmmVnFG1dCAxgwoB8W2ryqJdc_fmFPzoyRPhtOtuxkt6VJTZxRFFN9ZZv83C1qTd8vfEQb01CL0000">
<meta property="og:image" content="https://www.plantuml.com/plantuml/png/SoWkIImgAStDuL9NUDQrzyN6XSytxdw_f-DPtzAd_OkVxbtqT4__axsJd_TjUB-daoiphoIrA2qnELN1BJCdDQ0eFpcrk3Y_IA6QIm482Y3y-3IWd0Q8Y2z8BCcmKYWkAT84AyWlICt3BPkSar-SYf2s0ji1aSf8p4l9WSZ59-S37P5NWgAc5kZwfwtRGGwTrV9iMlkpEMk0v9FTsvukQNa-eGte9QxadCJYOeMGr8eIR4xN9kXsRVoEryRZUcsIdFzqzhwdpVtOdU-PcvYUEXZT3_R0vkURTtDXXB2UNeqTMdAnKdYwRXumIN61_KEqQeVKl1HWIWK0">
<meta property="og:image" content="https://www.plantuml.com/plantuml/png/fPFDJkf07CNtVOhPNMuQMDtSHHS6unkeSKl6Cj19oaUc0oxKX0qgBZ3H20cA1emXRgg463Lyy3BqWnMlOELF9zMWWhAPF_nFVkSCFOqQ73EUI-dI7-IQmt7LT0j5ktnhdTn8DCq9Is2Le2rgK9vXQ5T2tYV_zYscKgRg90I7WjQcvz-0W16LutJIquX9GUl-65HoHa7e3mhQXCcJxNl9h8k1rM_QntsttN3QtK2o3GrdoImNLbMIvQ4yX5Nyr3D4yMdKFmEGXvZqQjRbWJTBgeuD0-Bx89dXECqP2ahy_mS_B8bshky4MbnPq7Ted6i1k4PeKkC_TnizbzpMgJ0K_vtljuqDyaixKGrm7DURJklUDHkEMHMhcVig8_XzNsIUuLYFOMyHSFssHVBYDP8Nwj7qDXsdqvK26IEHlHNHRmLPvfLJVf0WntG73HCRuJnl2MxpTu14uN3GRZIeku-LIUy8oZWkrDpX8JmFk_9YTyv1yE7DdFHA8iUdHEZWuaG8_mKGQhOSCqhIyLnAVmK0">
<meta property="article:published_time" content="2024-11-19T06:34:17.000Z">
<meta property="article:modified_time" content="2024-11-19T06:34:17.000Z">
<meta property="article:author" content="MichaelFu">
<meta property="article:tag" content="设计模式">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.fudenglong.site/2024/11/19/Design-Patterns/example-design-patterns/%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F.png">


<link rel="canonical" href="https://blog.fudenglong.site/2024/11/19/Design-Patterns/example-design-patterns/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.fudenglong.site/2024/11/19/Design-Patterns/example-design-patterns/","path":"2024/11/19/Design-Patterns/example-design-patterns/","title":"设计模式及其示例"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>设计模式及其示例 | MichaelFu</title>
  







<script async src="/lib/fireworks.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">MichaelFu</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">好记性不如烂笔头</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-云-&nbsp;&nbsp;原-&nbsp;&nbsp;生"><a href="/%E4%BA%91%E5%8E%9F%E7%94%9F/" rel="section"><i class="fa fa-cloud fa-fw"></i>云 &nbsp;&nbsp;原 &nbsp;&nbsp;生</a></li><li class="menu-item menu-item-rust-编程"><a href="/Programming-Rust/" rel="section"><i class="fa fa-cat fa-fw"></i>Rust 编程</a></li><li class="menu-item menu-item-go-&nbsp;&nbsp;&nbsp;编程"><a href="/Programming-Go/" rel="section"><i class="fa fa-hippo fa-fw"></i>Go &nbsp;&nbsp;&nbsp;编程</a></li><li class="menu-item menu-item-前端知识"><a href="https://wshuhua.github.io/" rel="section" target="_blank"><i class="fa fa-sun fa-fw"></i>前端知识</a></li><li class="menu-item menu-item-leetcode-rust"><a href="/Leetcode-Rust/" rel="section"><i class="fa fa-book fa-fw"></i>Leetcode-Rust</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.</span> <span class="nav-text"> 创建型设计模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.1.</span> <span class="nav-text"> 单例模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.2.</span> <span class="nav-text"> 工厂模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82"><span class="nav-number">1.3.</span> <span class="nav-text"> 抽象工厂</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.4.</span> <span class="nav-text"> 建造者模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.5.</span> <span class="nav-text"> 原型模式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.</span> <span class="nav-text"> 结构型设计模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.1.</span> <span class="nav-text"> 适配器模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.2.</span> <span class="nav-text"> 桥接模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.3.</span> <span class="nav-text"> 组合模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.4.</span> <span class="nav-text"> 装饰器模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.5.</span> <span class="nav-text"> 外观模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.6.</span> <span class="nav-text"> 享元模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.7.</span> <span class="nav-text"> 代理模式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.</span> <span class="nav-text"> 行为型设计模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.1.</span> <span class="nav-text"> 责任链模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.2.</span> <span class="nav-text"> 命令模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%AD%E4%BB%A3%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.3.</span> <span class="nav-text"> 迭代模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.4.</span> <span class="nav-text"> 中介者模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.5.</span> <span class="nav-text"> 解释器模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.6.</span> <span class="nav-text"> 备忘录模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.7.</span> <span class="nav-text"> 观察者模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.8.</span> <span class="nav-text"> 状态模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.9.</span> <span class="nav-text"> 策略模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95"><span class="nav-number">3.10.</span> <span class="nav-text"> 模板方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.11.</span> <span class="nav-text"> 访问者模式</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="MichaelFu"
      src="/avatar.jpeg">
  <p class="site-author-name" itemprop="name">MichaelFu</p>
  <div class="site-description" itemprop="description">实践能让记忆更深刻</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">84</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">126</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/gamelife1314" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;gamelife1314" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:michael.fudenglong@qq.com" title="E-Mail → mailto:michael.fudenglong@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://www.rust-lang.org/zh-CN/" title="https:&#x2F;&#x2F;www.rust-lang.org&#x2F;zh-CN&#x2F;" rel="noopener" target="_blank">Rust</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://go.dev/" title="https:&#x2F;&#x2F;go.dev&#x2F;" rel="noopener" target="_blank">Golang</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://www.python.org/" title="https:&#x2F;&#x2F;www.python.org&#x2F;" rel="noopener" target="_blank">Python</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://doc.rust-lang.org/cargo/index.html" title="https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;cargo&#x2F;index.html" rel="noopener" target="_blank">Cargo</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://gist.github.com/rxaviers/7360908" title="https:&#x2F;&#x2F;gist.github.com&#x2F;rxaviers&#x2F;7360908" rel="noopener" target="_blank">Emoji</a>
            </li>
        </ul>
      </div>
    </div>
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.fudenglong.site/2024/11/19/Design-Patterns/example-design-patterns/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/avatar.jpeg">
      <meta itemprop="name" content="MichaelFu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MichaelFu">
      <meta itemprop="description" content="实践能让记忆更深刻">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="设计模式及其示例 | MichaelFu">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          设计模式及其示例
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-11-19 14:34:17" itemprop="dateCreated datePublished" datetime="2024-11-19T14:34:17+08:00">2024-11-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>107k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:38</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>本文介绍23设计模式使用场景及其示例。</p>
<h3 id="创建型设计模式"><a class="markdownIt-Anchor" href="#创建型设计模式"></a> 创建型设计模式</h3>
<p>创建型设计模式主要用于对象的创建过程，旨在将对象的创建和使用分离，使得代码在创建对象时更加灵活、可维护且可复用。它关注的是对象创建的机制，通过隐藏对象创建的具体细节，提供了一种创建对象的统一方式，以满足不同场景下的需求。</p>
<h4 id="单例模式"><a class="markdownIt-Anchor" href="#单例模式"></a> 单例模式</h4>
<p>单例模式适用于整个系统只有一个实例的场景，比如数据库连接池、线程池、系统配置信息管理等。确保在任何时候只有一个对象被创建来提供统一的访问点，避免资源浪费和不一致性。</p>
<div class="tabs" id="单例模式"><ul class="nav-tabs"><li class="tab active"><a href="#单例模式-1">Rust</a></li><li class="tab"><a href="#单例模式-2">Go</a></li><li class="tab"><a href="#单例模式-3">Java</a></li></ul><div class="tab-content"><div class="tab-pane active" id="单例模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cell::RefCell;</span><br><span class="line"><span class="keyword">use</span> std::sync::&#123;Mutex, MutexGuard&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> once_cell::sync::Lazy;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[derive(Debug, Clone, Default)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">Connection</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">DatabaseConnectionPool</span> &#123;</span><br><span class="line">    connections: <span class="type">Vec</span>&lt;RefCell&lt;Connection&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">DatabaseConnectionPool</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(pool_size: <span class="type">usize</span>) <span class="punctuation">-&gt;</span> DatabaseConnectionPool &#123;</span><br><span class="line">        DatabaseConnectionPool &#123;</span><br><span class="line">            connections: <span class="type">Vec</span>::<span class="title function_ invoke__">with_capacity</span>(pool_size),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">get_connection</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;RefCell&lt;Connection&gt;&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">length</span> = <span class="keyword">self</span>.connections.<span class="title function_ invoke__">len</span>();</span><br><span class="line">        <span class="keyword">if</span> length &gt; <span class="number">0</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">Some</span>(<span class="keyword">self</span>.connections.<span class="title function_ invoke__">remove</span>(length - <span class="number">1</span>))</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="literal">None</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">release_connection</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, connection: Connection) &#123;</span><br><span class="line">        <span class="keyword">self</span>.connections.<span class="title function_ invoke__">push</span>(RefCell::<span class="title function_ invoke__">new</span>(connection))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">count</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">usize</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.connections.<span class="title function_ invoke__">len</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> GLOBAL_POOL: Lazy&lt;Mutex&lt;DatabaseConnectionPool&gt;&gt; =</span><br><span class="line">    Lazy::<span class="title function_ invoke__">new</span>(|| Mutex::<span class="title function_ invoke__">new</span>(DatabaseConnectionPool::<span class="title function_ invoke__">new</span>(<span class="number">10</span>)));</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">get_pool_instance</span>() <span class="punctuation">-&gt;</span> MutexGuard&lt;<span class="symbol">&#x27;static</span>, DatabaseConnectionPool&gt; &#123;</span><br><span class="line">    GLOBAL_POOL.<span class="title function_ invoke__">lock</span>().<span class="title function_ invoke__">unwrap</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">pool1</span> = <span class="title function_ invoke__">get_pool_instance</span>();</span><br><span class="line">        pool1.<span class="title function_ invoke__">release_connection</span>(Connection::<span class="title function_ invoke__">default</span>());</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Address of x: &#123;:p&#125;&quot;</span>, std::ptr::addr_of!(pool1));</span><br><span class="line">    &#125;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">pool2</span> = <span class="title function_ invoke__">get_pool_instance</span>();</span><br><span class="line">        pool2.<span class="title function_ invoke__">release_connection</span>(Connection::<span class="title function_ invoke__">default</span>());</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Address of x: &#123;:p&#125;&quot;</span>, std::ptr::addr_of!(pool2));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;connections length: &#123;&#125;&quot;</span>, <span class="title function_ invoke__">get_pool_instance</span>().<span class="title function_ invoke__">count</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这将输出：</p>
<pre><code>Address of x: 0x41330ff5f8
Address of x: 0x41330ff678
connections length: 2
</code></pre></div><div class="tab-pane" id="单例模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// DatabaseConnectionPool结构体模拟数据库连接池</span></span><br><span class="line"><span class="keyword">type</span> DatabaseConnectionPool <span class="keyword">struct</span> &#123;</span><br><span class="line">    connections []*Connection</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Connection结构体模拟数据库连接</span></span><br><span class="line"><span class="keyword">type</span> Connection <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 包级别的私有变量，用于存储单例的数据库连接池实例</span></span><br><span class="line"><span class="keyword">var</span> instance *DatabaseConnectionPool</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取数据库连接池单例实例的函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetDatabaseConnectionPoolInstance</span><span class="params">()</span></span> *DatabaseConnectionPool &#123;</span><br><span class="line">    <span class="keyword">if</span> instance == <span class="literal">nil</span> &#123;</span><br><span class="line">        instance = &amp;DatabaseConnectionPool&#123;</span><br><span class="line">            connections: <span class="built_in">make</span>([]*Connection, <span class="number">10</span>), <span class="comment">// 假设初始化10个连接</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> instance</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    pool1 := GetDatabaseConnectionPoolInstance()</span><br><span class="line">    pool2 := GetDatabaseConnectionPoolInstance()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证两个实例是否相同</span></span><br><span class="line">    <span class="keyword">if</span> pool1 == pool2 &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;数据库连接池实例是相同的，单例模式生效&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;数据库连接池实例不同，单例模式未生效&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="单例模式-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseConnectionPool</span> &#123;</span><br><span class="line">    <span class="comment">// 私有静态实例变量，初始化为null</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">DatabaseConnectionPool</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模拟数据库连接的列表</span></span><br><span class="line">    <span class="keyword">private</span> Connection[] connections;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 私有化构造函数，防止外部通过构造函数创建实例</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">DatabaseConnectionPool</span><span class="params">()</span> &#123;</span><br><span class="line">        connections = <span class="keyword">new</span> <span class="title class_">Connection</span>[<span class="number">10</span>]; <span class="comment">// 假设初始化10个连接</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 静态方法用于获取单例实例</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DatabaseConnectionPool <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">DatabaseConnectionPool</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DatabaseConnectionPool</span> <span class="variable">pool1</span> <span class="operator">=</span> DatabaseConnectionPool.getInstance();</span><br><span class="line">        <span class="type">DatabaseConnectionPool</span> <span class="variable">pool2</span> <span class="operator">=</span> DatabaseConnectionPool.getInstance();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 验证两个实例是否相同</span></span><br><span class="line">        <span class="keyword">if</span> (pool1 == pool2) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;数据库连接池实例是相同的，单例模式生效&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;数据库连接池实例不同，单例模式未生效&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Connection</span> &#123;&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<span id="more"></span>
<h4 id="工厂模式"><a class="markdownIt-Anchor" href="#工厂模式"></a> 工厂模式</h4>
<p>工厂设计模式核心是提供了一种创建对象的方式，将<span style="color:red"><strong>对象的创建和使用分离、屏蔽复杂的对象创建细节或者根据条件创建对象</strong></span>，通过使用工厂类来负责创建对象，而不是在客户端代码中直接实例化对象，这样可以隐藏对象创建的复杂细节，使得客户端代码只需要关心如何使用对象，而不需要了解对象是如何被创建出来的。</p>
<p>工厂模式适用以下场景：</p>
<ul>
<li>对象创建过程复杂：当创建一个对象需要进行复杂的初始化操作，如读取配置文件、连接数据库、进行复杂的计算等，使用工厂设计模式可以将这些复杂的创建过程封装在工厂类中，客户端只需从工厂获取创建好的对象即可。例如，创建一个数据库连接对象，可能需要配置数据库的各种参数、建立网络连接等复杂步骤，通过工厂模式可以让客户端简单地获取到可用的数据库连接对象。</li>
<li>根据不同条件创建不同类型对象：在某些应用场景中，需要根据不同的条件（如用户输入、系统配置等）创建不同类型的对象。比如在一个图形绘制应用中，根据用户选择的图形类型（圆形、矩形、三角形等）创建相应的图形对象，工厂模式可以根据传入的条件来决定创建哪种具体的图形对象。</li>
</ul>
<p>工厂设计模式具有如下特点：</p>
<ul>
<li>解耦对象创建和使用：客户端代码与对象的具体创建过程分离，降低了客户端代码对具体对象实现的依赖，使得代码的维护和扩展更加容易。如果对象的创建过程发生变化，只需要修改工厂类，而不需要在客户端代码中大量修改。</li>
<li>代码复用性高：工厂类可以被多个客户端代码复用，不同的客户端都可以通过同一个工厂类来获取所需的对象，提高了代码的复用程度。</li>
<li>便于对象管理：工厂模式可以对创建的对象进行统一管理，例如可以在工厂类中对创建的对象数量进行统计、对对象的生命周期进行控制等。</li>
</ul>
<p>工厂设计模式遵循以下设计原则：</p>
<ul>
<li>开闭原则：对扩展开放，对修改关闭。当需要添加新的对象类型时，只需创建新的具体工厂类或在现有工厂类中添加创建新对象的方法，而不需要修改客户端代码，使得系统能够方便地进行扩展。</li>
<li>依赖倒置原则：高层模块（客户端）不依赖于低层模块（具体对象的实现），而是依赖于抽象（工厂接口和抽象对象接口）。这样可以提高代码的灵活性，便于在不同的场景下替换不同的工厂类或具体对象实现。</li>
</ul>
<p><img data-src="%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F.png" alt="https://excalidraw.com/#json=eTts22nx8-1QxtYZUqTlC,r1eB4dik2psbblPlCTPf5w" /></p>
<p><a target="_blank" rel="noopener" href="//www.plantuml.com/plantuml/png/SoWkIImgAStDuL9NUDQrzyN6XKzsBNywkP4hCwyajIWjCJbL8JWZiI1LePfB0GXIYXBBDJIvQe6gdxPkVx9tCaJr-pspdivfUxft4LToJc9niO9pPb5o3aoFTb5YIcPfiPL2ch4HH02tAS_dhqIO4fIQN9AObuumg3mpfIG3oPoCrCpqZ18i1iCzytJxqgTzJUYUSKjCBialgeGQcroKcbYI6byCaj7Gj88eGN8Sn0ou5o5SP8-YcQTDd85mtqAug7ucsaomePkVRzxD1GrpFRqQEsYKMIayNJVlUTy6BgYXE6HH_81G0HF1C8QWMan3TNNXjeAS-w9n2imml6eSKlDIW4aJ0000">链接</a></p>
<div class="tabs" id="工厂方法"><ul class="nav-tabs"><li class="tab active"><a href="#工厂方法-1">Rust</a></li><li class="tab"><a href="#工厂方法-2">Go</a></li><li class="tab"><a href="#工厂方法-3">Java</a></li></ul><div class="tab-content"><div class="tab-pane active" id="工厂方法-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    radius: <span class="type">f64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Shape</span> <span class="keyword">for</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;绘制一个半径为：&#123;:.2&#125;的圆形&quot;</span>, <span class="keyword">self</span>.radius);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    width: <span class="type">f64</span>,</span><br><span class="line">    length: <span class="type">f64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Shape</span> <span class="keyword">for</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(</span><br><span class="line">            <span class="string">&quot;绘制一个长:&#123;:.2&#125;，宽：&#123;:.2&#125;的长方形&quot;</span>,</span><br><span class="line">            <span class="keyword">self</span>.length, <span class="keyword">self</span>.width</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">trait</span> <span class="title class_">Factory</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_shape</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Shape&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CircleFactory</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Factory</span> <span class="keyword">for</span> <span class="title class_">CircleFactory</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_shape</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Shape&gt; &#123;</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Circle &#123; radius: <span class="number">1.0</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RectangleFactory</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Factory</span> <span class="keyword">for</span> <span class="title class_">RectangleFactory</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_shape</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Shape&gt; &#123;</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Rectangle &#123;</span><br><span class="line">            width: <span class="number">1.0</span>,</span><br><span class="line">            length: <span class="number">3.0</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">circle_factory</span> = CircleFactory;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rectangle_factory</span> = RectangleFactory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">circle</span> = circle_factory.<span class="title function_ invoke__">create_shape</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rectangle</span> = rectangle_factory.<span class="title function_ invoke__">create_shape</span>();</span><br><span class="line"></span><br><span class="line">    circle.<span class="title function_ invoke__">draw</span>();</span><br><span class="line">    rectangle.<span class="title function_ invoke__">draw</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="工厂方法-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象图形接口，定义图形的通用行为</span></span><br><span class="line"><span class="keyword">type</span> Shape <span class="keyword">interface</span> &#123;</span><br><span class="line">    Draw()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体图形：圆形</span></span><br><span class="line"><span class="keyword">type</span> Circle <span class="keyword">struct</span> &#123;</span><br><span class="line">    radius <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Circle)</span></span> Draw() &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;绘制一个半径为%.2f的圆形\n&quot;</span>, c.radius)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体图形：矩形</span></span><br><span class="line"><span class="keyword">type</span> Rectangle <span class="keyword">struct</span> &#123;</span><br><span class="line">    width  <span class="type">float64</span></span><br><span class="line">    height <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r Rectangle)</span></span> Draw() &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;绘制一个宽为%.2f，高为%.2f的矩形\n&quot;</span>, r.width, r.height)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象工厂接口，定义创建图形的方法</span></span><br><span class="line"><span class="keyword">type</span> ShapeFactory <span class="keyword">interface</span> &#123;</span><br><span class="line">    CreateShape() Shape</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂：圆形工厂</span></span><br><span class="line"><span class="keyword">type</span> CircleFactory <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cf CircleFactory)</span></span> CreateShape() Shape &#123;</span><br><span class="line">    <span class="keyword">return</span> Circle&#123;radius: <span class="number">5.0</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂：矩形工厂</span></span><br><span class="line"><span class="keyword">type</span> RectangleFactory <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rf RectangleFactory)</span></span> CreateShape() Shape &#123;</span><br><span class="line">    <span class="keyword">return</span> Rectangle&#123;width: <span class="number">4.0</span>, height: <span class="number">6.0</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 创建圆形图形</span></span><br><span class="line">    circleFactory := CircleFactory&#123;&#125;</span><br><span class="line">    circleShape := circleFactory.CreateShape()</span><br><span class="line">    circleShape.Draw()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建矩形图形</span></span><br><span class="line">    rectangleFactory := RectangleFactory&#123;&#125;</span><br><span class="line">    rectangleShape := rectangleFactory.CreateShape()</span><br><span class="line">    rectangleShape.Draw()</span><br><span class="line">&#125;  rectangleProduct.Use()</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="工厂方法-3"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象图形trait，定义图形的通用行为</span></span><br><span class="line">trait Shape &#123;</span><br><span class="line">    fn <span class="title function_">draw</span><span class="params">(&amp;self)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体图形：圆形</span></span><br><span class="line">struct Circle &#123;</span><br><span class="line">    radius: f64,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Shape <span class="keyword">for</span> Circle &#123;</span><br><span class="line">    fn <span class="title function_">draw</span><span class="params">(&amp;self)</span> &#123;</span><br><span class="line">        println!(<span class="string">&quot;绘制一个半径为&#123;&#125;的圆形&quot;</span>, self.radius);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体图形：矩形</span></span><br><span class="line">struct Rectangle &#123;</span><br><span class="line">    width: f64,</span><br><span class="line">    height: f64,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">impl Shape <span class="keyword">for</span> Rectangle &#123;</span><br><span class="line">    fn <span class="title function_">draw</span><span class="params">(&amp;self)</span> &#123;</span><br><span class="line">        println!(<span class="string">&quot;绘制一个宽为&#123;&#125;，高为&#123;&#125;的矩形&quot;</span>, self.width, self.height);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象工厂trait，定义创建图形的方法</span></span><br><span class="line">trait ShapeFactory &#123;</span><br><span class="line">    fn <span class="title function_">create_shape</span><span class="params">(&amp;self)</span> -&gt; Box&lt;dyn Shape&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂：圆形工厂</span></span><br><span class="line">struct CircleFactory;</span><br><span class="line"></span><br><span class="line">impl ShapeFactory <span class="keyword">for</span> CircleFactory &#123;</span><br><span class="line">    fn <span class="title function_">create_shape</span><span class="params">(&amp;self)</span> -&gt; Box&lt;dyn Shape&gt; &#123;</span><br><span class="line">        Box::<span class="keyword">new</span>(Circle &#123; radius: <span class="number">5.0</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂：矩形工厂</span></span><br><span class="line">struct RectangleFactory;</span><br><span class="line"></span><br><span class="line">impl ShapeFactory <span class="keyword">for</span> RectangleFactory &#123;</span><br><span class="line">    fn <span class="title function_">create_shape</span><span class="params">(&amp;self)</span> -&gt; Box&lt;dyn Shape&gt; &#123;</span><br><span class="line">        Box::<span class="keyword">new</span>(Rectangle &#123; width: <span class="number">4.0</span>, height: <span class="number">6.0</span> &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 创建圆形图形</span></span><br><span class="line">    <span class="type">let</span> <span class="variable">circle_factory</span> <span class="operator">=</span> CircleFactory;</span><br><span class="line">    <span class="type">let</span> <span class="variable">circle_shape</span> <span class="operator">=</span> circle_factory.create_shape();</span><br><span class="line">    circle_shape.draw();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建矩形图形</span></span><br><span class="line">    <span class="type">let</span> <span class="variable">rectangle_factory</span> <span class="operator">=</span> RectangleFactory;</span><br><span class="line">    <span class="type">let</span> <span class="variable">rectangle_shape</span> <span class="operator">=</span> rectangle_factory.create_shape();</span><br><span class="line">    rectangle_shape.draw();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="抽象工厂"><a class="markdownIt-Anchor" href="#抽象工厂"></a> 抽象工厂</h4>
<p>抽象工厂<span style="color:red"><strong>相比创建单个产品的工厂模式，提供了创建一系列相关或相互依赖的对象，在实际应用场景中多是用来创建一些列的产品</strong> </span>，例如某个平台下的各种UI组件。客户端代码通过调用抽象工厂的方法来获取所需的产品对象，从而实现了对象创建和使用的解耦。因此个人认为<span style="color:red"><strong>抽象工厂可以叫做高级工厂</strong></span>。</p>
<p>如下是一些应用场景：</p>
<ol>
<li>跨平台应用开发：例如开发一款图形界面应用程序，需要在不同操作系统（如<code>Windows</code>、<code>Mac</code>、<code>Linux</code>）上运行，每个操作系统的界面组件（如按钮、文本框、菜单等）外观和行为有所不同，但整体都属于界面组件这一系列产品。可以使用抽象工厂模式，为每个操作系统创建一个具体工厂，负责生产该平台对应的界面组件产品族；</li>
<li>数据库访问层：当应用程序需要支持多种数据库系统（如 <code>MySQL</code>、<code>PostgreSQL</code>、<code>SQLite</code> 等）时，对于每种数据库，都有相关的连接对象、命令对象、结果集对象等一系列数据库操作相关对象。通过抽象工厂模式，可为每种数据库创建一个具体工厂，专门生产该数据库所需的这一系列相关对象；</li>
</ol>
<p>具有下面一些特点：</p>
<ul>
<li>解耦对象创建和使用：客户端不需要了解具体产品对象的创建细节，只依赖于抽象工厂和抽象产品接口，使得代码的依赖关系更清晰，易于维护和扩展。</li>
<li>产品族的一致性：确保创建的一组相关产品对象（即产品族）在风格、行为等方面保持一致。例如，在跨平台 UI 场景中，由一个具体工厂创建的所有 UI 组件都适配于该平台的风格和规范。</li>
<li>易于切换产品族：如果要切换到不同的产品族（如从使用 Windows 平台的 UI 组件切换到 Mac 平台的 UI 组件），只需更换使用的具体工厂实例，而不需要对客户端代码中关于产品使用的部分进行大量修改。</li>
</ul>
<p>遵循以下的设计原则：</p>
<ul>
<li>依赖倒置原则：高层模块（客户端）不依赖于低层模块（具体工厂和具体产品）的具体实现，而是依赖于抽象（抽象工厂和抽象产品接口）。这样可以降低模块之间的耦合度，提高代码的灵活性和可维护性。</li>
<li>开闭原则：对扩展开放，对修改关闭。当需要添加新的产品族（如支持新的操作系统或数据库系统）时，只需创建新的具体工厂和对应的新的具体产品类，实现相应的抽象接口，而无需修改现有的客户端代码和已有的抽象工厂、抽象产品接口。</li>
</ul>
<p>如下是抽象工厂模式的一个示例图：<br />
<img data-src="%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82.png" alt="https://excalidraw.com/#json=HS6Nui1E08mtfR7kpxwo3,XEyh6lbu0UM_GE6bV7doKw" /></p>
<div class="tabs" id="抽象工厂"><ul class="nav-tabs"><li class="tab active"><a href="#抽象工厂-1">Rust</a></li><li class="tab"><a href="#抽象工厂-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="抽象工厂-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象产品：按钮</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">click</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品：Windows按钮</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WindowsButton</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Button</span> <span class="keyword">for</span> <span class="title class_">WindowsButton</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">click</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Windows按钮被点击&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品：Mac按钮</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MacButton</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Button</span> <span class="keyword">for</span> <span class="title class_">MacButton</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">click</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Mac按钮被点击&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象产品：文本框</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">TextBox</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">input_text</span>(&amp;<span class="keyword">self</span>, text: &amp;<span class="type">str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品：Windows文本框</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WindowsTextBox</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">TextBox</span> <span class="keyword">for</span> <span class="title class_">WindowsTextBox</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">input_text</span>(&amp;<span class="keyword">self</span>, text: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;在Windows文本框中输入: &#123;&#125;&quot;</span>, text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品：Mac文本框</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MacTextBox</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">TextBox</span> <span class="keyword">for</span> <span class="title class_">MacTextBox</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">input_text</span>(&amp;<span class="keyword">self</span>, text: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;在Mac文本框中输入: &#123;&#125;&quot;</span>, text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象工厂</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">GUIFactory</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_button</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Button&gt;;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_text_box</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> TextBox&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂：Windows GUI工厂</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">WindowsGUIFactory</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">GUIFactory</span> <span class="keyword">for</span> <span class="title class_">WindowsGUIFactory</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_button</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Button&gt; &#123;</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(WindowsButton)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_text_box</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> TextBox&gt; &#123;</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(WindowsTextBox)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂：Mac GUI工厂</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MacGUIFactory</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">GUIFactory</span> <span class="keyword">for</span> <span class="title class_">MacGUIFactory</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_button</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Button&gt; &#123;</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(MacButton)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_text_box</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> TextBox&gt; &#123;</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(MacTextBox)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">windows_factory</span> = WindowsGUIFactory;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">mac_factory</span> = MacGUIFactory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">windows_button</span> = windows_factory.<span class="title function_ invoke__">create_button</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">windows_text_box</span> = windows_factory.<span class="title function_ invoke__">create_text_box</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">mac_button</span> = mac_factory.<span class="title function_ invoke__">create_button</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">mac_text_box</span> = mac_factory.<span class="title function_ invoke__">create_text_box</span>();</span><br><span class="line"></span><br><span class="line">    windows_button.<span class="title function_ invoke__">click</span>();</span><br><span class="line">    windows_text_box.<span class="title function_ invoke__">input_text</span>(<span class="string">&quot;Hello from Windows&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mac_button.<span class="title function_ invoke__">click</span>();</span><br><span class="line">    mac_text_box.<span class="title function_ invoke__">input_text</span>(<span class="string">&quot;Hello from Mac&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="抽象工厂-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象产品：按钮</span></span><br><span class="line"><span class="keyword">type</span> Button <span class="keyword">interface</span> &#123;</span><br><span class="line">    Click()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品：Windows按钮</span></span><br><span class="line"><span class="keyword">type</span> WindowsButton <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w *WindowsButton)</span></span> Click() &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Windows按钮被点击&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品：Mac按钮</span></span><br><span class="line"><span class="keyword">type</span> MacButton <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *MacButton)</span></span> Click() &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Mac按钮被点击&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象产品：文本框</span></span><br><span class="line"><span class="keyword">type</span> TextBox <span class="keyword">interface</span> &#123;</span><br><span class="line">    InputText(text <span class="type">string</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品：Windows文本框</span></span><br><span class="line"><span class="keyword">type</span> WindowsTextBox <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w *WindowsTextBox)</span></span> InputText(text <span class="type">string</span>) &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;在Windows文本框中输入: &quot;</span>, text)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品：Mac文本框</span></span><br><span class="line"><span class="keyword">type</span> MacTextBox <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *MacTextBox)</span></span> InputText(text <span class="type">string</span>) &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;在Mac文本框中输入: &quot;</span>, text)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象工厂</span></span><br><span class="line"><span class="keyword">type</span> GUIFactory <span class="keyword">interface</span> &#123;</span><br><span class="line">    CreateButton() Button</span><br><span class="line">    CreateTextBox() TextBox</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂：Windows GUI工厂</span></span><br><span class="line"><span class="keyword">type</span> WindowsGUIFactory <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w *WindowsGUIFactory)</span></span> CreateButton() Button &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;WindowsButton&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w *WindowsGUIFactory)</span></span> CreateTextBox() TextBox &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;WindowsTextBox&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂：Mac GUI工厂</span></span><br><span class="line"><span class="keyword">type</span> MacGUIFactory <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *MacGUIFactory)</span></span> CreateButton() Button &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;MacButton&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *MacGUIFactory)</span></span> CreateTextBox() TextBox &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;MacTextBox&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    windowsFactory := &amp;WindowsGUIFactory&#123;&#125;</span><br><span class="line">    macFactory := &amp;MacGUIFactory&#123;&#125;</span><br><span class="line"></span><br><span class="line">    windowsButton := windowsFactory.CreateButton()</span><br><span class="line">    windowsTextBox := windowsFactory.CreateTextBox()</span><br><span class="line"></span><br><span class="line">    macButton := macFactory.CreateButton()</span><br><span class="line">    macTextBox := macFactory.CreateTextBox()</span><br><span class="line"></span><br><span class="line">    windowsButton.Click()</span><br><span class="line">    windowsTextBox.InputText(<span class="string">&quot;Hello from Windows&quot;</span>)</span><br><span class="line"></span><br><span class="line">    macButton.Click()</span><br><span class="line">    macTextBox.InputText(<span class="string">&quot;Hello from Mac&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="建造者模式"><a class="markdownIt-Anchor" href="#建造者模式"></a> 建造者模式</h4>
<p>建造者设计<span style="color:red"><strong>核心是将一个复杂对象的构建过程与其表示分离，使得同样的构建过程可以创建不同的表示，例如，造汽车就是车轮、车身以及发动机等，但是豪车和普通车的工艺以及配件就是不一样</strong></span>。该模式通过将复杂对象的构建步骤抽象出来，由不同的<strong>建造者</strong>来具体实现这些步骤，最后通过<strong>指挥者</strong>来协调建造者完成复杂对象的构建。</p>
<p>建造者设计模式适用场景举例：</p>
<ul>
<li>复杂对象创建：当需要创建一个复杂对象，且该对象的创建过程涉及多个步骤或多个部件的组装时，比如创建一辆汽车，需要分别组装发动机、车身、轮胎等部件，就可以使用建造者设计模式。</li>
<li>配置对象生成：在软件配置管理中，对于一些具有多个可配置选项的复杂配置对象，如数据库连接配置对象，包含数据库类型、主机地址、端口号、用户名、密码等多个属性，使用建造者设计模式可以方便地按照不同需求构建出不同的配置对象。</li>
</ul>
<p>建造者设计模式具有如下特点：</p>
<ul>
<li>分离构建与表示：将对象的构建过程从其最终的表示形式中分离出来，使得构建过程可以被复用，并且可以通过不同的建造者创建出具有不同表示的同一类型对象。</li>
<li>逐步构建：允许按照特定的顺序逐步完成复杂对象的构建，每个建造者负责一个或多个特定的构建步骤，使得构建过程更加清晰和可控。</li>
<li>可扩展性：方便添加新的建造者来实现不同的构建方式，以创建出更多种类的复杂对象，而不需要修改指挥者和原有建造者的核心逻辑。</li>
</ul>
<p>建造者设计模式遵循以下设计原则：</p>
<ul>
<li>单一职责原则：每个建造者类只负责对象构建过程中的一部分工作，如专门负责安装发动机的建造者、负责安装车身的建造者等，使得每个类的职责更加单一明确。</li>
<li>开闭原则：对扩展开放，对修改关闭。当需要创建新类型的复杂对象或对现有对象的构建过程进行修改时，只需添加新的建造者类或修改现有建造者类的构建步骤，而不需要修改指挥者类和客户端代码。</li>
</ul>
<p>如下是建造者模式的UML类图：<br />
<img data-src="%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F.png" alt="https://excalidraw.com/#json=yv0x0b0Dv2M1VviwzZFl5,i52s-Vj1oX-2i8CJ66m2Wg" /></p>
<div class="tabs" id="建造者设计模式"><ul class="nav-tabs"><li class="tab active"><a href="#建造者设计模式-1">Rust</a></li><li class="tab"><a href="#建造者设计模式-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="建造者设计模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 产品：汽车</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    engine: <span class="type">String</span>,</span><br><span class="line">    body: <span class="type">String</span>,</span><br><span class="line">    tires: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象建造者</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">CarBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">build_engine</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> <span class="keyword">Self</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">build_body</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> <span class="keyword">Self</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">build_tires</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> <span class="keyword">Self</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_result</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> Car;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体建造者：豪华汽车建造者</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LuxuryCarBuilder</span> &#123;</span><br><span class="line">    car: Car,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">LuxuryCarBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        LuxuryCarBuilder &#123;</span><br><span class="line">            car: Car &#123;</span><br><span class="line">                engine: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;高性能发动机&quot;</span>),</span><br><span class="line">                body: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;豪华车身&quot;</span>),</span><br><span class="line">                tires: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;高级轮胎&quot;</span>),</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">CarBuilder</span> <span class="keyword">for</span> <span class="title class_">LuxuryCarBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">build_engine</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.car.engine = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;更强大的高性能发动机&quot;</span>);</span><br><span class="line">        <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">build_body</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.car.body = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;更精致的豪华车身&quot;</span>);</span><br><span class="line">        <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">build_tires</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.car.tires = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;更舒适的高级轮胎&quot;</span>);</span><br><span class="line">        <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_result</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> Car &#123;</span><br><span class="line">        <span class="keyword">self</span>.car.<span class="title function_ invoke__">clone</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体建造者：普通汽车建造者</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RegularCarBuilder</span> &#123;</span><br><span class="line">    car: Car,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">RegularCarBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        RegularCarBuilder &#123;</span><br><span class="line">            car: Car &#123;</span><br><span class="line">                engine: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;普通发动机&quot;</span>),</span><br><span class="line">                body: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;普通车身&quot;</span>),</span><br><span class="line">                tires: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;普通轮胎&quot;</span>),</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">CarBuilder</span> <span class="keyword">for</span> <span class="title class_">RegularCarBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">build_engine</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.car.engine = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;稍强一些的普通发动机&quot;</span>);</span><br><span class="line">        <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">build_body</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.car.body = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;稍好一些的普通车身&quot;</span>);</span><br><span class="line">        <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">build_tires</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">mut</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.car.tires = <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;稍好一些的普通轮胎&quot;</span>);</span><br><span class="line">        <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_result</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> Car &#123;</span><br><span class="line">        <span class="keyword">self</span>.car.<span class="title function_ invoke__">clone</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指挥者</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Director</span> &#123;</span><br><span class="line">    builder: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> CarBuilder&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Director</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(builder: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> CarBuilder&gt;) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        Director &#123; builder &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">construct_car</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> Car &#123;</span><br><span class="line">        <span class="keyword">self</span>.builder</span><br><span class="line">           .<span class="title function_ invoke__">build_engine</span>()</span><br><span class="line">           .<span class="title function_ invoke__">build_body</span>()</span><br><span class="line">           .<span class="title function_ invoke__">build_tires</span>()</span><br><span class="line">           .<span class="title function_ invoke__">get_result</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// 创建豪华汽车</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">luxury_builder</span> = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(LuxuryCarBuilder::<span class="title function_ invoke__">new</span>());</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">luxury_director</span> = Director::<span class="title function_ invoke__">new</span>(luxury_builder);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">luxury_car</span> = luxury_director.<span class="title function_ invoke__">construct_car</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;豪华汽车配置：&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;发动机：&#123;&#125;&quot;</span>, luxury_car.engine);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;车身：&#123;&#125;&quot;</span>, luxury_car.body);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;轮胎：&#123;&#125;&quot;</span>, luxury_car.tires);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建普通汽车</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">regular_builder</span> = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(RegularCarBuilder::<span class="title function_ invoke__">new</span>());</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">regular_director</span> = Director::<span class="title function_ invoke__">new</span>(regular_builder);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">regular_car</span> = regular_director.<span class="title function_ invoke__">construct_car</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;普通汽车配置：&quot;</span>);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;发动机：&#123;&#125;&quot;</span>, regular_car.engine);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;车身：&#123;&#125;&quot;</span>, regular_car.body);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;轮胎：&#123;&#125;&quot;</span>, regular_car.tires);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="建造者设计模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 产品：汽车</span></span><br><span class="line"><span class="keyword">type</span> Car <span class="keyword">struct</span> &#123;</span><br><span class="line">    Engine <span class="type">string</span></span><br><span class="line">    Body   <span class="type">string</span></span><br><span class="line">    Tires  <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象建造者</span></span><br><span class="line"><span class="keyword">type</span> CarBuilder <span class="keyword">interface</span> &#123;</span><br><span class="line">    BuildEngine() CarBuilder</span><br><span class="line">    BuildBody() CarBuilder</span><br><span class="line">    BuildTires() CarBuilder</span><br><span class="line">    GetResult() Car</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体建造者：豪华汽车建造者</span></span><br><span class="line"><span class="keyword">type</span> LuxuryCarBuilder <span class="keyword">struct</span> &#123;</span><br><span class="line">    car Car</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewLuxuryCarBuilder</span><span class="params">()</span></span> *LuxuryCarBuilder &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;LuxuryCarBuilder&#123;</span><br><span class="line">        car: Car&#123;</span><br><span class="line">            Engine: <span class="string">&quot;高性能发动机&quot;</span>,</span><br><span class="line">            Body:   <span class="string">&quot;豪华车身&quot;</span>,</span><br><span class="line">            Tires:  <span class="string">&quot;高级轮胎&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LuxuryCarBuilder)</span></span> BuildEngine() CarBuilder &#123;</span><br><span class="line">    l.car.Engine = <span class="string">&quot;更强大的高性能发动机&quot;</span></span><br><span class="line">    <span class="keyword">return</span> l</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LuxuryCarBuilder)</span></span> BuildBody() CarBuilder &#123;</span><br><span class="line">    l.car.Body = <span class="string">&quot;更精致的豪华车身&quot;</span></span><br><span class="line">    <span class="keyword">return</span> l</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LuxuryCarBuilder)</span></span> BuildTires() CarBuilder &#123;</span><br><span class="line">    l.car.Tires = <span class="string">&quot;更舒适的高级轮胎&quot;</span></span><br><span class="line">    <span class="keyword">return</span> l</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LuxuryCarBuilder)</span></span> GetResult() Car &#123;</span><br><span class="line">    <span class="keyword">return</span> l.car</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体建造者：普通汽车建造者</span></span><br><span class="line"><span class="keyword">type</span> RegularCarBuilder <span class="keyword">struct</span> &#123;</span><br><span class="line">    car Car</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewRegularCarBuilder</span><span class="params">()</span></span> *RegularCarBuilder &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;RegularCarBuilder&#123;</span><br><span class="line">        car: Car&#123;</span><br><span class="line">            Engine: <span class="string">&quot;普通发动机&quot;</span>,</span><br><span class="line">            Body:   <span class="string">&quot;普通车身&quot;</span>,</span><br><span class="line">            Tires:  <span class="string">&quot;普通轮胎&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RegularCarBuilder)</span></span> BuildEngine() CarBuilder &#123;</span><br><span class="line">    r.car.Engine = <span class="string">&quot;稍强一些的普通发动机&quot;</span></span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RegularCarBuilder)</span></span> BuildBody() CarBuilder &#123;</span><br><span class="line">    r.car.Body = <span class="string">&quot;稍好一些的普通车身&quot;</span></span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RegularCarBuilder)</span></span> BuildTires() CarBuilder &#123;</span><br><span class="line">    r.car.Tires = <span class="string">&quot;稍好一些的普通轮胎&quot;</span></span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RegularCarBuilder)</span></span> GetResult() Car &#123;</span><br><span class="line">    <span class="keyword">return</span> r.car</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指挥者</span></span><br><span class="line"><span class="keyword">type</span> Director <span class="keyword">struct</span> &#123;</span><br><span class="line">    builder CarBuilder</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewDirector</span><span class="params">(builder CarBuilder)</span></span> *Director &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;Director&#123;</span><br><span class="line">        builder: builder,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *Director)</span></span> ConstructCar() Car &#123;</span><br><span class="line">    <span class="keyword">return</span> d.builder.</span><br><span class="line">        BuildEngine().</span><br><span class="line">        BuildBody().</span><br><span class="line">        BuildTires().</span><br><span class="line">        GetResult()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// 创建豪华汽车</span></span><br><span class="line">    luxuryBuilder := NewLuxuryCarBuilder()</span><br><span class="line">    luxuryDirector := NewDirector(luxuryBuilder)</span><br><span class="line">    luxuryCar := luxuryDirector.ConstructCar()</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;豪华汽车配置：&quot;</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;发动机：&quot;</span>, luxuryCar.Engine)</span><br><span class="line">    fmt.Println(<span class="string">&quot;车身：&quot;</span>, luxuryCar.Body)</span><br><span class="line">    fmt.Println(<span class="string">&quot;轮胎：&quot;</span>, luxuryCar.Tires)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建普通汽车</span></span><br><span class="line">    regularBuilder := NewRegularCarBuilder()</span><br><span class="line">    regularDirector := NewDirector(regularBuilder)</span><br><span class="line">    regularCar := regularDirector.ConstructCar()</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;普通汽车配置：&quot;</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;发动机：&quot;</span>, regularCar.Engine)</span><br><span class="line">    fmt.Println(<span class="string">&quot;车身：&quot;</span>, regularCar.Body)</span><br><span class="line">    fmt.Println(<span class="string">&quot;轮胎：&quot;</span>, regularCar.Tires)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="原型模式"><a class="markdownIt-Anchor" href="#原型模式"></a> 原型模式</h4>
<p>原型设计模式中的<span style="color:red"><strong>原型的含义是新对象的创建是通过复制已有的对象（原型）来完成，从而创建一个与原始对象相似的新对象，而不需要知道创建细节，这种模式适合于对象创建成本较高的场景</strong></span>。</p>
<p>原型设计模式适用场景如下：</p>
<ul>
<li>对象创建成本高：当创建一个对象的过程比较复杂，例如涉及到大量的计算、数据库查询、网络请求等操作，且需要频繁创建相似的对象时，使用原型设计模式可以通过复制已有对象来避免重复执行这些复杂的创建过程，从而提高效率。比如创建复杂的图形对象，每次从头开始创建图形并设置其属性可能很耗时，通过复制已创建好的图形原型并进行微调就可以快速得到新的图形对象。</li>
<li>动态配置对象：在一些需要根据不同场景动态生成相似对象的情况下，如根据用户的不同设置生成不同配置的系统设置对象，先创建一个基础的设置对象原型，然后根据用户的具体选择复制该原型并修改相应的属性，就可以快速生成符合用户需求的设置对象。</li>
</ul>
<p>原型设计模式特点如下：</p>
<ul>
<li>高效创建相似对象：无需重新执行复杂的对象创建过程，直接通过复制原型对象就能快速得到新的对象，节省了创建时间，尤其适用于创建成本高的对象。</li>
<li>灵活修改复制对象：复制得到的新对象可以独立于原型对象进行属性修改等操作，能够根据具体需求灵活调整新对象的特性，以满足不同的应用场景。</li>
<li>保持对象结构一致性：新创建的对象与原型对象在结构上基本相同，保证了对象体系的一致性，便于管理和使用。</li>
</ul>
<p>原型设计模式遵循的设计原则如下：</p>
<ul>
<li>开闭原则：原型模式确保对象的复制逻辑集中在对象自身，符合单一职责原则。。</li>
<li>依赖倒置原则：高层模块（如使用对象的客户端）不依赖于具体的对象创建方式（如通过构造函数或其他复杂方式），而是依赖于抽象的原型接口，这样使得代码更具灵活性，便于替换不同的原型实现。</li>
</ul>
<p>下面是原型模式的UML类图：</p>
<p><img data-src="%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F.png" alt="https://excalidraw.com/#json=KWHD7I-9y9ioKLmcnymDg,3IVqEEMouKaxAruhfYKSNQ" /></p>
<div class="tabs" id="原型设计模式"><ul class="nav-tabs"><li class="tab active"><a href="#原型设计模式-1">Rust</a></li><li class="tab"><a href="#原型设计模式-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="原型设计模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象原型</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Prototype</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">clone</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Prototype&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体原型：图形对象</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GraphicObject</span> &#123;</span><br><span class="line">    color: <span class="type">String</span>,</span><br><span class="line">    size: (<span class="type">i32</span>, <span class="type">i32</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Prototype</span> <span class="keyword">for</span> <span class="title class_">GraphicObject</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">clone</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Prototype&gt; &#123;</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(GraphicObject &#123;</span><br><span class="line">            color: <span class="keyword">self</span>.color.<span class="title function_ invoke__">clone</span>(),</span><br><span class="line">            size: <span class="keyword">self</span>.size,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">original_graphic</span> = GraphicObject &#123;</span><br><span class="line">        color: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;red&quot;</span>),</span><br><span class="line">        size: (<span class="number">100</span>, <span class="number">100</span>),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">cloned_graphic</span> = original_graphic.<span class="title function_ invoke__">clone</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;原始图形颜色: &#123;&#125;&quot;</span>, original_graphic.color);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;原始图形大小: &#123;:?&#125;&quot;</span>, original_graphic.size);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;克隆图形颜色: &#123;&#125;&quot;</span>, cloned_graphic.color);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;克隆图形大小: &#123;:?&#125;&quot;</span>, cloned_graphic.size);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="原型设计模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象原型</span></span><br><span class="line"><span class="keyword">type</span> Prototype <span class="keyword">interface</span> &#123;</span><br><span class="line">    Clone() Prototype</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体原型：图形对象</span></span><br><span class="line"><span class="keyword">type</span> GraphicObject <span class="keyword">struct</span> &#123;</span><br><span class="line">    Color <span class="type">string</span></span><br><span class="line">    Size  [<span class="number">2</span>]<span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *GraphicObject)</span></span> Clone() Prototype &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;GraphicObject&#123;</span><br><span class="line">        Color: g.Color,</span><br><span class="line">        Size:  g.Size,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    originalGraphic := GraphicObject&#123;</span><br><span class="line">        Color: <span class="string">&quot;red&quot;</span>,</span><br><span class="line">        Size:  [<span class="number">2</span>]<span class="type">int</span>&#123;<span class="number">100</span>, <span class="number">100</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    clonedGraphic := originalGraphic.Clone()</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;原始图形颜色: &quot;</span>, originalGraphic.Color)</span><br><span class="line">    fmt.Println(<span class="string">&quot;原始图形大小: &quot;</span>, originalGraphic.Size)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;克隆图形颜色: &quot;</span>, clonedGraphic.Color)</span><br><span class="line">    fmt.Println(<span class="string">&quot;克隆图形大小: &quot;</span>, clonedGraphic.Size)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h3 id="结构型设计模式"><a class="markdownIt-Anchor" href="#结构型设计模式"></a> 结构型设计模式</h3>
<p>结构型设计模式主要用于处理对象之间的组合和关联关系，通过合理地组织对象之间的结构，使得系统更加稳定、灵活且易于维护。</p>
<h4 id="适配器模式"><a class="markdownIt-Anchor" href="#适配器模式"></a> 适配器模式</h4>
<p>适配器模式<span style="color:red"><strong>主要作用是将一个类的接口转换成客户期望的另一个接口，使得原本不兼容的类可以协同工作，就像出国时要带的转换插头，将其他地区的插座形态转换为国标形态，通常用于系统集成、第三方库使用场景</strong></span>。</p>
<p>适配器模式适用以下场景：</p>
<ul>
<li>
<p>系统集成：当需要将新开发的系统与现有遗留系统进行集成时，新系统和遗留系统的接口可能不兼容。例如，新开发的支付系统使用的是基于 RESTful API 的接口规范，而公司现有的财务系统使用的是基于 SOAP 协议的接口，通过适配器模式可以创建一个适配器，将新支付系统的接口适配成财务系统能够理解和处理的接口形式，从而实现两者的集成。</p>
</li>
<li>
<p>第三方库使用：在使用第三方库时，其提供的接口可能与项目中其他部分所期望的接口不一致。比如，项目中使用的图形绘制框架期望接收以某种特定格式（如结构体数组）表示的图形数据，而引入的一个第三方图形库返回的图形数据格式是对象链表，这时就可以利用适配器模式创建一个适配器类，将第三方库返回的数据格式转换为项目框架所期望的格式。</p>
</li>
</ul>
<p>该模式具有以下特点：</p>
<ul>
<li>接口转换：适配器模式的核心功能是实现接口的转换，让原本不兼容的接口能够相互适配，使得不同接口规范的类或系统可以协同工作。</li>
<li>复用性：一旦创建了合适的适配器，它可以在多个需要进行相同接口转换的场景中被复用，提高了代码的复用率。</li>
<li>解耦：通过适配器将不兼容的部分隔离开来，使得客户端代码不需要了解被适配对象的具体实现细节，降低了客户端与被适配对象之间的耦合度。</li>
</ul>
<p>适配器模式遵循以下设计原则：</p>
<ul>
<li>开闭原则：对扩展开放，对修改关闭。当需要适配新的不兼容接口时，只需创建新的适配器类来实现接口转换，而不需要修改客户端代码和被适配对象的原有实现。</li>
<li>依赖倒置原则：高层模块（客户端）不依赖于低层模块（被适配对象的具体实现），而是依赖于抽象（适配器接口和被适配对象的抽象接口，如果有的话）。这样可以提高代码的灵活性，便于在不同场景下替换不同的适配器或被适配对象。</li>
</ul>
<p>以下是适配器模式的UML关系图，<code>Adapter</code>将<code>Adapee</code>转换为用于希望的<code>Target</code>：</p>
<p><img data-src="//www.plantuml.com/plantuml/png/SoWkIImgAStDuL9NU3vxtRC5xS_wbZxjNyoLcLUIMfIMc9og499Ob9vQeb3DfG04HQc5fQd59HgQ2bOAmIL5cNdfNBL0hIyMhNxPqFIojVT5GojNSavYSR62OqfYGKbgAbIVTd51Qd9cMcPoFDG4k7uqQHmMG4n_EdC5Ykb5CDCJePPPmQo526Cr36ZQqzRDppVlve8QegTNOmVr9L3TqtNpdlTjWCafwEhQmRrY1TBued7A-pqTSFSyxMbzEc4ril-11ZpPr_r-JoUNGsfU2Z1e0G00" alt="链接" /></p>
<div class="tabs" id="适配器模式"><ul class="nav-tabs"><li class="tab active"><a href="#适配器模式-1">Rust</a></li><li class="tab"><a href="#适配器模式-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="适配器模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 目标接口，客户端期望的接口形式</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Target</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">request</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 被适配者，现有不兼容的接口形式</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Adaptee</span> &#123;</span><br><span class="line">    specific_request: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Adaptee</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">specific_request</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.specific_request.<span class="title function_ invoke__">clone</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 适配器</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Adapter</span> &#123;</span><br><span class="line">    adaptee: Adaptee,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Adapter</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(adaptee: Adaptee) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        Adapter &#123; adaptee &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Target</span> <span class="keyword">for</span> <span class="title class_">Adapter</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">request</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="comment">// 在这里进行接口转换，将被适配者的接口调用结果转换为目标接口期望的形式</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">result</span> = <span class="keyword">self</span>.adaptee.<span class="title function_ invoke__">specific_request</span>();</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;Adapter: &#123;&#125;&quot;</span>, result)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">adaptee</span> = Adaptee &#123;</span><br><span class="line">        specific_request: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;原始请求数据&quot;</span>),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">adapter</span> = Adapter::<span class="title function_ invoke__">new</span>(adaptee);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = adapter.<span class="title function_ invoke__">request</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="适配器模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 目标接口，客户端期望的接口形式</span></span><br><span class="line"><span class="keyword">type</span> Target <span class="keyword">interface</span> &#123;</span><br><span class="line">    Request() <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 被适配者，现有不兼容的接口形式</span></span><br><span class="line"><span class="keyword">type</span> Adaptee <span class="keyword">struct</span> &#123;</span><br><span class="line">    SpecificRequest <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *Adaptee)</span></span> SpecificRequest() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a.SpecificRequest</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 适配器</span></span><br><span class="line"><span class="keyword">type</span> Adapter <span class="keyword">struct</span> &#123;</span><br><span class="line">    Adaptee *Adaptee</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *Adapter)</span></span> New(adaptee *Adaptee) *Adapter &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;Adapter&#123;Adaptee: adaptee&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *Adapter)</span></span> Request() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="comment">// 在这里进行接口转换，将被适配者的接口调用结果转换为目标接口期望的形式</span></span><br><span class="line">    result := a.Adaptee.SpecificRequest()</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;Adapter: %s&quot;</span>, result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    adaptee := &amp;Adaptee&#123;</span><br><span class="line">        SpecificRequest: <span class="string">&quot;原始请求数据&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    adapter := &amp;Adapter&#123;&#125;.New(adaptee)</span><br><span class="line"></span><br><span class="line">    result := adapter.Request()</span><br><span class="line"></span><br><span class="line">    fmt.Println(result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="桥接模式"><a class="markdownIt-Anchor" href="#桥接模式"></a> 桥接模式</h4>
<p>桥接模式的含义是<span style="color:red"><strong>通过一个桥梁（抽象部分）来将客户端与实现部分分离开来，让他们能够独立在不同的方向上进行演化，使得在系统扩展或变化时，能够灵活地组合不同的抽象和实现，而不需要修改大量的现有代码</strong></span>。</p>
<p>如下图所示，为了将不同的图形绘画出来，可以选择不同的技术，将图形（客户端）和具体的图形绘制技术（实现部分）抽象出来组成桥梁，这样客户端和实现就可以朝着两边持续进行演化：</p>
<p><img data-src="bridge.png" alt="" /></p>
<p>桥接模式适用以下场景：</p>
<ul>
<li>图形绘制系统：在图形绘制系统中，有不同类型的图形（如圆形、矩形、三角形等），并且每种图形可以有不同的绘制方式（如使用不同的图形库、不同的渲染算法等）。可以使用桥接模式，将图形的抽象概念（如形状接口）与具体的绘制实现（如不同的绘制算法类）分离，这样当需要添加新的图形类型或新的绘制方式时，只需要分别在对应的抽象和实现部分进行扩展，而不会影响到其他部分的代码。</li>
<li>跨平台应用开发：对于需要在不同操作系统平台（如 Windows、Mac、Linux）上运行的应用程序，并且在不同平台上有不同的实现方式（如窗口管理、文件系统操作等）。通过桥接模式，可以将应用程序的业务逻辑抽象（如界面布局、功能模块等）与具体的平台实现分离，使得在支持新的平台或对现有平台的实现进行修改时，能够更方便地进行操作，而不会对业务逻辑造成太大的影响。</li>
</ul>
<p>桥接模式具有以下特点：</p>
<ul>
<li>分离抽象和实现：将抽象部分与实现部分解耦，使得它们能够独立发展和变化，一方的改变不会直接影响到另一方，提高了代码的灵活性和可维护性。</li>
<li>可扩展性：方便添加新的抽象类型或新的实现方式，只需要按照桥接模式的结构创建新的类并实现相应的接口，就可以轻松地将新的抽象和实现组合在一起，而不需要对现有代码进行大规模的修改。</li>
<li>符合开闭原则：对扩展开放，对修改关闭。当有新的需求时，通过添加新的类来满足，而不是修改现有的核心代码，使得系统能够更好地适应变化。</li>
</ul>
<p>该模式遵循以下设计原则：</p>
<ul>
<li>开闭原则：如前面所述，在需要扩展系统功能时，通过添加新的抽象类或实现类来实现，而不修改现有代码，保证了系统对扩展开放，对修改关闭。</li>
<li>依赖倒置原则：高层模块（如使用桥接模式的客户端）不依赖于低层模块（具体的抽象和实现类）的具体实现，而是依赖于抽象（抽象类和接口）。这样可以提高代码的灵活性，便于在不同场景下替换不同的抽象和实现组合。</li>
</ul>
<p>如下是示例代码的UML关系图：</p>
<p><img data-src="//www.plantuml.com/plantuml/png/SoWkIImgAStDuL9NUDQrzyN6XI-RLppjQ7k_PzRJlOkUTsrxrhVqQVzYhioyajIYjCJaL8NWZCI2L8LgBWKWI2bABDVGvAe5QdxQklt9tiaGFK_NpNlUjm5an9mse0XNSavYSR62SsPHSWvCftPHQbvAQb5gaPL249G54ITavFFvA-560hKcboJcfPDaAiGak2-VxTZqRFxafpDNe7iKRWBKR8ZHySbWNsXe8eiLmPo1ud2uoN2t-nUavhdxmCMXde28ejccZSqwRHBj2olDoKxCGxSF8ag-VM0BDp_Vl9iB4gDwUZLsq5HX1GrTBcZ4O9T4zJ1O1Oo3K0Hn9G55q2IbguigsRhvHUEKztiw8CdlQK_hqmchaKFdoRxkztiwOOx4Om0miU4pm06e1PXr0000" alt="链接" /></p>
<div class="tabs" id="桥接模式"><ul class="nav-tabs"><li class="tab active"><a href="#桥接模式-1">Rust</a></li><li class="tab"><a href="#桥接模式-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="桥接模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象部分：形状接口</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体形状实现：圆形</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    renderer: Rc&lt;<span class="keyword">dyn</span> Renderer&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Shape</span> <span class="keyword">for</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.renderer.<span class="title function_ invoke__">render_circle</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体形状实现：矩形</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    renderer: Rc&lt;<span class="keyword">dyn</span> Renderer&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Shape</span> <span class="keyword">for</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">draw</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.renderer.<span class="title function_ invoke__">render_rectangle</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现部分：渲染器接口</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Renderer</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">render_circle</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">render_rectangle</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体渲染器实现：OpenGL渲染器</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">OpenGLRenderer</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Renderer</span> <span class="keyword">for</span> <span class="title class_">OpenGLRenderer</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">render_circle</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;使用OpenGL渲染圆形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">render_rectangle</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;使用OpenGL渲染矩形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体渲染器实现：Vulkan渲染器</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">VulkanRenderer</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Renderer</span> <span class="keyword">for</span> <span class="title class_">VulkanRenderer</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">render_circle</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;使用Vulkan渲染圆形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">render_rectangle</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;使用Vulkan渲染矩形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">opengl_renderer</span> = Rc::<span class="title function_ invoke__">new</span>(OpenGLRenderer);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">vulkan_renderer</span> = Rc::<span class="title function_ invoke__">new</span>(VulkanRenderer);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">circle_with_opengl</span> = Circle &#123;</span><br><span class="line">        renderer: opengl_renderer.<span class="title function_ invoke__">clone</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rectangle_with_opengl</span> = Rectangle &#123;</span><br><span class="line">        renderer: opengl_renderer.<span class="title function_ invoke__">clone</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">circle_with_vulkan</span> = Circle &#123;</span><br><span class="line">        renderer: vulkan_renderer.<span class="title function_ invoke__">clone</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rectangle_with_vulkan</span> = Rectangle &#123;</span><br><span class="line">        renderer: vulkan_renderer.<span class="title function_ invoke__">clone</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    circle_with_opengl.<span class="title function_ invoke__">draw</span>();</span><br><span class="line">    rectangle_with_opengl.<span class="title function_ invoke__">draw</span>();</span><br><span class="line"></span><br><span class="line">    circle_with_vulkan.<span class="title function_ invoke__">draw</span>();</span><br><span class="line">    rectangle_with_vulkan.<span class="title function_ invoke__">draw</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="桥接模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象部分：形状接口</span></span><br><span class="line"><span class="keyword">type</span> Shape <span class="keyword">interface</span> &#123;</span><br><span class="line">    Draw()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体形状实现：圆形</span></span><br><span class="line"><span class="keyword">type</span> Circle <span class="keyword">struct</span> &#123;</span><br><span class="line">    Renderer Renderer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Circle)</span></span> Draw() &#123;</span><br><span class="line">    c.Renderer.RenderCircle()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体形状实现：矩形</span></span><br><span class="line"><span class="keyword">type</span> Rectangle <span class="keyword">struct</span> &#123;</span><br><span class="line">    Renderer Renderer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Rectangle)</span></span> Draw() &#123;</span><br><span class="line">    r.Renderer.RenderRectangle()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现部分：渲染器接口</span></span><br><span class="line"><span class="keyword">type</span> Renderer <span class="keyword">interface</span> &#123;</span><br><span class="line">    RenderCircle()</span><br><span class="line">    RenderRectangle()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体渲染器实现：OpenGL渲染器</span></span><br><span class="line"><span class="keyword">type</span> OpenGLRenderer <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *OpenGLRenderer)</span></span> RenderCircle() &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;使用OpenGL渲染圆形&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *OpenGLRenderer)</span></span> RenderRectangle() &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;使用OpenGL渲染矩形&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体渲染器实现：Vulkan渲染器</span></span><br><span class="line"><span class="keyword">type</span> VulkanRenderer <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *VulkanRenderer)</span></span> RenderCircle() &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;使用Vulkan渲染圆形&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *VulkanRenderer)</span></span> RenderRectangle() &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;使用Vulkan渲染矩形&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    openglRenderer := &amp;OpenGLRenderer&#123;&#125;</span><br><span class="line">    vulkanRenderer := &amp;VulkanRenderer&#123;&#125;</span><br><span class="line"></span><br><span class="line">    circleWithOpenGL := &amp;Circle&#123;</span><br><span class="line">        Renderer: openglRenderer,</span><br><span class="line">    &#125;</span><br><span class="line">    rectangleWithOpenGL := &amp;Rectangle&#123;</span><br><span class="line">        Renderer: openglRenderer,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    circleWithVulkan := &amp;Circle&#123;</span><br><span class="line">    Renderer: vulkanRenderer,</span><br><span class="line">    &#125;</span><br><span class="line">    rectangleWithVulkan := &amp;Rectangle&#123;</span><br><span class="line">    Renderer: vulkanRenderer,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    circleWithOpenGL.Draw()</span><br><span class="line">    rectangleWithOpenGL.Draw()</span><br><span class="line"></span><br><span class="line">    circleWithVulkan.Draw()</span><br><span class="line">    rectangleWithVulkan.Draw()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="组合模式"><a class="markdownIt-Anchor" href="#组合模式"></a> 组合模式</h4>
<p>组合模式有着非常鲜明的特色，<span style="color:red"><strong>它将对象组合成树形结构来表示部分与整体的关系，其中单个对象形成的叶子节点和由单个对象共同组合成的树枝节点都会实现相同的接口，这使得客户端可以对它们一视同仁，常用于文件系统的表示以及树结构的表示</strong></span>。</p>
<p>该模式具有以下的适用场景（但不局限于此）：</p>
<ul>
<li>文件系统：文件系统是典型的树形结构，文件和文件夹可以看作是组合模式中的对象。文件相当于叶子节点，文件夹相当于组合节点，文件夹可以包含文件和其他文件夹。通过使用组合模式，在遍历文件系统、计算文件大小总和、权限管理等操作时，可以用统一的方式处理文件和文件夹，而不需要针对文件和文件夹分别编写不同的处理逻辑。</li>
<li>组织结构图：企业或组织的组织结构通常呈现出树形结构，员工可以看作是叶子节点，部门可以看作是组合节点，部门可以包含员工以及其他子部门。采用组合模式，在进行人员统计、权限分配、组织架构展示等操作时，能够以相同的方式对待员工和部门，简化了代码逻辑和处理流程。</li>
</ul>
<p>该模式具有如下特点：</p>
<ul>
<li>统一处理：客户端可以用相同的操作方式处理单个对象（叶子节点）和组合对象（树枝节点），无需关心对象的具体类型是单个还是组合的，提高了代码的简洁性和可维护性。</li>
<li>树形结构表示：以树形结构清晰地表示出 “部分 - 整体” 的层次关系，便于理解和管理复杂的对象关系，如文件系统中的文件与文件夹的嵌套关系、组织结构图中的员工与部门的隶属关系等。</li>
<li>递归处理：由于对象组合成树形结构，很多操作（如遍历、计算等）往往需要采用递归的方式进行，这种递归处理方式能够自然地适应组合模式的树形结构特点，有效地处理各级对象。</li>
</ul>
<p>组合模式遵循以下设计原则：</p>
<ul>
<li>开闭原则：对扩展开放，对修改关闭。当需要添加新的类型的对象（如在文件系统中新增一种特殊文件类型，或在组织结构图中新增一种特殊部门类型）时，只需创建新的类实现相应的接口或继承自相关基类，并按照组合模式的结构进行组合即可，无需修改现有的客户端代码和核心处理逻辑。</li>
<li>依赖倒置原则：高层模块（如进行文件系统操作或组织架构管理的客户端代码）不依赖于低层模块（具体的文件、文件夹、员工、部门等对象的实现）的具体实现，而是依赖于抽象（抽象的组件接口、文件或员工等的抽象类或接口）。这样可以提高代码的灵活性，便于在不同场景下替换不同的具体对象实现，而不影响客户端代码的正常运行。</li>
</ul>
<p>如下是示例代码的UML示意图：</p>
<p><img data-src="//www.plantuml.com/plantuml/png/SoWkIImgAStDuL9NUDQrzyN6XSztjppPlUrPtzAd_OkvClDAKelI4fDJ5PppSmloyrBpIXIgkHI08ByWjIYn93C_JqEJgnQe-Md_jgTh9xpeQdhUjFFzdbdFfhK3JU5ApaaiBbPmoyn9XMhJpalCJRLI22ufoinBXuYWcmHqmDC97MWcFLso4sPOVavAQX5kuv8pCdDIYbBph11EZex5PXF8qQsRds_UpGLodvvUZHsI9wqKdgwRzxnl0nV4Eloo2bgwkiYoK2-ytzC1T_pJdjQd4rP3mXQezyc-xcTJDm2vx_VqFDax6MZKo-OLJplQ57GLdatT0XI1kEpzdaukXzIy563y0000" alt="链接" /></p>
<div class="tabs" id="组合模式"><ul class="nav-tabs"><li class="tab active"><a href="#组合模式-1">Rust</a></li><li class="tab"><a href="#组合模式-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="组合模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象组件接口，用于统一处理叶子节点和组合节点</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">operation</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 叶子节点：文件</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">File</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Component</span> <span class="keyword">for</span> <span class="title class_">File</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">operation</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;正在处理文件: &#123;&#125;&quot;</span>, <span class="keyword">self</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合节点：文件夹</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Folder</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">    children: <span class="type">Vec</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Component&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Component</span> <span class="keyword">for</span> <span class="title class_">Folder</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">operation</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;正在处理文件夹: &#123;&#125;&quot;</span>, <span class="keyword">self</span>.name);</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">child</span> <span class="keyword">in</span> &amp;<span class="keyword">self</span>.children &#123;</span><br><span class="line">            child.<span class="title function_ invoke__">operation</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">file1</span> = File &#123;</span><br><span class="line">        name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;file1.txt&quot;</span>),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">file2</span> = File &#123;</span><br><span class="line">        name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;file2.txt&quot;</span>),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">folder1</span> = Folder &#123;</span><br><span class="line">        name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;folder1&quot;</span>),</span><br><span class="line">        children: <span class="built_in">vec!</span>[</span><br><span class="line">            <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(file1),</span><br><span class="line">            <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(file2),</span><br><span class="line">        ],</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">file3</span> = File &#123;</span><br><span class="line">        name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;file3.txt&quot;</span>),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">folder2</span> = Folder &#123;</span><br><span class="line">        name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;folder2&quot;</span>),</span><br><span class="line">        children: <span class="built_in">vec!</span>[</span><br><span class="line">            <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(folder1),</span><br><span class="line">            <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(file3),</span><br><span class="line">        ],</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    folder2.<span class="title function_ invoke__">operation</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="组合模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象组件接口，用于统一处理叶子节点和组合节点</span></span><br><span class="line"><span class="keyword">type</span> Component <span class="keyword">interface</span> &#123;</span><br><span class="line">    Operation()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 叶子节点：文件</span></span><br><span class="line"><span class="keyword">type</span> File <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span></span> Operation() &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;正在处理文件: %s\n&quot;</span>, f.Name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合节点：文件夹</span></span><br><span class="line"><span class="keyword">type</span> Folder <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name     <span class="type">string</span></span><br><span class="line">    Children []Component</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *Folder)</span></span> Operation() &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;正在处理文件夹: %s\n&quot;</span>, f.Name)</span><br><span class="line">    <span class="keyword">for</span> _, child := <span class="keyword">range</span> f.Children &#123;</span><br><span class="line">    child.Operation()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    file1 := &amp;File&#123;</span><br><span class="line">        Name: <span class="string">&quot;file1.txt&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    file2 := &amp;File&#123;</span><br><span class="line">        Name: <span class="string">&quot;file2.txt&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    folder1 := &amp;Folder&#123;</span><br><span class="line">        Name: <span class="string">&quot;folder1&quot;</span>,</span><br><span class="line">        Children: []Component&#123;</span><br><span class="line">            file1,</span><br><span class="line">            file2,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    file3 := &amp;File&#123;</span><br><span class="line">        Name: <span class="string">&quot;file3.txt&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    folder2 := &amp;Folder&#123;</span><br><span class="line">        Name: <span class="string">&quot;folder2&quot;</span>,</span><br><span class="line">        Children: []Component&#123;</span><br><span class="line">            folder1,</span><br><span class="line">            file3,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    folder2.Operation()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="装饰器模式"><a class="markdownIt-Anchor" href="#装饰器模式"></a> 装饰器模式</h4>
<p>Python中的装饰器就是该模式的一个实现场景，<span style="color:red"><strong>装饰器设计模式允许在不改变原有对象结构和行为的基础上，动态地给对象添加额外的功能，通过将功能的扩展从对象本身的类中分离出来，使用装饰器类来包裹原始对象，从而实现对对象功能的逐步增强</strong></span>。</p>
<p>该模式具有以下的应用场景：</p>
<ul>
<li>输入输出流处理：在处理文件读写、网络数据传输等场景中，例如对文件读取操作，可能需要在基本的读取功能基础上，添加缓存功能以提高读取效率，或者添加加密功能以保证数据安全。可以使用装饰器模式，将缓存、加密等功能作为装饰器添加到基本的文件读取流对象上，而无需修改原有的文件读取类。</li>
<li>图形绘制扩展：在图形绘制系统中，对于基本的图形绘制对象，如绘制一个简单的圆形，可能后续需要添加额外的效果，比如给圆形添加阴影效果、发光效果等。通过装饰器模式，可以将这些额外效果的实现作为装饰器，动态地添加到基本的圆形绘制对象上，灵活地扩展图形的绘制功能。</li>
</ul>
<p>该模式具有以下特点：</p>
<ul>
<li>动态扩展功能：能够在运行时根据需要动态地给对象添加新的功能，而不是在编译时就确定好所有功能。这使得系统更加灵活，可以根据不同的使用场景和需求灵活组合各种功能。</li>
<li>保持对象接口一致性：装饰器类和被装饰的原始对象实现相同的接口，这样对于客户端来说，无论是使用原始对象还是经过装饰后的对象，调用方式都是一样的，不需要对客户端代码进行修改来适应装饰后的对象。</li>
<li>可叠加性：可以将多个装饰器依次应用到一个对象上，实现多种功能的叠加。例如，既可以给文件读取流添加缓存装饰器，又可以在其上再添加加密装饰器，从而实现既有缓存又有加密的文件读取功能。</li>
</ul>
<p>遵循以下设计原则：</p>
<ul>
<li>开闭原则：对扩展开放，对修改关闭。当需要添加新的功能时，只需创建新的装饰器类实现与原始对象相同的接口，并在装饰器类中实现新的功能逻辑，而不需要修改原始对象的类以及使用该对象的客户端代码。</li>
<li>单一职责原则：每个装饰器类只负责添加一种特定的功能，使得功能的扩展更加清晰和易于维护。例如，缓存装饰器只负责处理缓存相关的逻辑，加密装饰器只负责加密相关的逻辑。</li>
</ul>
<p>如下是装饰器模式的UML类图，<code>LoggingDecorator</code>以及<code>CachingDecorator</code>这两个装饰器和被装饰的对象<code>NetworkRequest</code>一样都实现了相同的接口<code>Component</code>，这样在不改变<code>Compinent</code>内部逻辑的情况下就可以为它增加新的功能：<br />
<img data-src="//www.plantuml.com/plantuml/png/SoWkIImgAStDuL9NUDQrzyN6XSztjppPlUrPtzAd_OkvClDAKelI4fDJ5PppSmloyrBpIXIgkHI08BKYDRcq95L3awiMgFLfw_OdUoT3j78bvoGM5olufPQKvnTb1wKMbgOMmtHfbnRbM2a4bnHbvgL3179JIpBoKr35aCo6E-l5ujQNIpSydRa2oKqkgSdvHOab-KLGqzDJI-AJOUxKqBH2E1gda-76ljypwzdstK-x5ZpVC_dfsXbFk-Q_QDuBzOfpOd86q77ercd3xKAo2Ie3r95gfU2HM9pXcrXW0_6S3jIJTX0r15ohJPnpdqrV-dJ_z1VhDZpTEnN5qJxvwUd4Effq1u5TjFdvvjrSgF6ifrTZXvHMh1IUhfltl6y35teGubA7xcgIp8FpqCqZh0uZYdLrqUnjtVoYSShxFHtmA7ZMq_XiJkUBHQkX8kjt0fCfqBWd-xhVx-a4sqnT4nrIyrA0EHK0" alt="" /></p>
<div class="tabs" id="装饰器模式"><ul class="nav-tabs"><li class="tab active"><a href="#装饰器模式-1">Rust</a></li><li class="tab"><a href="#装饰器模式-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="装饰器模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象组件接口，被装饰对象和装饰器都要实现这个接口</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Component</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">execute</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_cache_key</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体组件：代表一个基础的网络请求操作</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NetworkRequest</span> &#123;</span><br><span class="line">    url: <span class="type">String</span>,</span><br><span class="line">    method: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Component</span> <span class="keyword">for</span> <span class="title class_">NetworkRequest</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">execute</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;正在执行网络请求：&#123;&#125; - &#123;&#125;&quot;</span>, <span class="keyword">self</span>.method, <span class="keyword">self</span>.url)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_cache_key</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">format!</span>(<span class="string">&quot;&#123;&#125;-&#123;&#125;&quot;</span>, <span class="keyword">self</span>.method, <span class="keyword">self</span>.url)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象装饰器，实现Component接口，并持有一个Component类型的对象</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Decorator</span>: Component &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_component</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">dyn</span> Component;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体装饰器：添加缓存功能</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CachingDecorator</span> &#123;</span><br><span class="line">    component: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Component&gt;,</span><br><span class="line">    cache: std::collections::HashMap&lt;<span class="type">String</span>, <span class="type">String</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Decorator</span> <span class="keyword">for</span> <span class="title class_">CachingDecorator</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_component</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">dyn</span> Component &#123;</span><br><span class="line">        <span class="keyword">self</span>.component.<span class="title function_ invoke__">as_ref</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Component</span> <span class="keyword">for</span> <span class="title class_">CachingDecorator</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">execute</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">result</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">cache_key</span> = <span class="keyword">self</span>.component.<span class="title function_ invoke__">get_cache_key</span>();</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(cached_result) = <span class="keyword">self</span>.cache.<span class="title function_ invoke__">get</span>(&amp;cache_key) &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;从缓存中获取结果：&#123;&#125;&quot;</span>, cached_result);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result = <span class="keyword">self</span>.component.<span class="title function_ invoke__">execute</span>();</span><br><span class="line">            <span class="keyword">self</span>.cache.<span class="title function_ invoke__">insert</span>(cache_key.<span class="title function_ invoke__">clone</span>(), result.<span class="title function_ invoke__">clone</span>());</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;缓存新结果：&#123;&#125;&quot;</span>, result);</span><br><span class="line">        &#125;</span><br><span class="line">        result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_cache_key</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.component.<span class="title function_ invoke__">get_cache_key</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体装饰器：添加日志记录功能</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LoggingDecorator</span> &#123;</span><br><span class="line">    component: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Component&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Decorator</span> <span class="keyword">for</span> <span class="title class_">LoggingDecorator</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_component</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">dyn</span> Component &#123;</span><br><span class="line">        <span class="keyword">self</span>.component.<span class="title function_ invoke__">as_ref</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Component</span> <span class="keyword">for</span> <span class="title class_">LoggingDecorator</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">execute</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;开始执行操作，时间：&#123;&#125;&quot;</span>, chrono::Local::<span class="title function_ invoke__">now</span>());</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">result</span> = <span class="keyword">self</span>.component.<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;操作执行完毕，时间：&#123;&#125;&quot;</span>, chrono::Local::<span class="title function_ invoke__">now</span>());</span><br><span class="line">        result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_cache_key</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.component.<span class="title function_ invoke__">get_cache_key</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">network_request</span> = NetworkRequest &#123;</span><br><span class="line">        url: <span class="string">&quot;https://example.com/api/data&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        method: <span class="string">&quot;GET&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">cached_network_request</span> = CachingDecorator &#123;</span><br><span class="line">        component: <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(network_request),</span><br><span class="line">        cache: std::collections::HashMap::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">logged_cached_network_request</span> = LoggingDecorator &#123;</span><br><span class="line">        component: <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(cached_network_request),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    logged_cached_network_request.<span class="title function_ invoke__">execute</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这将输出：</p>
<pre><code>开始执行操作，时间：2024-11-20 19:52:39.739845100 +08:00
缓存新结果：正在执行网络请求：GET - https://example.com/api/data
操作执行完毕，时间：2024-11-20 19:52:39.740418900 +08:00
</code></pre></div><div class="tab-pane" id="装饰器模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象组件接口，被装饰对象和装饰器都要实现这个接口</span></span><br><span class="line"><span class="keyword">type</span> Component <span class="keyword">interface</span> &#123;</span><br><span class="line">	Execute()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体组件：代表一个基础的网络请求操作</span></span><br><span class="line"><span class="keyword">type</span> NetworkRequest <span class="keyword">struct</span> &#123;</span><br><span class="line">	URL    <span class="type">string</span></span><br><span class="line">	Method <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *NetworkRequest)</span></span> Execute() &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;正在执行网络请求：%s - %s\n&quot;</span>, n.Method, n.URL)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象装饰器，实现Component接口，并持有一个Component类型的对象</span></span><br><span class="line"><span class="keyword">type</span> Decorator <span class="keyword">interface</span> &#123;</span><br><span class="line">	Component</span><br><span class="line">	GetComponent() Component</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体装饰器：添加缓存功能</span></span><br><span class="line"><span class="keyword">type</span> CachingDecorator <span class="keyword">struct</span> &#123;</span><br><span class="line">	Component Component</span><br><span class="line">	Cache     <span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CachingDecorator)</span></span> GetComponent() Component &#123;</span><br><span class="line">	<span class="keyword">return</span> c.Component</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *CachingDecorator)</span></span> Execute() &#123;</span><br><span class="line">	cacheKey := fmt.Sprintf(<span class="string">&quot;%v-%s&quot;</span>, c.Component.(*NetworkRequest).Method, c.Component.(*NetworkRequest).URL)</span><br><span class="line">	<span class="keyword">if</span> result, ok := c.Cache[cacheKey]; ok &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;从缓存中获取结果：%s\n&quot;</span>, result)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.Component.Execute()</span><br><span class="line">		result := <span class="string">&quot;模拟网络请求结果&quot;</span></span><br><span class="line">		c.Cache[cacheKey] = result</span><br><span class="line">		fmt.Printf(<span class="string">&quot;缓存新结果：%s\n&quot;</span>, result)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体装饰器：添加日志记录功能</span></span><br><span class="line"><span class="keyword">type</span> LoggingDecorator <span class="keyword">struct</span> &#123;</span><br><span class="line">	Component Component</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LoggingDecorator)</span></span> GetComponent() Component &#123;</span><br><span class="line">	<span class="keyword">return</span> l.Component</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LoggingDecorator)</span></span> Execute() &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;开始执行操作，时间：%v\n&quot;</span>, time.Now())</span><br><span class="line">	l.Component.Execute()</span><br><span class="line">	fmt.Printf(<span class="string">&quot;操作执行完毕，时间：%v\n&quot;</span>, time.Now())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	networkRequest := &amp;NetworkRequest&#123;</span><br><span class="line">		URL:    <span class="string">&quot;https://example.com/api/data&quot;</span>,</span><br><span class="line">		Method: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cachedNetworkRequest := &amp;CachingDecorator&#123;</span><br><span class="line">		Component: networkRequest,</span><br><span class="line">		Cache:     <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">string</span>),</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	loggedCachingNetworkRequest := &amp;LoggingDecorator&#123;</span><br><span class="line">		Component: cachedNetworkRequest,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	loggedCachingNetworkRequest.Execute()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="外观模式"><a class="markdownIt-Anchor" href="#外观模式"></a> 外观模式</h4>
<p>外观模式也叫门面模式，<span style="color:red"><strong>其外观含义来源于建筑学中的“Facade”，表示建筑物的表面或者正面，我们看到的精美的建筑物的表面都将其内部的钢筋水泥等复杂结构都隐藏起来了（想起一句话：驴粪蛋子表面光）。在软件设计领域中，外观模式用于隐藏子系统内部的复杂性和细节，客户端只需要和外观接口进行交互，而不用知道这个外观背后子系统的复杂操作和相互关系，就如同为复杂的机器设备提供了一个简单易用的控制面板，用户通过控制面板上的几个按钮就能完成一系列复杂的操作，而不需要深入了解机器内部各个零部件的具体运作原理</strong></span>。</p>
<p>该模式具有以下应用场景：</p>
<ul>
<li>复杂系统集成：当需要将多个不同的子系统集成在一起使用时，这些子系统可能各自具有复杂的接口和交互逻辑。例如，在一个智能家居系统中，包含了照明系统、温度控制系统、安防系统等多个子系统，每个子系统都有自己的一套控制接口和操作方式。通过使用外观设计模式，可以创建一个智能家居外观类，为用户提供诸如 “开启家居模式”“关闭家居模式” 等简单统一的操作接口，在这些接口的实现中协调各个子系统的具体操作，使得用户无需分别了解每个子系统的详细控制方法就能方便地控制整个智能家居系统。</li>
<li>简化第三方库使用：在使用一些功能强大但接口复杂的第三方库时，为了让项目中的其他开发人员能够更轻松地使用这些库的功能，可以应用外观设计模式。比如，一个图像处理库可能提供了众多用于图像加载、处理、保存等的细粒度接口，但对于项目中只需要进行一些基本图像处理操作（如加载图像、调整亮度、保存图像）的开发人员来说，这些接口过于复杂。此时可以创建一个外观类，将这些基本操作封装成几个简单的方法，如 “简单处理图像” 方法，在这个方法内部调用图像处理库的相关接口来完成一系列操作，这样其他开发人员只需调用外观类的简单方法即可，无需深入了解图像处理库的复杂接口。</li>
</ul>
<p>该模式具有以下特点：</p>
<ul>
<li>简化接口：提供了一个简洁、统一的接口给客户端，隐藏了子系统的复杂性，降低了客户端使用子系统的难度，使得客户端代码更加简洁明了，易于理解和维护。</li>
<li>解耦客户端与子系统：客户端只依赖于外观类，而不直接依赖于子系统中的各个具体类，这样当子系统内部发生变化（如某个子系统的接口修改、新增或删除某个子系统等）时，只要外观类的接口保持不变，客户端代码通常不需要进行大量修改，提高了系统的可维护性和可扩展性。</li>
<li>封装子系统逻辑：在外观类中封装了子系统的复杂逻辑和交互过程，将原本分散在多个子系统中的操作整合在一起，按照一定的业务逻辑顺序进行调用，使得整个系统的业务流程更加清晰，便于管理和控制。</li>
</ul>
<p>该模式遵循以下设计原则：</p>
<ul>
<li>迪米特法则：只与你的直接朋友交流，不与“陌生人”交谈。外观模式通过提供一个简化的接口，减少了客户端与子系统之间的交互。</li>
<li>单一职责原则：外观类具有单一职责，即提供子系统的简化接口。</li>
</ul>
<p>如下是外观模式代码示例的类图呈现，通过<code>SmartHomeFacade</code>这个门面提供的几个简单方法，就可以操作照明、温控以及安防系统，而不用详细了解这些系统如何实现：</p>
<p><img data-src="//www.plantuml.com/plantuml/png/XL8_IyD05D_pAR9PaGwsMmOf2EBWLlTmDgzj99UJkyjGn46XqAAK3YB5GHUnY5ZGWeWjVXglgLE_Wg-cqUHgIRPxx-Ntv_TUIKZ2PK0zOyrKJzrmE0f7jvkpyNNOx4zwdUXjL3mYXBddrkhIzMlbXf10pMF3n6_35JRpBVE0CIygo83xMCgj9v_LAhvFaYG599cyFQZt-qcdhrglAQfze4V02VuBsyoNd7bfqah0EVZIbdzpbbaj5XQKXDTWLLDWPtaW5vL-vXR2YNCOYDIGRg685jIW_TLxIOal0yfpPMCf9y8fECcei137vBW2Np73tTMqVnO-Zs94YalQPHHsI8Ku44DwYuLOscgYRjB-oa3ZJ2B5bgOzjL2xZW9ioXpGLvlieFwvWUOG8p5qtVdybdv5rdnsUdev6xT-NQkBfke-9YzG3Mu-Fyvdu_Q_aClcCi6roykaY7F918xkGOSiWUy4rFi6" alt="链接" /></p>
<div class="tabs" id="外观设计模式"><ul class="nav-tabs"><li class="tab active"><a href="#外观设计模式-1">Rust</a></li><li class="tab"><a href="#外观设计模式-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="外观设计模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子系统1：照明系统</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LightingSystem</span> &#123;</span><br><span class="line">    is_on: <span class="type">bool</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">LightingSystem</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        LightingSystem &#123; is_on: <span class="literal">false</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">turn_on</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.is_on = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;照明系统已开启&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">turn_off</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.is_on = <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;照明系统已关闭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子系统2：温度控制系统</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TemperatureControlSystem</span> &#123;</span><br><span class="line">    current_temperature: <span class="type">f32</span>,</span><br><span class="line">    target_temperature: <span class="type">f32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">TemperatureControlSystem</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        TemperatureControlSystem &#123;</span><br><span class="line">            current_temperature: <span class="number">25.0</span>,</span><br><span class="line">            target_temperature: <span class="number">22.0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_target_temperature</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, target: <span class="type">f32</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.target_temperature = target;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;设置目标温度为 &#123;&#125;&quot;</span>, target);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">adjust_temperature</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.current_temperature &gt; <span class="keyword">self</span>.target_temperature &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;温度控制系统正在降温&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">self</span>.current_temperature &lt; <span class="keyword">self</span>.target_temperature &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;温度控制系统正在升温&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;温度已达到目标温度&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子系统3：安防系统</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SecuritySystem</span> &#123;</span><br><span class="line">    is_armed: <span class="type">bool</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">SecuritySystem</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        SecuritySystem &#123; is_armed: <span class="literal">false</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">arm</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.is_armed = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;安防系统已设防&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">disarm</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.is_armed = <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;安防系统已撤防&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 外观类</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">SmartHomeFacade</span> &#123;</span><br><span class="line">    lighting: LightingSystem,</span><br><span class="line">    temperature: TemperatureControlSystem,</span><br><span class="line">    security: SecuritySystem,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">SmartHomeFacade</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        SmartHomeFacade &#123;</span><br><span class="line">            lighting: LightingSystem::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">            temperature: TemperatureControlSystem::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">            security: SecuritySystem::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">turn_on_home_mode</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.lighting.<span class="title function_ invoke__">turn_on</span>();</span><br><span class="line">        <span class="keyword">self</span>.temperature.<span class="title function_ invoke__">set_target_temperature</span>(<span class="number">22.0</span>);</span><br><span class="line">        <span class="keyword">self</span>.security.<span class="title function_ invoke__">arm</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">turn_off_home_mode</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.lighting.<span class="title function_ invoke__">turn_off</span>();</span><br><span class="line">        <span class="keyword">self</span>.temperature.<span class="title function_ invoke__">set_target_temperature</span>(<span class="number">25.0</span>);</span><br><span class="line">        <span class="keyword">self</span>.security.<span class="title function_ invoke__">disarm</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">smart_home</span> = SmartHomeFacade::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    smart_home.<span class="title function_ invoke__">turn_on_home_mode</span>();</span><br><span class="line"></span><br><span class="line">    smart_home.<span class="title function_ invoke__">turn_off_home_mode</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="外观设计模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 子系统1：照明系统</span></span><br><span class="line"><span class="keyword">type</span> LightingSystem <span class="keyword">struct</span> &#123;</span><br><span class="line">    IsOn <span class="type">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewLightingSystem</span><span class="params">()</span></span> *LightingSystem &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;LightingSystem&#123;IsOn: <span class="literal">false</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LightingSystem)</span></span> TurnOn() &#123;</span><br><span class="line">    l.IsOn = <span class="literal">true</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;照明系统已开启&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *LightingSystem)</span></span> TurnOff() &#123;</span><br><span class="line">    l.IsOn = <span class="literal">false</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;照明系统已关闭&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子系统2：温度控制系统</span></span><br><span class="line"><span class="keyword">type</span> TemperatureControlSystem <span class="keyword">struct</span> &#123;</span><br><span class="line">    CurrentTemperature <span class="type">float32</span></span><br><span class="line">    TargetTemperature  <span class="type">float32</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewTemperatureControlSystem</span><span class="params">()</span></span> *TemperatureControlSystem &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;TemperatureControlSystem&#123;</span><br><span class="line">        CurrentTemperature: <span class="number">25.0</span>,</span><br><span class="line">        TargetTemperature:  <span class="number">22.0</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *TemperatureControlSystem)</span></span> SetTargetTemperature(target <span class="type">float32</span>) &#123;</span><br><span class="line">    t.TargetTemperature = target</span><br><span class="line">    fmt.Println(<span class="string">&quot;设置目标温度为&quot;</span>, target)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *TemperatureControlSystem)</span></span> AdjustTemperature() &#123;</span><br><span class="line">    <span class="keyword">if</span> t.CurrentTemperature &gt; t.TargetTemperature &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;温度控制系统正在降温&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> t.CurrentTemperature &lt; t.TargetTemperature &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;温度控制系统正在升温&quot;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;温度已达到目标温度&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子系统3：安防系统</span></span><br><span class="line"><span class="keyword">type</span> SecuritySystem <span class="keyword">struct</span> &#123;</span><br><span class="line">    IsArmed <span class="type">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSecuritySystem</span><span class="params">()</span></span> *SecuritySystem &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;SecuritySystem&#123;IsArmed: <span class="literal">false</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SecuritySystem)</span></span> Arm() &#123;</span><br><span class="line">    s.IsArmed = <span class="literal">true</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;安防系统已设防&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SecuritySystem)</span></span> Disarm() &#123;</span><br><span class="line">    s.IsArmed = <span class="literal">false</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;安防System已撤防&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 外观类</span></span><br><span class="line"><span class="keyword">type</span> SmartHomeFacade <span class="keyword">struct</span> &#123;</span><br><span class="line">    Lighting    *LightingSystem</span><br><span class="line">    Temperature *TemperatureControlSystem</span><br><span class="line">    Security    *SecuritySystem</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSmartHomeFacade</span><span class="params">()</span></span> *SmartHomeFacade &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;SmartHomeFacade&#123;</span><br><span class="line">        Lighting:    NewLightingSystem(),</span><br><span class="line">        Temperature: NewTemperatureControlSystem(),</span><br><span class="line">        Security:    NewSecuritySystem(),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartHomeFacade)</span></span> TurnOnHomeMode() &#123;</span><br><span class="line">    s.Lighting.TurnOn()</span><br><span class="line">    s.Temperature.SetTargetTemperature(<span class="number">22.0</span>)</span><br><span class="line">    s.Security.Arm()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SmartHomeFacade)</span></span> TurnOffHomeMode() &#123;</span><br><span class="line">    s.Lighting.TurnOff()</span><br><span class="line">    s.Temperature.SetTargetTemperature(<span class="number">25.0</span>)</span><br><span class="line">    s.Security.Disarm()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    smartHome := NewSmartHomeFacade()</span><br><span class="line"></span><br><span class="line">    smartHome.TurnOnHomeMode()</span><br><span class="line"></span><br><span class="line">    smartHome.TurnOffHomeMode()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="享元模式"><a class="markdownIt-Anchor" href="#享元模式"></a> 享元模式</h4>
<p>享元模式的<span style="color:red"><strong>核心思想通过共享对象来减少内存使用以提高性能，在应用上将对象分为内部状态和外部状态，内部状态可共享，外部状态依赖具体场景变化，过在运行时将外部状态传递给共享对象来实现不同场景下的特定功能。这样可以避免创建大量相似的对象，而是共享那些具有相同内部状态的对象，从而节省内存空间。例如，游戏地图中的草，长得都一样，只是位置不一样，有些在河道，有些在河边，草的颜色、形态就是对象的内部状态，草的位置就是外部状态</strong></span>。</p>
<p>该模式具有以下应用场景：</p>
<ul>
<li>图形绘制系统：在图形绘制应用中，比如绘制一幅地图，地图上可能有大量相同类型的图形元素，如众多的树木图标、建筑物图标等。这些图标在外观和基本属性上是相同的（内部状态相同），只是在地图中的位置等信息不同（外部状态不同）。使用享元设计模式，可以创建一个图形元素的享元对象池，将相同类型的图形元素共享使用，只在绘制时根据具体位置等外部状态信息进行相应的绘制操作，大大减少了内存中图形对象的数量，提高了绘制效率。</li>
<li>文本处理系统：在处理文档排版等文本处理任务时，可能会频繁使用到一些相同样式的字符格式，如某种字体、字号、颜色的文字。这些具有相同样式的文字可以看作是具有相同内部状态的对象，而它们在文档中的具体位置则是外部状态。通过享元设计模式，创建一个字符格式的享元对象池，共享这些相同样式的字符格式对象，在排版时根据文字在文档中的具体位置等外部状态来应用相应的格式，既能节省内存，又能提高文本处理的效率。</li>
</ul>
<p>该模式具有以下特点：</p>
<ul>
<li>共享对象：通过识别对象可共享的内部状态，将具有相同内部状态的对象进行共享，避免了重复创建大量相似对象，有效减少了内存占用。</li>
<li>分离状态：明确区分对象的内部状态和外部状态，内部状态存储在共享对象中，外部状态在运行时传递给共享对象，使得共享对象能够根据不同的外部状态实现多样化的功能。</li>
<li>提高性能：由于减少了对象的创建数量，降低了内存开销，同时在某些情况下（如频繁创建和销毁相似对象的场景）还能减少对象创建和销毁的时间开销，从而提高了系统的整体性能。</li>
</ul>
<p>遵循以下设计原则：</p>
<ul>
<li>单一职责原则：享元模式通过分离内部状态和外部状态，使得享元对象只负责内部状态的管理，符合单一职责原则。</li>
<li>开闭原则：享元模式通过扩展内部状态来适应新的需求，而不需要修改现有的享元对象，符合开闭原则。</li>
</ul>
<p>以下是享元模式代码示意图的UML类图，通过享元工厂<code>FlyweightFactory</code>来管理享元对象，在客户端代码中将不同的<code>Flyweight</code>部署到不同的位置：</p>
<p><img data-src="//www.plantuml.com/plantuml/png/ZP9T2z9G6CVlpwSuTzdB_00IuatMJLTz03cieuxcbEr8IGcPpLR8b58l9eGMWY1OCi5yiRwCppQl_0eT7NCw2ThLTixpxFTx_ZmfZH6LbGiokeDtgmdeTVYnz6P3rthlVDho5ySSGUixaXH6rImHAKxBbPTKokKPVeqmVuebgX8c5PKOVSLKIT4aCQCnmcW2Fpj-v-wYAlyvw8lTziibuh2neFyRjj_uYJiV-5T8b8ccuSSgAUKbyP5C2rHXKUJzaur2v6kGV_T_Fi6mYn6OxmwRfjiPxrOc67rOh-1pqvqEtNRZqjQP3NotC80q4LbHhGHIsU1SI-0dHCi_9QM7Fl51s9FqQtEKPSxriHUqSfR3YR0OLT4fETkrr-WVaSJZRv9X1--6wLVN_8bkB0KXKgVRNgrps1YNITpEpRFPlxMyFnyySm6jdjDREdOtwFruYxad25SOhsP1suXWeAb3UnA9bvFuXd1tfpi_hielSryVWz7mvp_2KbHvNYx8Vm40" alt="链接" /></p>
<div class="tabs" id="享元设计模式"><ul class="nav-tabs"><li class="tab active"><a href="#享元设计模式-1">Rust</a></li><li class="tab"><a href="#享元设计模式-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="享元设计模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 享元对象的抽象接口</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Flyweight</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">operation</span>(&amp;<span class="keyword">self</span>, extrinsic_state: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> ();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体享元对象：图形元素享元</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GraphicElementFlyweight</span> &#123;</span><br><span class="line">    internal_state: <span class="type">String</span>,</span><br><span class="line">    <span class="comment">// 假设这里可以存储图形元素的一些基本属性，如颜色、形状等</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Flyweight</span> <span class="keyword">for</span> <span class="title class_">GraphicElementFlyweight</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">operation</span>(&amp;<span class="keyword">self</span>, extrinsic_state: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> () &#123;</span><br><span class="line">        <span class="built_in">println!</span>(</span><br><span class="line">            <span class="string">&quot;使用内部状态 &#123;&#125; 并结合外部状态 &#123;&#125; 进行图形元素操作&quot;</span>,</span><br><span class="line">            <span class="keyword">self</span>.internal_state, extrinsic_state</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 享元工厂，用于创建和管理享元对象池</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FlyweightFactory</span> &#123;</span><br><span class="line">    flyweights: HashMap&lt;<span class="type">String</span>, <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Flyweight&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">FlyweightFactory</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        FlyweightFactory &#123;</span><br><span class="line">            flyweights: HashMap::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_flyweight</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, key: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> &amp;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Flyweight&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span>.flyweights.<span class="title function_ invoke__">entry</span>(key.<span class="title function_ invoke__">to_string</span>()).<span class="title function_ invoke__">or_insert</span>(<span class="keyword">match</span> key &#123;</span><br><span class="line">            <span class="string">&quot;tree&quot;</span> =&gt; <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(GraphicElementFlyweight &#123;</span><br><span class="line">                internal_state: <span class="string">&quot;绿色圆形图标&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="string">&quot;building&quot;</span> =&gt; <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(GraphicElementFlyweight &#123;</span><br><span class="line">                internal_state: <span class="string">&quot;灰色矩形图标&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">            &#125;),</span><br><span class="line">            _ =&gt; <span class="built_in">panic!</span>(<span class="string">&quot;未知的享元对象类型&quot;</span>),</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">factory</span> = FlyweightFactory::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">tree_flyweight</span> = factory.<span class="title function_ invoke__">get_flyweight</span>(<span class="string">&quot;tree&quot;</span>);</span><br><span class="line">    tree_flyweight.<span class="title function_ invoke__">operation</span>(<span class="string">&quot;地图左上角位置&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">building_flyweight</span> = factory.<span class="title function_ invoke__">get_flyweight</span>(<span class="string">&quot;building&quot;</span>);</span><br><span class="line">    building_flyweight.<span class="title function_ invoke__">operation</span>(<span class="string">&quot;地图右下角位置&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 再次获取相同类型的享元对象，验证是否共享</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">another_tree_flyweight</span> = factory.<span class="title function_ invoke__">get_flyweight</span>(<span class="string">&quot;tree&quot;</span>);</span><br><span class="line">    another_tree_flyweight.<span class="title function_ invoke__">operation</span>(<span class="string">&quot;地图右上角位置&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="享元设计模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 享元对象的抽象接口</span></span><br><span class="line"><span class="keyword">type</span> Flyweight <span class="keyword">interface</span> &#123;</span><br><span class="line">    Operation(extrinsicState <span class="type">string</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体享元对象：图形元素享元</span></span><br><span class="line"><span class="keyword">type</span> GraphicElementFlyweight <span class="keyword">struct</span> &#123;</span><br><span class="line">    InternalState <span class="type">string</span></span><br><span class="line">    <span class="comment">// 假设这里可以存储图形元素的一些基本属性，如颜色、形状等</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *GraphicElementFlyweight)</span></span> Operation(extrinsicState <span class="type">string</span>) &#123;</span><br><span class="line">    fmt.Printf(</span><br><span class="line">        <span class="string">&quot;使用内部状态 %s 并结合外部状态 %s 进行图形元素操作\n&quot;</span>,</span><br><span class="line">        g.InternalState, extrinsicState,</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 享元工厂，用于创建和管理享元对象池</span></span><br><span class="line"><span class="keyword">type</span> FlyweightFactory <span class="keyword">struct</span> &#123;</span><br><span class="line">    flyweights <span class="keyword">map</span>[<span class="type">string</span>]Flyweight</span><br><span class="line">    mutex      sync.Mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewFlyweightFactory</span><span class="params">()</span></span> *FlyweightFactory &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;FlyweightFactory&#123;</span><br><span class="line">        flyweights: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]Flyweight),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *FlyweightFactory)</span></span> GetFlyweight(key <span class="type">string</span>) Flyweight &#123;</span><br><span class="line">    f.mutex.Lock()</span><br><span class="line">    <span class="keyword">defer</span> f.mutex.Unlock()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> flyweight, ok := f.flyweights[key]; ok &#123;</span><br><span class="line">        <span class="keyword">return</span> flyweight</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 根据具体情况创建新的享元对象并放入池中</span></span><br><span class="line">        <span class="keyword">var</span> newFlyweight Flyweight</span><br><span class="line">        <span class="keyword">switch</span> key &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;tree&quot;</span>:</span><br><span class="line">            newFlyweight = &amp;GraphicElementFlyweight&#123;</span><br><span class="line">                InternalState: <span class="string">&quot;绿色圆形图标&quot;</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;building&quot;</span>:</span><br><span class="line">            newFlyweight = &amp;GraphicElementFlyweight&#123;</span><br><span class="line">                InternalState: <span class="string">&quot;灰色矩形图标&quot;</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">panic</span>(<span class="string">&quot;未知的享元对象类型&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        f.flyweights[key] = newFlyweight</span><br><span class="line">        <span class="keyword">return</span> newFlyweight</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    factory := NewFlyweightFactory()</span><br><span class="line"></span><br><span class="line">    treeFlyweight := factory.GetFlyweight(<span class="string">&quot;tree&quot;</span>)</span><br><span class="line">    treeFlyweight.Operation(<span class="string">&quot;地图左上角位置&quot;</span>)</span><br><span class="line"></span><br><span class="line">    buildingFlyweight := factory.GetFlyweight(<span class="string">&quot;building&quot;</span>)</span><br><span class="line">    buildingFlyweight.Operation(<span class="string">&quot;地图右下角位置&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 再次获取相同类型的享元对象，验证是否共享</span></span><br><span class="line">    anotherTreeFlyweight := factory.GetFlyweight(<span class="string">&quot;tree&quot;</span>)</span><br><span class="line">    anotherTreeFlyweight.Operation(<span class="string">&quot;地图右上角位置&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="代理模式"><a class="markdownIt-Anchor" href="#代理模式"></a> 代理模式</h4>
<p>代理模式<span style="color:red"><strong>为其他对象提供一种代理以控制对这个对象的访问，代理对象和被代理对象通常实现相同的接口，代理对象可以在客户端和被代理对象之间起到中介的作用，在访问被代理对象之前或之后执行一些额外的操作，比如权限验证、懒加载、缓存等，而客户端无需知道它所访问的是代理对象还是被代理对象本身</strong></span>。</p>
<p>该模式具有以下的应用场景：</p>
<ul>
<li>远程代理：在分布式系统中，当客户端需要访问位于远程服务器上的对象时，由于网络等因素，直接访问可能存在困难或效率低下。例如，在一个分布式数据库系统中，客户端位于本地机器，而数据库服务器在远程的数据中心。可以使用远程代理模式，在客户端本地创建一个远程数据库对象的代理，客户端通过这个代理与远程数据库进行交互。代理负责处理网络通信、数据序列化和反序列化等操作，使得客户端可以像访问本地对象一样方便地访问远程数据库，同时隐藏了远程访问的复杂性。</li>
<li>虚拟代理（懒加载）：当创建一个对象的成本很高（如加载大量数据、初始化复杂资源等），但并不是每次都需要立即使用该对象时，可以使用虚拟代理实现懒加载。比如，在一个图像浏览应用中，可能有大量的高清图片，一次性加载所有图片会占用大量内存且可能导致启动缓慢。此时可以为每张图片创建一个虚拟代理，当用户真正需要查看某张图片时，代理才去加载真正的图片对象，在此之前只占用很少的内存来保存代理对象自身的信息，从而提高应用的启动速度和内存使用效率。</li>
<li>保护代理（权限验证）：用于控制对特定对象的访问权限。例如，在一个企业内部的文件管理系统中，有一些敏感文件只有特定权限的用户才能访问。可以创建保护代理对象，在用户请求访问文件时，代理首先进行权限验证，只有验证通过的用户才能真正访问到被代理的文件对象，这样可以有效地保护敏感资源免受未授权访问。</li>
</ul>
<p>该模式具有以下特点：</p>
<ul>
<li>中介作用：代理对象作为客户端和被代理对象之间的中介，客户端通过代理对象来间接访问被代理对象，代理可以在中间执行一些额外的操作来增强或控制访问过程。</li>
<li>接口一致性：代理对象和被代理对象通常实现相同的接口，这使得客户端在使用时无需区分是直接访问被代理对象还是通过代理访问，保证了客户端代码的简洁性和可维护性，客户端可以以相同的方式调用代理和被代理对象的方法。</li>
<li>功能增强：可以在代理对象中添加额外的功能，如前面提到的权限验证、懒加载、缓存等功能，而不需要修改被代理对象本身的代码，从而实现对被代理对象功能的扩展和优化。</li>
</ul>
<p>该模式遵循以下设计原则：</p>
<ul>
<li>开闭原则：对扩展开放，对修改封闭。可以通过添加新的代理类来扩展功能，而不需要修改实际对象的代码。</li>
<li>单一职责原则：代理对象应该只有一个职责，即代理对实际对象的访问，并可能添加额外的功能。</li>
</ul>
<p>如下的代码中，代理对象（<code>Proxy</code>）和被代理对象（<code>RealSubject</code>）都实现了相同的接口<code>Subject</code>，但是<code>Proxy</code>增加了自己的一些方法，可以在调用<code>request</code>方法的前后做一些记录操作。</p>
<div class="tabs" id="代理模式"><ul class="nav-tabs"><li class="tab active"><a href="#代理模式-1">Rust</a></li><li class="tab"><a href="#代理模式-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="代理模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 真实主题接口</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Subject</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">request</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 真实主题</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RealSubject</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Subject</span> <span class="keyword">for</span> <span class="title class_">RealSubject</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">request</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;RealSubject: Handling request for &#123;&#125;&quot;</span>, <span class="keyword">self</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理主题</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Proxy</span>&lt;T: Subject&gt; &#123;</span><br><span class="line">    real_subject: T,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: Subject&gt; Proxy&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(real_subject: T) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123; real_subject &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">before_request</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;before request&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">after_request</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;after request&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T: Subject&gt; Subject <span class="keyword">for</span> <span class="title class_">Proxy</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">request</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">before_request</span>();</span><br><span class="line">        <span class="keyword">self</span>.real_subject.<span class="title function_ invoke__">request</span>();</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">after_request</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">proxy</span> = Proxy::<span class="title function_ invoke__">new</span>(RealSubject &#123;</span><br><span class="line">        name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;&quot;</span>),</span><br><span class="line">    &#125;);</span><br><span class="line">    proxy.<span class="title function_ invoke__">request</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="代理模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义被代理对象和代理对象都要实现的接口</span></span><br><span class="line"><span class="keyword">type</span> Subject <span class="keyword">interface</span> &#123;</span><br><span class="line">	Request()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体被代理对象</span></span><br><span class="line"><span class="keyword">type</span> RealSubject <span class="keyword">struct</span> &#123;</span><br><span class="line">	Data <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RealSubject)</span></span> Request() &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;真正的对象处理请求，数据: %s\n&quot;</span>, r.Data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理对象</span></span><br><span class="line"><span class="keyword">type</span> Proxy <span class="keyword">struct</span> &#123;</span><br><span class="line">	RealSubject Subject</span><br><span class="line">	<span class="comment">// 用于模拟权限验证，这里简单用一个布尔值表示</span></span><br><span class="line">	HasPermission <span class="type">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewProxy</span><span class="params">()</span></span> *Proxy &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;Proxy&#123;</span><br><span class="line">		RealSubject:   <span class="literal">nil</span>,</span><br><span class="line">		HasPermission: <span class="literal">false</span>,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模拟设置权限验证结果</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Proxy)</span></span> SetPermission(permission <span class="type">bool</span>) &#123;</span><br><span class="line">	p.HasPermission = permission</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载真正的被代理对象（懒加载示例）</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Proxy)</span></span> LoadRealSubject() &#123;</span><br><span class="line">	<span class="keyword">if</span> p.RealSubject == <span class="literal">nil</span> &#123;</span><br><span class="line">		p.RealSubject = &amp;RealSubject&#123;</span><br><span class="line">			Data: <span class="string">&quot;一些重要数据&quot;</span>,</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Proxy)</span></span> Request() &#123;</span><br><span class="line">	<span class="keyword">if</span> p.HasPermission &#123;</span><br><span class="line">		<span class="keyword">if</span> p.RealSubject != <span class="literal">nil</span> &#123;</span><br><span class="line">			p.RealSubject.Request()</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			p.LoadRealSubject()</span><br><span class="line">			<span class="keyword">if</span> p.RealSubject != <span class="literal">nil</span> &#123;</span><br><span class="line">				p.RealSubject.Request()</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;没有权限访问&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	proxy := NewProxy()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 模拟权限验证未通过</span></span><br><span class="line">	proxy.Request()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置权限验证通过</span></span><br><span class="line">	proxy.SetPermission(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">	proxy.Request()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h3 id="行为型设计模式"><a class="markdownIt-Anchor" href="#行为型设计模式"></a> 行为型设计模式</h3>
<p>行为型设计模式主要用于处理对象之间的交互和职责分配，关注的是对象的行为和它们之间的通信方式，以实现更加灵活和可维护的系统行为。</p>
<h4 id="责任链模式"><a class="markdownIt-Anchor" href="#责任链模式"></a> 责任链模式</h4>
<p>责任链模式<span style="color:red"><strong>主要关注这个<code>链</code>字，它将请求的发送者和接收者解耦，让多个对象都有机会处理请求，将这些对象连接成一条链，请求沿着这条链传递，直到有一个对象处理它为止。每个对象在接收到请求时，都可以决定是自己处理该请求还是将其传递给链上的下一个对象，WEB请求中的各种中间件就是使用了该设计模式</strong></span>。</p>
<p>该模式具有以下应用场景：</p>
<ul>
<li>事件处理系统：在图形用户界面（GUI）开发中，比如一个窗口应用程序，会有各种各样的事件发生，如鼠标点击、键盘按键按下等。不同的组件可能对不同类型的事件感兴趣并进行处理。可以使用责任链模式，将各个组件按照一定的顺序连接成责任链，当一个事件发生时，从链的开头开始传递该事件，每个组件检查是否是自己能处理的事件类型，如果是则处理，否则传递给下一个组件，直到事件被处理或者到达链的末尾。</li>
<li>工作流审批系统：在企业的业务流程中，对于一些重要的业务操作，如请假申请、费用报销等，往往需要经过多个层级的审批。可以构建责任链模式，每个审批层级作为链上的一个节点，请假申请或费用报销请求从链的起始节点（如员工直属上级）开始传递，每个审批人根据自己的权限和规则决定是否批准该请求，如果不批准则传递给下一个审批层级，直到请求被批准或者到达链的最后审批层级（如公司高层领导）。</li>
<li>日志过滤系统：在一个大型的软件系统中，会产生大量的日志信息，不同级别的日志可能需要不同的处理方式，比如一些调试日志可能只在开发环境中显示，而错误日志需要记录到文件并发送通知给运维人员。通过责任链模式，可以将不同的日志过滤器（如按级别过滤、按模块过滤等）连接成链，日志消息从链的一端传入，依次经过各个过滤器，根据过滤器的规则决定是记录、丢弃还是进一步传递该日志消息。</li>
</ul>
<p>该模式具有以下特点：</p>
<ul>
<li>解耦请求发送者和接收者：请求的发送者不需要知道具体哪个对象会处理它的请求，只需要将请求发送到责任链的开头即可，而接收者（链上的各个对象）也不需要知道请求的原始发送者是谁，它们只关心是否能处理接收到的请求以及如何处理。</li>
<li>动态组合处理链：可以根据具体的业务需求灵活地组合和调整责任链上的对象顺序和类型，添加或删除链上的某个节点都比较方便，无需对整个系统进行大规模的修改，从而提高了系统的可扩展性。</li>
<li>处理灵活性：每个节点在接收到请求时都有自主决定是否处理的权利，这使得对于不同类型的请求可以有不同的处理路径，同一个请求在不同的业务场景或配置下可能会被不同的节点处理，增加了处理的灵活性。</li>
</ul>
<p>该模式遵循以下设计原则：</p>
<ul>
<li>开闭原则：对扩展开放，对修改关闭。当需要添加新的处理节点（如在事件处理系统中添加新的组件来处理新类型的事件，或在工作流审批系统中新增一个审批层级）时，只需创建新的类实现相应的接口并将其插入到责任链中合适的位置即可，无需修改现有节点的代码以及请求发送者的代码。</li>
<li>单一职责原则：链上的每个节点通常只负责处理一种特定类型的请求或执行一种特定的功能，使得每个节点的职责明确，便于代码的维护和理解，降低了代码的复杂性。</li>
</ul>
<p>如下是责任链设计模式示例代码类图：</p>
<p><img data-src="//www.plantuml.com/plantuml/png/SoWkIImgAStDuL9NUDQrzyN6XK-Nj3oVqFQYePKhCwyajIWjCJbLmICnBoKdjKYXcai128fJI-BpKYjAD38WmbOmUKsmD4GqlYYri3Irk4G3Ibif19SKPUQbQtBL0grwshhzoTx9SAiSkP9p4ekB5PppyvABKajIeUOvGYtK1jaMZsuRH8g0OxJ9S8qJTjSuqSKrOETiVhvvDnTwOEZfrTZ1Oy9AuUcwUS_xDg2hSY9AbQE2hYwIAf2DBngdlD_JWHulJtjQdqvO_MH7zvCT3Kzsh89B08rzig_x_PvE3Fk9DDc9iCaEgNafm8G90000" alt="链接" /></p>
<div class="tabs" id="责任链模式"><ul class="nav-tabs"><li class="tab active"><a href="#责任链模式-1">Rust</a></li><li class="tab"><a href="#责任链模式-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="责任链模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象处理者，定义处理请求的接口</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, handler: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Handler&gt;);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle_request</span>(&amp;<span class="keyword">self</span>, request: &amp;<span class="type">str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者A</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ConcreteHandlerA</span> &#123;</span><br><span class="line">    next_handler: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Handler&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Handler</span> <span class="keyword">for</span> <span class="title class_">ConcreteHandlerA</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, handler: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Handler&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>.next_handler = <span class="title function_ invoke__">Some</span>(handler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle_request</span>(&amp;<span class="keyword">self</span>, request: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;ConcreteHandlerA处理请求: &#123;&#125;&quot;</span>, request);</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(next_handler) = &amp;<span class="keyword">self</span>.next_handler &#123;</span><br><span class="line">            next_handler.<span class="title function_ invoke__">handle_request</span>(request)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者B</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ConcreteHandlerB</span> &#123;</span><br><span class="line">    next_handler: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Handler&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Handler</span> <span class="keyword">for</span> <span class="title class_">ConcreteHandlerB</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, handler: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Handler&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>.next_handler = <span class="title function_ invoke__">Some</span>(handler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle_request</span>(&amp;<span class="keyword">self</span>, request: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;ConcreteHandlerB处理请求: &#123;&#125;&quot;</span>, request);</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(next_handler) = &amp;<span class="keyword">self</span>.next_handler &#123;</span><br><span class="line">            next_handler.<span class="title function_ invoke__">handle_request</span>(request)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">handler_a</span> = ConcreteHandlerA &#123; next_handler: <span class="literal">None</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">handler_b</span> = ConcreteHandlerB &#123; next_handler: <span class="literal">None</span> &#125;;</span><br><span class="line"></span><br><span class="line">    handler_a.<span class="title function_ invoke__">set_next</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(handler_b));</span><br><span class="line"></span><br><span class="line">    handler_a.<span class="title function_ invoke__">handle_request</span>(<span class="string">&quot;请求1&quot;</span>);</span><br><span class="line">    handler_a.<span class="title function_ invoke__">handle_request</span>(<span class="string">&quot;请求2&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="责任链模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象处理者，定义处理请求的接口</span></span><br><span class="line"><span class="keyword">type</span> Handler <span class="keyword">interface</span> &#123;</span><br><span class="line">	SetNext(handler Handler)</span><br><span class="line">	HandleRequest(request <span class="type">string</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者A</span></span><br><span class="line"><span class="keyword">type</span> ConcreteHandlerA <span class="keyword">struct</span> &#123;</span><br><span class="line">	NextHandler Handler</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *ConcreteHandlerA)</span></span> SetNext(handler Handler) &#123;</span><br><span class="line">	c.NextHandler = handler</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *ConcreteHandlerA)</span></span> HandleRequest(request <span class="type">string</span>) &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;ConcreteHandlerA处理请求: %s\n&quot;</span>, request)</span><br><span class="line">	<span class="keyword">if</span> c.NextHandler != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.NextHandler.HandleRequest(request)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者B</span></span><br><span class="line"><span class="keyword">type</span> ConcreteHandlerB <span class="keyword">struct</span> &#123;</span><br><span class="line">	NextHandler Handler</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *ConcreteHandlerB)</span></span> SetNext(handler Handler) &#123;</span><br><span class="line">	c.NextHandler = handler</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *ConcreteHandlerB)</span></span> HandleRequest(request <span class="type">string</span>) &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;ConcreteHandlerB处理请求: %s\n&quot;</span>, request)</span><br><span class="line">	<span class="keyword">if</span> c.NextHandler != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.NextHandler.HandleRequest(request)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	handlerA := &amp;ConcreteHandlerA&#123;&#125;</span><br><span class="line">	handlerB := &amp;ConcreteHandlerB&#123;&#125;</span><br><span class="line"></span><br><span class="line">	handlerA.SetNext(handlerB)</span><br><span class="line"></span><br><span class="line">	handlerA.HandleRequest(<span class="string">&quot;请求1&quot;</span>)</span><br><span class="line">	handlerA.HandleRequest(<span class="string">&quot;请求2&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="命令模式"><a class="markdownIt-Anchor" href="#命令模式"></a> 命令模式</h4>
<p>命令模式会<span style="color:red"><strong>把对一个对象的操作封装成一个对象，从而使用户可以用不同的参数将对象参数化，将请求的发送者和接收者解耦。请求的发送者只需要知道如何发出请求（调用命令对象的执行方法），而不需要知道具体由谁来处理这个请求以及如何处理；请求的接收者也不需要知道请求是由谁发出的，只专注于执行具体的任务。该设计模式通常用于需要排队或者支持撤销的场景中</strong></span>。</p>
<p>该模式具有以下的应用场景：</p>
<ul>
<li>绘图软件：在绘图软件中，用户可以进行各种操作，如画直线、画圆、填充颜色等。可以将每个操作都封装成一个命令对象，当用户点击相应的菜单按钮或工具图标时，就相当于发送了一个命令，命令对象会负责调用绘图引擎等相关接收者来执行具体的绘图动作。这样，不同的用户操作可以方便地被记录、撤销、重做等，通过维护一个命令历史列表，就可以轻松实现这些功能。</li>
<li>订单处理系统：在电商平台的订单处理流程中，有下单、取消订单、发货、退款等多种操作。将这些操作都设计成命令对象，订单管理系统作为请求的发送者，只需要调用相应的命令对象的执行方法即可触发对应的订单处理动作，而具体的处理逻辑由各个命令对象对应的接收者（如库存管理系统、物流系统、财务系统等）来完成。这样可以灵活地组合和扩展不同的订单处理流程，并且方便对操作进行日志记录和审计。</li>
<li>设备控制系统：在智能家居系统或工业自动化控制系统中，对于各种设备（如灯光、空调、电机等）有不同的控制操作，如打开灯光、调节空调温度、启动电机等。可以把这些控制操作封装成命令对象，控制中心作为发送者，通过发送不同的命令来控制设备的运行状态，设备本身或其对应的控制模块作为接收者执行具体的控制动作。这种方式使得控制逻辑更加清晰，便于添加新的设备控制命令和对现有命令进行修改。</li>
</ul>
<p>该模式具有以下特点：</p>
<ul>
<li>解耦请求发送者和接收者：发送者和接收者之间通过命令对象进行间接交互，发送者不需要了解接收者的具体实现细节，接收者也不需要知道发送者的情况，双方的耦合度大大降低，使得系统的可维护性和扩展性更好。</li>
<li>可实现操作的参数化和排队执行：可以将不同的请求封装成不同的命令对象，并且可以对这些命令对象进行参数化设置（如设置绘图的起点和终点、订单操作的相关参数等）。同时，还可以将多个命令对象放入一个队列中，按照一定的顺序依次执行，实现操作的排队执行，这在一些需要批量处理操作或按照特定顺序执行操作的场景中非常有用。</li>
<li>支持撤销和重做功能：由于命令对象记录了具体的操作以及相关参数，通过维护一个命令历史列表，可以方便地实现撤销和重做功能。只需要在列表中找到对应的命令对象，根据其类型和参数反向执行或再次执行相应的操作即可。</li>
</ul>
<p>该模式遵循以下设计原则：</p>
<ul>
<li>开闭原则：对扩展开放，对修改关闭。当需要添加新的操作（如在绘图软件中新增一种绘图工具，或在订单处理系统中新增一种订单处理流程）时，只需创建新的命令类并实现相应的接口，然后将其集成到系统中即可，不需要修改现有的请求发送者和接收者的代码。</li>
<li>单一职责原则：每个命令类只负责封装一个特定的操作及其相关逻辑，使得代码的职责更加清晰，便于理解和维护。例如，画直线的命令类只专注于实现画直线的操作逻辑，取消订单的命令类只负责处理取消订单的相关事宜。</li>
</ul>
<p>如下的示例中，<code>LightOnCommand</code>和<code>LightOffCommand</code>已经将灯的开关操作封装为对象，使用者只要使用这两个对象即可完成灯的操作，不用关心灯的开关具体需要调用什么方法，如果有很多灯需要操作，则可以将他们放入队列中逐条处理：</p>
<p><img data-src="//www.plantuml.com/plantuml/png/fP0nImGn48Nx_HNXgbN9WUrnBAU7dN1YAnRhPgA1P4QIMJrG2pjBQ_-VuCymRBAicqguT7bltiURsGHkFVVELfrjGn2Nvlw1nKibufEFz0nUhCGTaHsKantMHr5u8gEoeFMal5MPiYNdMbIPiruRPF2wxQ1fKknY3rtFK4R70ZkS4wGTQgsI-p-4reSmhi4HmvQGFTcHq2LWYDEPVNERG6TAPQNEGzFC_61N7a8uxva9QuCAzj4ro7yR52UGiicTfyLAfuWibw-Do9yYLPZpFO-b58lJnUZ6JZ_lNz-V7zK6KFNE_W80" alt="链接" /></p>
<div class="tabs" id="命令模式"><ul class="nav-tabs"><li class="tab active"><a href="#命令模式-1">Rust</a></li><li class="tab"><a href="#命令模式-2">Rust</a></li></ul><div class="tab-content"><div class="tab-pane active" id="命令模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cell::RefCell;</span><br><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">execute</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Light</span> &#123;</span><br><span class="line">    power: <span class="type">bool</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Light</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">on</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.power = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Light is on&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">off</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.power = <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Light is off&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LightOnCommand</span> &#123;</span><br><span class="line">    light: Rc&lt;RefCell&lt;Light&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Command</span> <span class="keyword">for</span> <span class="title class_">LightOnCommand</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">execute</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.light.<span class="title function_ invoke__">borrow_mut</span>().<span class="title function_ invoke__">on</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LightOffCommand</span> &#123;</span><br><span class="line">    light: Rc&lt;RefCell&lt;Light&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Command</span> <span class="keyword">for</span> <span class="title class_">LightOffCommand</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">execute</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.light.<span class="title function_ invoke__">borrow_mut</span>().<span class="title function_ invoke__">off</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RemoteControl</span> &#123;</span><br><span class="line">    commands: <span class="type">Vec</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Command&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">RemoteControl</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> RemoteControl &#123;</span><br><span class="line">        RemoteControl &#123;</span><br><span class="line">            commands: <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">add_command</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, command: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Command&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>.commands.<span class="title function_ invoke__">push</span>(command);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">press_button</span>(&amp;<span class="keyword">self</span>, index: <span class="type">usize</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(command) = <span class="keyword">self</span>.commands.<span class="title function_ invoke__">get</span>(index) &#123;</span><br><span class="line">            command.<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">light</span> = Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(Light &#123; power: <span class="literal">false</span> &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">remote</span> = RemoteControl::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    remote.<span class="title function_ invoke__">add_command</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(LightOnCommand &#123;</span><br><span class="line">        light: Rc::<span class="title function_ invoke__">clone</span>(&amp;light),</span><br><span class="line">    &#125;));</span><br><span class="line">    remote.<span class="title function_ invoke__">add_command</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(LightOffCommand &#123;</span><br><span class="line">        light: Rc::<span class="title function_ invoke__">clone</span>(&amp;light),</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    remote.<span class="title function_ invoke__">press_button</span>(<span class="number">0</span>); <span class="comment">// Light is on</span></span><br><span class="line">    remote.<span class="title function_ invoke__">press_button</span>(<span class="number">1</span>); <span class="comment">// Light is off</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="命令模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Command <span class="keyword">interface</span> &#123;</span><br><span class="line">	Execute()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Light <span class="keyword">struct</span> &#123;</span><br><span class="line">	power <span class="type">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *Light)</span></span> On() &#123;</span><br><span class="line">	l.power = <span class="literal">true</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;Light is on&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *Light)</span></span> Off() &#123;</span><br><span class="line">	l.power = <span class="literal">false</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;Light is off&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> LightOnCommand <span class="keyword">struct</span> &#123;</span><br><span class="line">	light *Light</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(loc *LightOnCommand)</span></span> Execute() &#123;</span><br><span class="line">	loc.light.On()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> LightOffCommand <span class="keyword">struct</span> &#123;</span><br><span class="line">	light *Light</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(loc *LightOffCommand)</span></span> Execute() &#123;</span><br><span class="line">	loc.light.Off()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> RemoteControl <span class="keyword">struct</span> &#123;</span><br><span class="line">	commands []Command</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rc *RemoteControl)</span></span> AddCommand(command Command) &#123;</span><br><span class="line">	rc.commands = <span class="built_in">append</span>(rc.commands, command)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rc *RemoteControl)</span></span> PressButton(index <span class="type">int</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> index &lt; <span class="built_in">len</span>(rc.commands) &#123;</span><br><span class="line">		rc.commands[index].Execute()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> light Light</span><br><span class="line">	lightOn := LightOnCommand&#123;light: &amp;light&#125;</span><br><span class="line">	lightOff := LightOffCommand&#123;light: &amp;light&#125;</span><br><span class="line"></span><br><span class="line">	remote := RemoteControl&#123;&#125;</span><br><span class="line">	remote.AddCommand(&amp;lightOn)</span><br><span class="line">	remote.AddCommand(&amp;lightOff)</span><br><span class="line"></span><br><span class="line">	remote.PressButton(<span class="number">0</span>) <span class="comment">// Light is on</span></span><br><span class="line">	remote.PressButton(<span class="number">1</span>) <span class="comment">// Light is off</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="迭代模式"><a class="markdownIt-Anchor" href="#迭代模式"></a> 迭代模式</h4>
<p>迭代器模式<span style="color:red"><strong>提供了一种方法来顺序访问一个聚合对象中的各个元素，而无需暴露该聚合对象的内部表示形式。通过将遍历逻辑封装在迭代器对象中，使得聚合对象的职责更加单一，专注于存储和管理数据，而迭代器负责实现数据的遍历操作，客户端可以通过统一的迭代器接口来遍历不同类型的聚合对象</strong></span>。</p>
<p>该模式具有如下应用场景：</p>
<ul>
<li>数据容器遍历：在处理各种数据容器如数组、链表、树、集合等时，需要逐个访问其中的元素。例如，在一个图形绘制程序中，有一个存储图形元素（如点、线、圆等）的容器，可能是数组或者链表结构。使用迭代器模式，可以方便地遍历这个容器，依次对每个图形元素进行绘制操作，而不需要关心容器的具体实现细节，无论是数组还是链表，客户端使用相同的迭代器接口就能完成遍历。</li>
<li>数据库查询结果遍历：当从数据库中获取查询结果集时，通常需要遍历结果集中的每一行数据进行后续处理，比如在一个电商平台的订单管理系统中，查询出满足特定条件的订单列表后，要对每个订单进行统计分析、打印订单详情等操作。通过迭代器模式，可以为查询结果集创建一个迭代器，以统一的方式遍历这些订单数据，即使数据库底层的数据存储结构或者查询引擎发生变化，只要迭代器接口不变，客户端代码不需要做大量修改。</li>
<li>文件系统遍历：在操作系统的文件系统中，需要遍历文件夹及其子文件夹中的文件。可以将文件系统看作是一个树形结构的聚合对象，文件夹是树枝节点，文件是叶子节点。利用迭代器模式，创建一个文件系统迭代器，能够按照特定的顺序（如深度优先或广度优先）遍历文件系统中的文件，对每个文件进行诸如文件属性查看、备份等操作，这样可以将文件系统的遍历逻辑与具体的文件操作逻辑分离开来。</li>
</ul>
<p>该模式具有以下特点：</p>
<ul>
<li>解耦聚合对象和遍历逻辑：将数据的存储和管理（聚合对象）与数据的遍历操作（迭代器）分离开来，使得两者可以独立变化。聚合对象不需要关心如何被遍历，而迭代器也不需要了解聚合对象的具体内部结构，只专注于实现遍历的逻辑，这提高了代码的可维护性和可扩展性。</li>
<li>统一遍历接口：为不同类型的聚合对象提供了一个统一的遍历接口，客户端可以使用相同的方式来遍历各种不同的数据结构，如数组、链表、树等，只要这些数据结构实现了相应的迭代器接口。这简化了客户端代码，使其不需要针对每种数据结构编写不同的遍历代码。</li>
<li>支持多种遍历方式：可以根据具体需求实现不同的迭代器来支持多种遍历方式，比如在遍历树形结构的文件系统时，可以实现深度优先迭代器和广度优先迭代器。客户端可以根据实际情况选择合适的迭代器来完成特定的遍历任务，增加了遍历的灵活性。</li>
</ul>
<p>该模式遵循以下设计原则：</p>
<ul>
<li>开闭原则：对扩展开放，对修改关闭。当需要添加新的聚合对象类型或者新的遍历方式时，只需创建新的迭代器类或者对现有迭代器类进行扩展，而不需要修改客户端代码和聚合对象的核心代码。例如，在图形绘制程序中，如果新增一种特殊的图形元素容器，只需要为其创建对应的迭代器并实现迭代器接口即可，客户端依然可以用相同的方式遍历新的容器。</li>
<li>单一职责原则：聚合对象专注于存储和管理数据，迭代器专注于实现遍历数据的逻辑，各自职责明确。这样可以使代码更加清晰、易于理解和维护，降低了代码的复杂性，避免了将遍历逻辑和数据存储管理逻辑混在一起导致的代码混乱。</li>
</ul>
<p>如下是迭代器模式的UNL类图：</p>
<p><img data-src="//www.plantuml.com/plantuml/png/TLDFQzH05B_dKypDbfBq7cIf1n5F7ZoAoB0PDR2PBSaKwn-XnGtMLhQ5je89X6eLHT6sP65toVxvCdcJUDgluCJ9hjaapILXtdk_z_ipsN0OjjcMrL9k8Bu_Jgy-fTDVSNGE7x_pxbSuF5TCoeZz63S9kYi-C6lRwAM2n4F9DbjPHJgwjydCDhqfobP3UIs0mEt7u-DqruEZFRWO2j3Po0D_0kFFuBv9UcVyz3A9EagpXHq7tR7nvbEpwTooRVmynruZBM8HoXnzKRujJnuyb0sKFCkMBq_B4ZQCH_dyIlwkmApALbD8giBCXKen1Tv9TCo3Zj0cgPT1v-GfjeYExZFRf4_aYQPfQ7qTmU45xqUmVyRz7dpnu2hWEzyIVm1ko3yCUNXQj6-UGwrtYsgTYQMWranga6qTRJdc2v9RbBNLcbTEjIGn2_WVnJ098wLsgwQzQlo_Apg2tq7IlLpkHQhQk8Qpde6dkoUpqLvLzfyTBvs-pLAJVgNJ4_23UD2DXmToBF4w1UVUbTQsLRKIcexaJQrT2EzTEFefiee7FufL8IgU76GBDWWrnF_p5m00" alt="链接" /></p>
<div class="tabs" id="迭代器模式"><ul class="nav-tabs"><li class="tab active"><a href="#迭代器模式-1">Rust</a></li><li class="tab"><a href="#迭代器模式-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="迭代器模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象迭代器接口</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Iterator</span> &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体聚合对象：图形元素数组</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GraphicsArray</span> &#123;</span><br><span class="line">    elements: <span class="type">Vec</span>&lt;GraphicsElement&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图形元素结构体</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GraphicsElement</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">    <span class="comment">// 可以添加更多图形元素的属性，如颜色、坐标等</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Clone</span> <span class="keyword">for</span> <span class="title class_">GraphicsElement</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">clone</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        <span class="keyword">Self</span> &#123;</span><br><span class="line">            name: <span class="keyword">self</span>.name.<span class="title function_ invoke__">clone</span>(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">GraphicsArray</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        GraphicsArray &#123;</span><br><span class="line">            elements: <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">add_element</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, element: GraphicsElement) &#123;</span><br><span class="line">        <span class="keyword">self</span>.elements.<span class="title function_ invoke__">push</span>(element);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建并返回一个用于遍历该数组的迭代器</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">iter</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> GraphicsArrayIterator &#123;</span><br><span class="line">        GraphicsArrayIterator &#123;</span><br><span class="line">            index: <span class="number">0</span>,</span><br><span class="line">            array: <span class="keyword">self</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体迭代器：图形元素数组迭代器</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GraphicsArrayIterator</span>&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    index: <span class="type">usize</span>,</span><br><span class="line">    array: &amp;<span class="symbol">&#x27;a</span> GraphicsArray,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;<span class="symbol">&#x27;a</span>&gt; <span class="built_in">Iterator</span> <span class="keyword">for</span> <span class="title class_">GraphicsArrayIterator</span>&lt;<span class="symbol">&#x27;a</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">type</span> <span class="title class_">Item</span> = GraphicsElement;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">next</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;<span class="keyword">Self</span>::Item&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.index &lt; <span class="keyword">self</span>.array.elements.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">element</span> = <span class="keyword">self</span>.array.elements[<span class="keyword">self</span>.index].<span class="title function_ invoke__">clone</span>();</span><br><span class="line">            <span class="keyword">self</span>.index += <span class="number">1</span>;</span><br><span class="line">            <span class="title function_ invoke__">Some</span>(element)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="literal">None</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">graphics_array</span> = GraphicsArray::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">element1</span> = GraphicsElement &#123;</span><br><span class="line">        name: <span class="string">&quot;圆形&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">element2</span> = GraphicsElement &#123;</span><br><span class="line">        name: <span class="string">&quot;直线&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    graphics_array.<span class="title function_ invoke__">add_element</span>(element1);</span><br><span class="line">    graphics_array.<span class="title function_ invoke__">add_element</span>(element2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">iterator</span> = graphics_array.<span class="title function_ invoke__">iter</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(element) = iterator.<span class="title function_ invoke__">next</span>() &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;正在处理图形元素: &#123;&#125;&quot;</span>, element.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="迭代器模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象迭代器接口</span></span><br><span class="line"><span class="keyword">type</span> Iterator <span class="keyword">interface</span> &#123;</span><br><span class="line">	Next() (<span class="keyword">interface</span>&#123;&#125;, <span class="type">bool</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体聚合对象：图形元素数组</span></span><br><span class="line"><span class="keyword">type</span> GraphicsArray <span class="keyword">struct</span> &#123;</span><br><span class="line">	Elements []GraphicsElement</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图形元素结构体</span></span><br><span class="line"><span class="keyword">type</span> GraphicsElement <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="type">string</span></span><br><span class="line">	<span class="comment">// 可以添加更多图形元素的属性，如颜色、坐标等</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *GraphicsArray)</span></span> AddElement(element GraphicsElement) &#123;</span><br><span class="line">	g.Elements = <span class="built_in">append</span>(g.Elements, element)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建并返回一个用于遍历该数组的迭代器</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *GraphicsArray)</span></span> Iter() Iterator &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;GraphicsArrayIterator&#123;</span><br><span class="line">		Index: <span class="number">0</span>,</span><br><span class="line">		Array: g,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体迭代器：图形元素数组迭代器</span></span><br><span class="line"><span class="keyword">type</span> GraphicsArrayIterator <span class="keyword">struct</span> &#123;</span><br><span class="line">	Index <span class="type">int</span></span><br><span class="line">	Array *GraphicsArray</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *GraphicsArrayIterator)</span></span> Next() (<span class="keyword">interface</span>&#123;&#125;, <span class="type">bool</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> g.Index &lt; <span class="built_in">len</span>(g.Array.Elements) &#123;</span><br><span class="line">		element := g.Array.Elements[g.Index]</span><br><span class="line">		g.Index += <span class="number">1</span></span><br><span class="line">		<span class="keyword">return</span> element, <span class="literal">true</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	graphicsArray := &amp;GraphicsArray&#123;</span><br><span class="line">		Elements: []GraphicsElement&#123;&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	graphicsArray.AddElement(GraphicsElement&#123;Name: <span class="string">&quot;圆形&quot;</span>&#125;)</span><br><span class="line">	graphicsArray.AddElement(GraphicsElement&#123;Name: <span class="string">&quot;直线&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">	iterator := graphicsArray.Iter()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		element, ok := iterator.Next()</span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;正在处理图形元素: %s\n&quot;</span>, element.(GraphicsElement).Name)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="中介者模式"><a class="markdownIt-Anchor" href="#中介者模式"></a> 中介者模式</h4>
<p>中介者模式<span style="color:red"><strong>通过引入一个<code>中介者</code>对象来封装一系列对象之间的交互逻辑，使得这些对象之间不再直接相互引用，而是通过中介者进行通信和协调。中介者模式旨在减少对象之间的耦合度，将复杂的<code>多对多</code>交互关系简化为各个对象与中介者之间的<code>一对多</code>关系，从而使系统更易于理解、维护和扩展。就像即时通讯的实现中，通信双方的两个人不直接建立连接通信，都是通过中间服务器进行消息转发，通过这个中间服务器，不仅实现了一对一（单聊）还能实现群发，简化了整个系统的复杂度</strong></span>。</p>
<p>该模式具有以下适用场景：</p>
<ul>
<li>图形用户界面（GUI）开发：在 GUI 应用程序中，存在许多不同的组件，如按钮、文本框、下拉菜单等，它们之间可能会有各种交互行为。例如，点击一个按钮可能会导致文本框内容的更新，或者改变下拉菜单的选项。使用中介者模式，可以创建一个 GUI 中介者对象，各个组件在发生特定事件时（如按钮的点击事件、文本框的内容改变事件等）通过中介者来通知其他相关组件进行相应的操作，这样可以将组件之间复杂的交互逻辑集中在中介者中进行管理，避免了组件之间的直接相互引用和复杂的嵌套事件处理逻辑。</li>
<li>即时通讯系统：在即时通讯软件中，有多个用户（或客户端）相互之间进行消息发送、文件传输等交互活动。可以将服务器端看作是一个中介者，客户端之间不直接进行通信，而是通过服务器这个中介者来转发消息、协调文件传输等操作。例如，当用户 A 向用户 B 发送一条消息时，用户 A 的客户端将消息发送到服务器，服务器再根据接收方的信息将消息转发给用户 B 的客户端。这样可以有效地管理和协调众多客户端之间的交互，同时也便于对消息进行过滤、记录等额外操作在服务器端进行处理。</li>
<li>交通控制系统：在城市交通管理中，涉及到多种交通参与者，如汽车、行人、交通信号灯等，它们之间存在着复杂的交互关系。例如，汽车需要根据交通信号灯的状态来决定是否前行，行人也需要根据信号灯和汽车的情况来安全过马路。通过引入中介者模式，可以创建一个交通控制中介者对象，交通信号灯、汽车、行人等交通参与者通过这个中介者来获取其他参与者的信息并进行相应的操作。比如，交通信号灯状态改变时，通过中介者通知附近的汽车和行人；汽车接近路口时，也通过中介者向交通信号灯请求通行许可等，从而使整个交通系统的交互更加有序和易于管理。</li>
</ul>
<p>该模式具有以下特点：</p>
<ul>
<li>解耦对象间的直接交互：将原本相互直接引用和交互的多个对象之间的关系解耦，使得各个对象只需要与中介者对象进行交互，而不需要了解其他对象的具体实现细节和内部状态。这大大降低了对象之间的耦合度，提高了系统的可维护性和可扩展性，当某个对象的内部实现发生变化时，只要其与中介者的交互接口不变，其他对象通常不需要进行相应的修改。</li>
<li>集中化的交互逻辑管理：将多个对象之间复杂的交互逻辑集中在中介者对象中进行处理，中介者对象负责协调各个对象之间的信息传递、事件触发等操作。这样可以使系统的交互逻辑更加清晰，便于对整个系统的交互行为进行统一的管理和监控，例如可以在中介者中方便地添加日志记录功能来跟踪系统中各个对象之间的交互情况。</li>
<li>一对多的交互关系简化：将多个对象之间的多对多交互关系简化为各个对象与中介者之间的一对多关系。每个对象只需要关注与中介者的交互，而中介者则负责处理各个对象之间的所有交互需求，这种简化后的关系模型使得系统的结构更加清晰，易于理解和设计。</li>
</ul>
<p>该模式遵循以下设计原则：</p>
<ul>
<li>开闭原则：对扩展开放，对修改关闭。当需要添加新的对象参与到系统的交互中，或者对现有对象的交互逻辑进行修改时，只需要在中介者对象以及相关对象的与中介者交互的接口部分进行相应的修改或添加，而不需要对其他无关对象进行大规模的修改。例如，在 GUI 应用程序中，如果新增一个组件，只需要在 GUI 中介者对象中添加对该组件的处理逻辑以及在该组件中设置与中介者交互的接口即可，其他原有组件的代码通常不需要进行改动。</li>
<li>单一职责原则：各个对象专注于自身的核心功能实现，而中介者对象则专注于管理和协调对象之间的交互逻辑，各自的职责明确。这样可以使代码更加清晰、易于理解和维护，避免了将对象自身的功能实现和交互逻辑混在一起导致的代码复杂性增加。</li>
<li>迪米特法则：对象应该只与它们的直接朋友通信，不与“陌生人”交谈。</li>
</ul>
<p>如下是中介模式的实现，所有的组件都实现了<code>Colleague</code>这个接口，但是所有的组件都不直接交互，而是将消息发到<code>Mediator</code>，终结者再将消息发送到其他组件：</p>
<div class="tabs" id="中介者模式"><ul class="nav-tabs"><li class="tab active"><a href="#中介者模式-1">Rust</a></li><li class="tab"><a href="#中介者模式-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="中介者模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cell::RefCell;</span><br><span class="line"><span class="keyword">use</span> std::collections::HashMap;</span><br><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象同事类接口，所有参与交互的具体对象都要实现这个接口</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Colleague</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_mediator</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, mediator: Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Mediator&gt;&gt;);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">send</span>(&amp;<span class="keyword">self</span>, message: &amp;<span class="type">str</span>);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">receive</span>(&amp;<span class="keyword">self</span>, message: &amp;<span class="type">str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中介者接口，定义中介者与同事类交互的方法</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">add_colleague</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, name: <span class="type">String</span>, colleague: Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Colleague&gt;&gt;);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">distribute_message</span>(&amp;<span class="keyword">self</span>, sender: &amp;<span class="type">str</span>, message: &amp;<span class="type">str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体同事类：按钮组件</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    mediator: <span class="type">Option</span>&lt;Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Mediator&gt;&gt;&gt;,</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Colleague</span> <span class="keyword">for</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_mediator</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, mediator: Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Mediator&gt;&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>.mediator = <span class="title function_ invoke__">Some</span>(mediator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">send</span>(&amp;<span class="keyword">self</span>, message: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(mediator) = &amp;<span class="keyword">self</span>.mediator &#123;</span><br><span class="line">            mediator</span><br><span class="line">                .<span class="title function_ invoke__">borrow</span>()</span><br><span class="line">                .<span class="title function_ invoke__">distribute_message</span>(<span class="keyword">self</span>.name.<span class="title function_ invoke__">as_str</span>(), message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">receive</span>(&amp;<span class="keyword">self</span>, message: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;按钮 &#123;&#125; 收到消息: &#123;&#125;&quot;</span>, <span class="keyword">self</span>.name, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体同事类：文本框组件</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TextBox</span> &#123;</span><br><span class="line">    mediator: <span class="type">Option</span>&lt;Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Mediator&gt;&gt;&gt;,</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Colleague</span> <span class="keyword">for</span> <span class="title class_">TextBox</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_mediator</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, mediator: Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Mediator&gt;&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>.mediator = <span class="title function_ invoke__">Some</span>(mediator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">send</span>(&amp;<span class="keyword">self</span>, message: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(mediator) = &amp;<span class="keyword">self</span>.mediator &#123;</span><br><span class="line">            mediator</span><br><span class="line">                .<span class="title function_ invoke__">borrow</span>()</span><br><span class="line">                .<span class="title function_ invoke__">distribute_message</span>(<span class="keyword">self</span>.name.<span class="title function_ invoke__">as_str</span>(), message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">receive</span>(&amp;<span class="keyword">self</span>, message: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;按钮 &#123;&#125; 收到消息: &#123;&#125;&quot;</span>, <span class="keyword">self</span>.name, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体中介者：GUI中介者</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GUIMediator</span> &#123;</span><br><span class="line">    colleagues: HashMap&lt;<span class="type">String</span>, Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Colleague&gt;&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Mediator</span> <span class="keyword">for</span> <span class="title class_">GUIMediator</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">add_colleague</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, name: <span class="type">String</span>, colleague: Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Colleague&gt;&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>.colleagues.<span class="title function_ invoke__">entry</span>(name).<span class="title function_ invoke__">or_insert</span>(colleague);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">distribute_message</span>(&amp;<span class="keyword">self</span>, sender: &amp;<span class="type">str</span>, message: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (name, colleague) <span class="keyword">in</span> &amp;<span class="keyword">self</span>.colleagues &#123;</span><br><span class="line">            <span class="keyword">if</span> name.<span class="title function_ invoke__">as_str</span>() != sender &#123;</span><br><span class="line">                colleague.<span class="title function_ invoke__">borrow</span>().<span class="title function_ invoke__">receive</span>(message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">mediator</span> = Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(GUIMediator &#123;</span><br><span class="line">        colleagues: HashMap::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">    &#125;)) <span class="keyword">as</span> Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Mediator&gt;&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">button</span>: Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Colleague&gt;&gt; = Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(Button &#123;</span><br><span class="line">        mediator: <span class="literal">None</span>,</span><br><span class="line">        name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;button&quot;</span>),</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">text_box</span>: Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Colleague&gt;&gt; = Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(TextBox &#123;</span><br><span class="line">        mediator: <span class="literal">None</span>,</span><br><span class="line">        name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;textbox&quot;</span>),</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        button.<span class="title function_ invoke__">borrow_mut</span>().<span class="title function_ invoke__">set_mediator</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;mediator));</span><br><span class="line">        text_box.<span class="title function_ invoke__">borrow_mut</span>().<span class="title function_ invoke__">set_mediator</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;mediator));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">mediator_ref</span> = mediator.<span class="title function_ invoke__">borrow_mut</span>();</span><br><span class="line">        mediator_ref.<span class="title function_ invoke__">add_colleague</span>(<span class="string">&quot;button&quot;</span>.<span class="title function_ invoke__">to_string</span>(), Rc::<span class="title function_ invoke__">clone</span>(&amp;button));</span><br><span class="line">        mediator_ref.<span class="title function_ invoke__">add_colleague</span>(<span class="string">&quot;textbox&quot;</span>.<span class="title function_ invoke__">to_string</span>(), Rc::<span class="title function_ invoke__">clone</span>(&amp;text_box));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    button.<span class="title function_ invoke__">borrow</span>().<span class="title function_ invoke__">send</span>(<span class="string">&quot;点击按钮，更新文本框内容&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="中介者模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象同事类接口，所有参与交互的具体对象都要实现这个接口</span></span><br><span class="line"><span class="keyword">type</span> Colleague <span class="keyword">interface</span> &#123;</span><br><span class="line">    SetMediator(mediator Mediator)</span><br><span class="line">    Send(message <span class="type">string</span>)</span><br><span class="line">    Receive(message <span class="type">string</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中介者接口，定义中介者与同事类交互的方法</span></span><br><span class="line"><span class="keyword">type</span> Mediator <span class="keyword">interface</span> &#123;</span><br><span class="line">    AddColleague(colleague Colleague)</span><br><span class="line">    DistributeMessage(sender Colleague, message <span class="type">string</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体同事类：按钮组件</span></span><br><span class="line"><span class="keyword">type</span> Button <span class="keyword">struct</span> &#123;</span><br><span class="line">    Mediator Mediator</span><br><span class="line">    Text     <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Button)</span></span> SetMediator(mediator Mediator) &#123;</span><br><span class="line">    b.Mediator = mediator</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Button)</span></span> Send(message <span class="type">string</span>) &#123;</span><br><span class="line">    b.Mediator.DistributeMessage(b, message)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Button)</span></span> Receive(message <span class="type">string</span>) &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;按钮 %s 收到消息: %s\n&quot;</span>, b.Text, message)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体同事类：文本框组件</span></span><br><span class="line"><span class="keyword">type</span> TextBox <span class="keyword">struct</span> &#123;</span><br><span class="line">    Mediator Mediator</span><br><span class="line">    Content  <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *TextBox)</span></span> SetMediator(mediator Mediator) &#123;</span><br><span class="line">    t.Mediator = mediator</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *TextBox)</span></span> Send(message <span class="type">string</span>) &#123;</span><br><span class="line">    t.Mediator.DistributeMessage(t,	message)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *TextBox)</span></span> Receive(message <span class="type">string</span>) &#123;</span><br><span class="line">    t.Content = message</span><br><span class="line">    fmt.Printf(<span class="string">&quot;文本框内容更新为: %s\n&quot;</span>, t.Content)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体中介者：GUI中介者</span></span><br><span class="line"><span class="keyword">type</span> GUIMediator <span class="keyword">struct</span> &#123;</span><br><span class="line">    Colleagues []Colleague</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *GUIMediator)</span></span> AddColleague(colleague Colleague) &#123;</span><br><span class="line">    g.Colleagues = <span class="built_in">append</span>(g.Colleagues, colleague)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *GUIMediator)</span></span> DistributeMessage(sender Colleague, message <span class="type">string</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> _, colleague := <span class="keyword">range</span> g.Colleagues &#123;</span><br><span class="line">        <span class="keyword">if</span> colleague!= sender &#123;</span><br><span class="line">        colleague.Receive(message)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    mediator := &amp;GUIMediator&#123;Colleagues: []Colleague&#123;&#125;&#125;</span><br><span class="line"></span><br><span class="line">    button := &amp;Button&#123;</span><br><span class="line">        Mediator: <span class="literal">nil</span>,</span><br><span class="line">        Text:     <span class="string">&quot;点击按钮&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    text_box := &amp;TextBox&#123;</span><br><span class="line">        Mediator: <span class="literal">nil</span>,</span><br><span class="line">        Content:  <span class="string">&quot;初始内容&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    button.SetMediator(mediator)</span><br><span class="line">    text_box.SetMediator(mediator)</span><br><span class="line"></span><br><span class="line">    mediator.AddColleague(button)</span><br><span class="line">    mediator.AddColleague(text_box)</span><br><span class="line"></span><br><span class="line">    button.Send(<span class="string">&quot;点击按钮，更新文本框内容&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="解释器模式"><a class="markdownIt-Anchor" href="#解释器模式"></a> 解释器模式</h4>
<p>解释器设计用于定义一种特定语言的文法表示，并提供一个解释器来按照这些文法规则解析和执行输入的语句或表达式，从而使程序能够理解和处理一种类似自定义 “语言” 的输入内容，并将其转化为具体的操作或计算结果。</p>
<p>该模式具有以下应用场景：</p>
<ul>
<li>计算器程序：用户输入数学表达式，如 <code>(3 + 4) * 2 - 5</code>，解释器模式可定义数字、运算符等的语法规则，解析并计算表达式结果。在科学计算器或金融计算软件等场景中，能灵活处理各种复杂数学运算表达式。</li>
<li>配置文件解析：软件系统常使用配置文件设置参数，格式多样，如 <code>server.port = 8080; database.url = 'jdbc:mysql://localhost:3306/mydb'</code>。解释器模式可解析此类配置文件，按语法规则将内容转换为程序可用的数据结构，以便正确配置系统运行参数。</li>
<li>脚本语言执行：在游戏开发、自动化任务处理等领域，常使用自定义脚本语言。例如游戏中角色行为脚本 <code>if (health &lt; 50) then use_healing_potion ()</code>，解释器模式能解析并执行这类脚本，实现相应游戏逻辑操作，让非专业编程人员也能通过编写简单脚本控制游戏行为。</li>
</ul>
<p>该模式具有以下特点：</p>
<ul>
<li>语法定义灵活性：可根据具体需求灵活定制各种复杂程度的语法规则，涵盖运算符优先级、语句嵌套结构、不同类型词汇（关键字、标识符、常量等），以适配不同应用场景对输入语言的要求。</li>
<li>易于语法扩展：当需扩展所定义语言的语法，如在计算器程序中添加新运算符、在配置文件格式中引入新配置项类型或在脚本语言中增加新命令时，只需在现有语法规则基础上添加和修改相应解释器类即可，相对轻松实现语法扩展。</li>
<li>解析与执行分离：清晰划分输入文本的语法解析过程和依据解析结果执行具体操作的过程。先通过解释器依语法规则解析输入，构建如抽象语法树等中间表示形式，再据此执行实际操作，使整个处理流程更清晰、易理解和维护。</li>
</ul>
<p>该模式具有以下缺点：</p>
<ul>
<li>性能问题：对于复杂的语法和大量的输入语句，解析和执行过程可能会消耗较多的计算资源和时间，导致性能下降。尤其是在实时性要求较高的应用场景中，如高频交易系统中的交易指令解析，如果采用解释器模式处理复杂的交易规则表达式，可能会因性能不佳而影响交易的及时性。</li>
<li>语法复杂性管理：随着语法规则的不断增加和扩展，语法的复杂性会逐渐提高，这可能导致解释器的实现变得复杂且难以维护。不同语法元素之间的相互关系和处理逻辑可能变得错综复杂，使得代码的可读性和可理解性变差。</li>
<li>错误处理困难：在解析输入语句时，可能会出现各种语法错误或语义错误，准确地定位和处理这些错误并非易事。例如，在解析一个复杂的配置文件时，如果用户输入了不符合语法规则的内容，要给出准确且易于理解的错误提示信息，并引导用户正确修改，是比较具有挑战性的。</li>
</ul>
<p>该模式遵循以下设计原则：</p>
<ul>
<li>开闭原则：对扩展开放，对修改关闭。当需添加新语法规则、词汇或修改现有语法时，只需创建新解释器类或对已有解释器类进行调整，无需对使用解释器的客户端代码进行大规模改动。例如，在计算器程序中添加新运算符时，只需创建对应的运算符解释器类并融入现有解释器体系即可。</li>
<li>单一职责原则：每个解释器类通常只负责解析一种特定语法元素或执行一种特定操作，使代码职责明确，便于理解和维护。比如，在表达式求值中，数字常量解释器只负责识别和处理输入文本中的数字常量部分，加法运算符解释器只负责解析和执行加法运算操作。</li>
</ul>
<p>如下是解释器设计模式的类图：</p>
<p><img data-src="//www.plantuml.com/plantuml/png/jP91Iy9W6CVl-nJlhIBqKBSTmWuTwn9qd_fgWtTBjdTHL92GL2fE8b4wH19A49en8gDbNyR7lPty2aq5aRsliWxjjcVF_h_d_pp_c4aLWreQaPRG8F_5Nkki_iHwFN3jGQa1zgEawXGRAIM1qTPHni2cgHxew4H2_ZF-vDVeyWgIaRg-9fsDP2eTQ5MXs_svjATYKe8efebsB2sE3KvezL0X5fv8ZD_5of1_63WLzbtssjMWycOooSiIdABopDoJgg6czmLbCRF_KPlBtBO8LJFa-5_0ODS42znJ35M94ymZTKN3CjgbXggd_x9KzbQ0SvUzjC1kS4lr2MbTmpeLdMmoYIoOQOOVpkx8Ryxnd4yfc91ez7HZDdaoWlQzL-f8_i53T74dcj_AsvZFvlOITb0KYGIxSWxBtWxTAs6wePY3yZEyDy5se5MUrdtjVgymTAzvXuiOV9f3CNY_2obyfAQKGAhXfiYQMR_VkxlmVn6WOrXFMXhv1G00" alt="链接" /></p>
<div class="tabs" id="解释器模式"><ul class="nav-tabs"><li class="tab active"><a href="#解释器模式-1">Go</a></li><li class="tab"><a href="#解释器模式-2">Rust</a></li></ul><div class="tab-content"><div class="tab-pane active" id="解释器模式-1"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象表达式接口，所有具体表达式都要实现此接口</span></span><br><span class="line"><span class="keyword">type</span> Expression <span class="keyword">interface</span> &#123;</span><br><span class="line">	Interpret() <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数字常量表达式，用于表示一个具体数字</span></span><br><span class="line"><span class="keyword">type</span> NumberExpression <span class="keyword">struct</span> &#123;</span><br><span class="line">	Value <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *NumberExpression)</span></span> Interpret() <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> n.Value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加法运算表达式，由两个表达式相加组成</span></span><br><span class="line"><span class="keyword">type</span> AddExpression <span class="keyword">struct</span> &#123;</span><br><span class="line">	Left, Right Expression</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *AddExpression)</span></span> Interpret() <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> a.Left.Interpret() + a.Right.Interpret()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 乘法运算表达式，由两个方面的表达式相乘组成</span></span><br><span class="line"><span class="keyword">type</span> MultiplyExpression <span class="keyword">struct</span> &#123;</span><br><span class="line">	Left, Right Expression</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *MultiplyExpression)</span></span> Interpret() <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> m.Left.Interpret() + m.Right.Interpret()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 变量表达式，用于表示一个变量</span></span><br><span class="line"><span class="keyword">type</span> VariableExpression <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name  <span class="type">string</span></span><br><span class="line">	Value <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *VariableExpression)</span></span> Interpret() <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> v.Value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 赋值语句表达式，由变量和要赋的值（也是一个表达式）组成</span></span><br><span class="line"><span class="keyword">type</span> AssignmentExpression <span class="keyword">struct</span> &#123;</span><br><span class="line">	Variable VariableExpression</span><br><span class="line">	Value    Expression</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *AssignmentExpression)</span></span> Interpret() <span class="type">int</span> &#123;</span><br><span class="line">	assignedValue := a.Value.Interpret()</span><br><span class="line">	a.Variable.Value = assignedValue</span><br><span class="line">	<span class="keyword">return</span> assignedValue</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码，用于解析和计算表达式</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建变量表达式</span></span><br><span class="line">	variableX := &amp;VariableExpression&#123;</span><br><span class="line">		Name:  <span class="string">&quot;x&quot;</span>,</span><br><span class="line">		Value: <span class="number">0</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建数字常量表达式</span></span><br><span class="line">	five := &amp;NumberExpression&#123;Value: <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建加法运算表达式</span></span><br><span class="line">	addExpression := &amp;AddExpression&#123;</span><br><span class="line">		Left:  variableX,</span><br><span class="line">		Right: five,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建赋值语句表达式</span></span><br><span class="line">	assignmentExpression := &amp;AssignmentExpression&#123;</span><br><span class="line">		Variable: *variableX,</span><br><span class="line">		Value:    addExpression,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 解析并计算表达式</span></span><br><span class="line">	result := assignmentExpression.Interpret()</span><br><span class="line">	fmt.Printf(<span class="string">&quot;表达式的结果是: %d\n&quot;</span>, result)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;变量x的值现在是: %d\n&quot;</span>, variableX.Value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="解释器模式-2"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cell::RefCell;</span><br><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象表达式接口，所有具体表达式都要实现此接口</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">interpret</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数字常量表达式，用于表示一个具体数字</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NumberExpression</span> &#123;</span><br><span class="line">    value: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Expression</span> <span class="keyword">for</span> <span class="title class_">NumberExpression</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">interpret</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加法运算表达式，由两个表达式相加组成</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AddExpression</span> &#123;</span><br><span class="line">    left: Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Expression&gt;&gt;,</span><br><span class="line">    right: Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Expression&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Expression</span> <span class="keyword">for</span> <span class="title class_">AddExpression</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">interpret</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.left.<span class="title function_ invoke__">borrow_mut</span>().<span class="title function_ invoke__">interpret</span>() + <span class="keyword">self</span>.right.<span class="title function_ invoke__">borrow_mut</span>().<span class="title function_ invoke__">interpret</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 乘法运算表达式，由两个表达式相乘组成</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MultiplyExpression</span> &#123;</span><br><span class="line">    left: Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Expression&gt;&gt;,</span><br><span class="line">    right: Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Expression&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Expression</span> <span class="keyword">for</span> <span class="title class_">MultiplyExpression</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">interpret</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.left.<span class="title function_ invoke__">borrow_mut</span>().<span class="title function_ invoke__">interpret</span>() * <span class="keyword">self</span>.right.<span class="title function_ invoke__">borrow_mut</span>().<span class="title function_ invoke__">interpret</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 变量表达式，用于表示一个变量</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">VariableExpression</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">    value: <span class="type">i32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Expression</span> <span class="keyword">for</span> <span class="title class_">VariableExpression</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">interpret</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 赋值语句表达式，由变量和要赋的值（也是一个表达式）组成</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AssignmentExpression</span> &#123;</span><br><span class="line">    variable: Rc&lt;RefCell&lt;VariableExpression&gt;&gt;,</span><br><span class="line">    value: Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Expression&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Expression</span> <span class="keyword">for</span> <span class="title class_">AssignmentExpression</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">interpret</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">i32</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">assigned_value</span> = <span class="keyword">self</span>.value.<span class="title function_ invoke__">borrow_mut</span>().<span class="title function_ invoke__">interpret</span>();</span><br><span class="line">        <span class="keyword">self</span>.variable.<span class="title function_ invoke__">borrow_mut</span>().value = assigned_value;</span><br><span class="line">        assigned_value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码，用于解析和计算表达式</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="comment">// 创建变量表达式，x=0</span></span><br><span class="line">    <span class="keyword">let</span>  <span class="variable">variable_x</span> = Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(VariableExpression &#123;</span><br><span class="line">        name: <span class="string">&quot;x&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        value: <span class="number">0</span>,</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建数字常量表达式 5</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">five</span>: Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Expression&gt;&gt; = Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(NumberExpression &#123;value: <span class="number">5</span>&#125;));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">three</span>: Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Expression&gt;&gt; =  Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(NumberExpression &#123;value: <span class="number">3</span>&#125;));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建加法运算表达式，x+5</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">add_expression</span>: Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Expression&gt;&gt; = Rc::<span class="title function_ invoke__">new</span>(RefCell::<span class="title function_ invoke__">new</span>(AddExpression &#123;</span><br><span class="line">        left: Rc::<span class="title function_ invoke__">clone</span>(&amp;variable_x) <span class="keyword">as</span> Rc&lt;RefCell&lt;<span class="keyword">dyn</span> Expression&gt;&gt;,</span><br><span class="line">        right: Rc::<span class="title function_ invoke__">clone</span>(&amp;five),</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建赋值语句表达式</span></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">assignment_expression</span> = AssignmentExpression &#123;</span><br><span class="line">        variable: Rc::<span class="title function_ invoke__">clone</span>(&amp;variable_x),</span><br><span class="line">        value: Rc::<span class="title function_ invoke__">clone</span>(&amp;add_expression),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析并计算表达式</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">result</span> = assignment_expression.<span class="title function_ invoke__">interpret</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;表达式的结果是: &#123;&#125;&quot;</span>, result);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;变量x的值现在是: &#123;:?&#125;&quot;</span>, variable_x.<span class="title function_ invoke__">borrow_mut</span>().<span class="title function_ invoke__">interpret</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="备忘录模式"><a class="markdownIt-Anchor" href="#备忘录模式"></a> 备忘录模式</h4>
<p>备忘录设计<span style="color:red"><strong>用于在不破坏对象封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态，以便之后可以将对象恢复到先前保存的状态。简单来说，就像是给对象的某个时刻的状态拍了一张<code>快照</code>，之后可以根据这张<code>快照</code>让对象回到那个时候的样子</strong></span>。</p>
<p>该模式具有以下应用场景：</p>
<ul>
<li>文本编辑器的撤销 / 重做功能：在文本编辑器中，用户进行输入、删除、修改等一系列操作。每次操作后，都可以使用备忘录模式保存文本编辑器当前的状态（如文本内容、光标位置、选中区域等）。当用户点击撤销按钮时，就可以从备忘录中取出上一次保存的状态并恢复，实现撤销功能；同理，重做功能也可以基于备忘录中保存的不同状态来实现，通过记录多个状态的备忘录，可以支持多次撤销和重做操作。</li>
<li>游戏存档功能：在游戏中，玩家在游戏过程中的各个关键节点（如完成一个关卡、获得重要道具等）可能希望保存游戏当前的状态（包括角色的属性、位置、游戏场景中的各种元素状态等）。备忘录模式可以用于创建这些游戏状态的备忘录，以便玩家之后可以从存档点重新开始游戏，或者在出现意外情况（如游戏崩溃）时恢复到之前保存的正常游戏状态。</li>
<li>数据库事务管理：在数据库操作中，一个事务可能包含多个数据库操作语句（如插入、更新、删除等）。在事务执行过程中，如果出现错误或者需要回滚到事务开始前的状态，可以使用备忘录模式保存事务开始时数据库相关表的状态（如记录的原始数据值等）。一旦需要回滚，就可以根据备忘录中的状态信息将数据库表恢复到事务开始前的样子，保证数据的一致性和完整性。</li>
</ul>
<p>该模式具有以下特点：</p>
<ul>
<li>状态保存与恢复：能够方便地保存对象的某个时刻的完整状态，并在需要时准确地将对象恢复到该状态，使得对象的状态变化具有可追溯性和可逆性。</li>
<li>不破坏封装性：在保存和恢复对象状态的过程中，不需要对象暴露其内部的实现细节，完全在对象外部通过备忘录对象来处理状态的捕获和恢复，维护了对象的封装性，使得对象的内部结构可以自由变化而不影响备忘录模式的使用。</li>
<li>多状态记录支持：可以根据需要记录对象的多个不同状态，形成一个状态备忘录的序列，从而支持多次撤销、重做或在不同状态之间进行切换的功能，为用户提供了更灵活的操作体验。</li>
</ul>
<p>该模式具有以下缺点：</p>
<ul>
<li>内存消耗：如果需要频繁地保存对象的状态，尤其是对于复杂对象或者对象状态数据量较大的情况，可能会占用大量的内存空间来存储这些备忘录对象，导致内存资源的浪费和性能下降。</li>
<li>状态一致性维护：在对象的状态发生复杂变化或者涉及多个相关对象的状态同步时，确保备忘录中保存的状态与对象实际应该恢复到的状态完全一致可能会比较困难，需要仔细处理对象之间的依赖关系和状态更新逻辑，否则可能会导致恢复后的状态出现错误或不符合预期。</li>
</ul>
<p>该模式遵循以下设计原则：</p>
<ul>
<li>单一职责原则（SRP）：备忘录模式通过将状态的保存和恢复职责封装在不同的类中，实现了单一职责。</li>
<li>开放封闭原则（OCP）：备忘录模式允许在不修改现有代码的情况下扩展新的功能，例如增加更多的状态保存点。</li>
</ul>
<p>如下是备忘录模式的类图示例：</p>
<p><img data-src="//www.plantuml.com/plantuml/png/nLFBRjD05DtxAxmZ0T8FY51LYJLYmH8Xox9l8WjxN8qdeZmg9OZGbaP9U1HLuL5LBG-1A5Gfj5NJvcSyjhlABt3hiIUJ4gJkcasicNFFlUUUCtC1CochUQvsHUVRItoupe_NelOdtjdI7CA0LamBz5lW0M6-_bZJyKSXO3u50qiP57pgL1rYuabPlos_YzeYCfw-hoUV6-7m0_-n7h_u4zKRSUyPRs_mBwlyvs6okpaQBFFEo-JtVb9lZWOhckMQGQ3GP1slCLXWXkNZG8ILzJkCEgGgRgmQ3NngpFk1mnoVbFLQu3m2SHU02nO3sp0fc3ZT_1dYHY55N1V0ugo0Lf0R1JrqOPAUm8D2KLULvTJCK8Sg8D2ODcLnZ3ytQbeoVNobQ493Md8XLRf2CTQMrlyhDSDQoCV0y8JPgUpCU76V-rwXlYTHsR-42kDvSpyyVercoqpndOzn-rUyUvHvVDCds8z1LdRfHbyyrF7EPjnzZe55CQD1AzdRIFQsCE3ywLV-gXLrkk79EobRn3pNZECnypx8M6VB2-JsxjwRZ9si4CUcRVz_yG9I1IOX3h5X8LkKwkQYbbhKZ_j7sZaVPcQUpEOuh12kQSg3B9NKUoH96c_m5QkF-hJUIuPBasd2pKoBJ_JsCEglXGTjkR2SSKKRR-jggQJqJ1eztbt6dgeHlDNatUzyknSUV5Cp5vwidd7D0R5hdliN" alt="链接" /></p>
<div class="tabs" id="备忘录模式"><ul class="nav-tabs"><li class="tab active"><a href="#备忘录模式-1">Rust</a></li><li class="tab"><a href="#备忘录模式-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="备忘录模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 备忘录接口，定义了恢复对象状态的方法</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Memento</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">restore_state</span>(&amp;<span class="keyword">self</span>, originator: &amp;<span class="keyword">mut</span> Originator);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要保存状态的原始对象（发起者）</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Originator</span> &#123;</span><br><span class="line">    text_content: <span class="type">String</span>,</span><br><span class="line">    cursor_position: <span class="type">usize</span>,</span><br><span class="line">    selected_area: <span class="type">Option</span>&lt;(<span class="type">usize</span>, <span class="type">usize</span>)&gt;,</span><br><span class="line">    font_style: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Originator</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        Originator &#123;</span><br><span class="line">            text_content: <span class="type">String</span>::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">            cursor_position: <span class="number">0</span>,</span><br><span class="line">            selected_area: <span class="literal">None</span>,</span><br><span class="line">            font_style: <span class="type">String</span>::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_text_content</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, new_text_content: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.text_content = new_text_content.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_cursor_position</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, new_cursor_position: <span class="type">usize</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.cursor_position = new_cursor_position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_selected_area</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, new_selected_area: <span class="type">Option</span>&lt;(<span class="type">usize</span>, <span class="type">usize</span>)&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>.selected_area = new_selected_area;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_font_style</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, new_font_style: &amp;<span class="type">str</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.font_style = new_font_style.<span class="title function_ invoke__">to_string</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建备忘录对象，保存当前状态</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">create_memento</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Memento&gt; &#123;</span><br><span class="line">        <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(ConcreteMemento &#123;</span><br><span class="line">            text_content: <span class="keyword">self</span>.text_content.<span class="title function_ invoke__">clone</span>(),</span><br><span class="line">            cursor_position: <span class="keyword">self</span>.cursor_position,</span><br><span class="line">            selected_area: <span class="keyword">self</span>.selected_area,</span><br><span class="line">            font_style: <span class="keyword">self</span>.font_style.<span class="title function_ invoke__">clone</span>(),</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从备忘录对象中恢复状态</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">restore_from_memento</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, memento: &amp;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Memento&gt;) &#123;</span><br><span class="line">        memento.<span class="title function_ invoke__">restore_state</span>(<span class="keyword">self</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的备忘录实现类</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ConcreteMemento</span> &#123;</span><br><span class="line">    text_content: <span class="type">String</span>,</span><br><span class="line">    cursor_position: <span class="type">usize</span>,</span><br><span class="line">    selected_area: <span class="type">Option</span>&lt;(<span class="type">usize</span>, <span class="type">usize</span>)&gt;,</span><br><span class="line">    font_style: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Memento</span> <span class="keyword">for</span> <span class="title class_">ConcreteMemento</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">restore_state</span>(&amp;<span class="keyword">self</span>, originator: &amp;<span class="keyword">mut</span> Originator) &#123;</span><br><span class="line">        originator.<span class="title function_ invoke__">set_text_content</span>(&amp;<span class="keyword">self</span>.text_content);</span><br><span class="line">        originator.<span class="title function_ invoke__">set_cursor_position</span>(<span class="keyword">self</span>.cursor_position);</span><br><span class="line">        originator.<span class="title function_ invoke__">set_selected_area</span>(<span class="keyword">self</span>.selected_area);</span><br><span class="line">        originator.<span class="title function_ invoke__">set_font_style</span>(&amp;<span class="keyword">self</span>.font_style);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 管理者类，负责存储和提供备忘录对象</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Caretaker</span> &#123;</span><br><span class="line">    mementos: <span class="type">Vec</span>&lt;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Memento&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Caretaker</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>() <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        Caretaker &#123; mementos: <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>() &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">add_memento</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, memento: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Memento&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>.mementos.<span class="title function_ invoke__">push</span>(memento);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_memento</span>(&amp;<span class="keyword">self</span>, index: <span class="type">usize</span>) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;&amp;<span class="type">Box</span>&lt;<span class="keyword">dyn</span> Memento&gt;&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span>.mementos.<span class="title function_ invoke__">get</span>(index)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码示例，模拟文本编辑器的撤销/重做功能</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">originator</span> = Originator::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">caretaker</span> = Caretaker::<span class="title function_ invoke__">new</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置初始状态</span></span><br><span class="line">    originator.<span class="title function_ invoke__">set_text_content</span>(<span class="string">&quot;这是初始文本内容&quot;</span>);</span><br><span class="line">    originator.<span class="title function_ invoke__">set_cursor_position</span>(<span class="number">5</span>);</span><br><span class="line">    originator.<span class="title function_ invoke__">set_selected_area</span>(<span class="title function_ invoke__">Some</span>((<span class="number">2</span>, <span class="number">4</span>)));</span><br><span class="line">    originator.<span class="title function_ invoke__">set_font_style</span>(<span class="string">&quot;宋体&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建并保存初始状态的备忘录</span></span><br><span class="line">    caretaker.<span class="title function_ invoke__">add_memento</span>(originator.<span class="title function_ invoke__">create_memento</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 修改状态</span></span><br><span class="line">    originator.<span class="title function_ invoke__">set_text_content</span>(<span class="string">&quot;修改后的文本内容&quot;</span>);</span><br><span class="line">    originator.<span class="title function_ invoke__">set_cursor_position</span>(<span class="number">10</span>);</span><br><span class="line">    originator.<span class="title function_ invoke__">set_selected_area</span>(<span class="title function_ invoke__">Some</span>((<span class="number">3</span>, <span class="number">6</span>)));</span><br><span class="line">    originator.<span class="title function_ invoke__">set_font_style</span>(<span class="string">&quot;黑体&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建并保存修改后状态的备忘录</span></span><br><span class="line">    caretaker.<span class="title function_ invoke__">add_memento</span>(originator.<span class="title function_ invoke__">create_memento</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模拟撤销操作，恢复到上一个状态</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(memento) = caretaker.<span class="title function_ invoke__">get_memento</span>(<span class="number">0</span>) &#123;</span><br><span class="line">        originator.<span class="title function_ invoke__">restore_from_memento</span>(memento);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;当前文本内容: &#123;&#125;&quot;</span>, originator.text_content);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;当前光标位置: &#123;&#125;&quot;</span>, originator.cursor_position);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;当前选中区域: &#123;:?&#125;&quot;</span>, originator.selected_area);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;当前字体样式: &#123;&#125;&quot;</span>, originator.font_style);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="备忘录模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 备忘录接口，定义了恢复对象状态的方法</span></span><br><span class="line"><span class="keyword">type</span> Memento <span class="keyword">interface</span> &#123;</span><br><span class="line">	RestoreState(originator *Originator)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 需要保存状态的原始对象（发起者）</span></span><br><span class="line"><span class="keyword">type</span> Originator <span class="keyword">struct</span> &#123;</span><br><span class="line">	TextContent    <span class="type">string</span></span><br><span class="line">	CursorPosition <span class="type">int</span></span><br><span class="line">	SelectedArea   *[<span class="number">2</span>]<span class="type">int</span></span><br><span class="line">	FontStyle      <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *Originator)</span></span> New() *Originator &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;Originator&#123;</span><br><span class="line">		TextContent:    <span class="string">&quot;&quot;</span>,</span><br><span class="line">		CursorPosition: <span class="number">0</span>,</span><br><span class="line">		SelectedArea:   <span class="literal">nil</span>,</span><br><span class="line">		FontStyle:      <span class="string">&quot;&quot;</span>,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *Originator)</span></span> SetTextContent(newTextContent <span class="type">string</span>) &#123;</span><br><span class="line">	o.TextContent = newTextContent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *Originator)</span></span> SetCursorPosition(newCursorPosition <span class="type">int</span>) &#123;</span><br><span class="line">	o.CursorPosition = newCursorPosition</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *Originator)</span></span> SetSelectedArea(newSelectedArea *[<span class="number">2</span>]<span class="type">int</span>) &#123;</span><br><span class="line">	o.SelectedArea = newSelectedArea</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *Originator)</span></span> SetFontStyle(newFontStyle <span class="type">string</span>) &#123;</span><br><span class="line">	o.FontStyle = newFontStyle</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建备忘录对象，保存当前状态</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *Originator)</span></span> CreateMemento() Memento &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;ConcreteMemento&#123;</span><br><span class="line">		TextContent:    o.TextContent,</span><br><span class="line">		CursorPosition: o.CursorPosition,</span><br><span class="line">		SelectedArea:   o.SelectedArea,</span><br><span class="line">		FontStyle:      o.FontStyle,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从备忘录对象中恢复状态</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *Originator)</span></span> RestoreFromMemento(memento Memento) &#123;</span><br><span class="line">	memento.RestoreState(o)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的备忘录实现类</span></span><br><span class="line"><span class="keyword">type</span> ConcreteMemento <span class="keyword">struct</span> &#123;</span><br><span class="line">	TextContent    <span class="type">string</span></span><br><span class="line">	CursorPosition <span class="type">int</span></span><br><span class="line">	SelectedArea   *[<span class="number">2</span>]<span class="type">int</span></span><br><span class="line">	FontStyle      <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *ConcreteMemento)</span></span> RestoreState(originator *Originator) &#123;</span><br><span class="line">	originator.SetTextContent(c.TextContent)</span><br><span class="line">	originator.SetCursorPosition(c.CursorPosition)</span><br><span class="line">	originator.SetSelectedArea(c.SelectedArea)</span><br><span class="line">	originator.SetFontStyle(c.FontStyle)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 管理者类，负责存储和提供备忘录对象</span></span><br><span class="line"><span class="keyword">type</span> Caretaker <span class="keyword">struct</span> &#123;</span><br><span class="line">	Mementos []Memento</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Caretaker)</span></span> New() *Caretaker &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;Caretaker&#123;</span><br><span class="line">		Mementos: []Memento&#123;&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Caretaker)</span></span> AddMemento(memento Memento) &#123;</span><br><span class="line">	c.Mementos = <span class="built_in">append</span>(c.Mementos, memento)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Caretaker)</span></span> GetMemento(index <span class="type">int</span>) Memento &#123;</span><br><span class="line">	<span class="keyword">if</span> index &lt; <span class="built_in">len</span>(c.Mementos) &#123;</span><br><span class="line">		<span class="keyword">return</span> c.Mementos[index]</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码示例，模拟文本编辑器的撤销/重做功能</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	originator := &amp;Originator&#123;&#125;</span><br><span class="line">	caretaker := &amp;Caretaker&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置初始状态</span></span><br><span class="line">	originator.SetTextContent(<span class="string">&quot;这是初始文本内容&quot;</span>)</span><br><span class="line">	originator.SetCursorPosition(<span class="number">5</span>)</span><br><span class="line">	originator.SetSelectedArea(&amp;[<span class="number">2</span>]<span class="type">int</span>&#123;<span class="number">2</span>, <span class="number">4</span>&#125;)</span><br><span class="line">	originator.SetFontStyle(<span class="string">&quot;宋体&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建并保存初始状态的备忘录</span></span><br><span class="line">	caretaker.AddMemento(originator.CreateMemento())</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 修改状态</span></span><br><span class="line">	originator.SetTextContent(<span class="string">&quot;修改后的文本内容&quot;</span>)</span><br><span class="line">	originator.SetCursorPosition(<span class="number">10</span>)</span><br><span class="line">	originator.SetSelectedArea(&amp;[<span class="number">2</span>]<span class="type">int</span>&#123;<span class="number">3</span>, <span class="number">6</span>&#125;)</span><br><span class="line">	originator.SetFontStyle(<span class="string">&quot;黑体&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建并保存修改后状态的备忘录</span></span><br><span class="line">	caretaker.AddMemento(originator.CreateMemento())</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 模拟撤销操作，恢复到上一个状态</span></span><br><span class="line">	<span class="keyword">if</span> memento := caretaker.GetMemento(<span class="number">0</span>); memento != <span class="literal">nil</span> &#123;</span><br><span class="line">		originator.RestoreFromMemento(memento)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;当前文本内容: %s\n&quot;</span>, originator.TextContent)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;当前光标位置: %d\n&quot;</span>, originator.CursorPosition)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;当前选中区域: %v\n&quot;</span>, originator.SelectedArea)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;当前字体样式: %s\n&quot;</span>, originator.FontStyle)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="观察者模式"><a class="markdownIt-Anchor" href="#观察者模式"></a> 观察者模式</h4>
<p>观察者模式<span style="color:red"><strong>定义了一种一对多的依赖关系，让一个被观察的对象（主题 <code>Subject</code>）在自身状态发生变化时，能够自动通知所有依赖它的观察者对象（<code>Observer</code>），使得观察者们可以根据主题的状态变化采取相应的行动</strong></span>。</p>
<p>该模式具有以下应用场景：</p>
<ul>
<li>股票交易系统：在股票交易市场中，股票价格是不断变化的主题。众多投资者是观察者，他们关注着特定股票的价格走势。当某只股票的价格发生变化时，股票交易系统作为主题对象，会通知所有关注该股票的投资者（观察者）。投资者们（观察者）根据收到的价格变化信息，结合自己的投资策略，可能会采取买入、卖出或继续持有等不同的操作。</li>
<li>用户界面更新：在图形用户界面（GUI）应用程序中，例如一个包含多个组件（如按钮、文本框、进度条等）的窗口。当用户在窗口中进行某些操作（如点击按钮、在文本框中输入内容等），可能会导致窗口的整体状态发生变化，比如窗口大小改变、某些数据更新等。此时，窗口可以作为主题，而各个组件则是观察者。窗口状态的任何变化都需要通知到各个组件，以便它们能够相应地更新自己的显示内容或执行其他相关操作，如按钮可能需要改变其可用性状态，文本框可能需要重新绘制以显示新输入的内容，进度条可能需要根据新的数据更新其进度显示等。</li>
<li>社交媒体平台的消息推送：在社交媒体平台上，用户发布的新动态（如微博、朋友圈等）是主题。关注该用户的其他用户则是观察者。当一个用户发布了新动态，社交媒体平台会将这条新动态的信息推送给所有关注该用户的其他用户（观察者）。这些观察者用户可以根据收到的新动态内容，选择点赞、评论、转发等不同的操作。</li>
</ul>
<p>该模式具有以下特点：</p>
<ul>
<li>松耦合：主题和观察者之间是松耦合的关系。主题只知道有哪些观察者对象依赖于它，但并不需要了解观察者的具体细节，如它们如何处理接收到的通知等。同样，观察者也只需要知道它所观察的主题对象，而不需要关心主题内部是如何实现状态变化检测以及通知发送机制的。这种松耦合使得主题和观察者可以独立地进行扩展和修改，不会因为一方的变化而对另一方产生过多的影响。</li>
<li>动态添加和删除观察者：可以在运行时动态地添加或删除观察者对象。例如，在股票交易系统中，投资者可以随时决定关注或取消关注某只股票，这就相当于在主题（股票价格对象）上动态地添加或删除观察者（投资者对象）。这种灵活性使得系统能够更好地适应不同的应用场景和用户需求。</li>
<li>自动通知机制：一旦主题的状态发生变化，它会自动地通知所有已注册的观察者对象，无需手动逐个去通知。这大大简化了在多个对象之间传递状态变化信息的过程，提高了系统的响应速度和效率，确保观察者们能够及时获取到主题的最新状态信息并做出相应的反应。</li>
</ul>
<p>该模式具有以下缺点：</p>
<ul>
<li>内存泄漏风险：如果观察者对象在不再需要被通知（例如，相关的业务逻辑已经结束或者用户已经取消了关注等情况）时，没有及时从主题对象中删除自己，那么主题对象在每次状态变化时仍然会尝试通知这些已经无用的观察者对象，这可能会导致内存泄漏问题，尤其是在长时间运行的应用程序中，随着无用观察者对象的不断积累，内存占用会越来越大，最终影响系统的性能。</li>
<li>通知顺序不确定：当主题对象通知多个观察者对象时，通常并没有规定通知的顺序。这可能会导致在一些对通知顺序有要求的应用场景中出现问题。例如，在一个涉及多个组件协同工作的复杂 GUI 应用程序中，如果某些组件的更新操作依赖于其他组件先完成更新，那么由于无法确定通知的顺序，可能会出现组件更新顺序混乱的情况，从而影响整个系统的正常运行。</li>
<li>过度使用导致复杂度过高：在一些简单的应用场景中，如果过度使用观察者设计模式，可能会引入不必要的复杂性。因为每增加一个主题和一组观察者，就需要管理它们之间的注册、通知等一系列关系，这可能会使代码变得难以理解和维护，尤其是当系统中有大量的主题和观察者对象时，整个系统的架构会变得非常复杂。</li>
</ul>
<p>该模式遵循以下设计原则：</p>
<ul>
<li>单一职责原则（SRP）：观察者模式中的每个类都有明确的职责，被观察者负责管理状态，观察者负责响应状态变化。</li>
<li>开闭原则（OCP）：观察者模式允许在不修改现有代码的情况下增加新的观察者，符合开闭原则。</li>
</ul>
<p>如下是观察者模式的类图：</p>
<p><img data-src="//www.plantuml.com/plantuml/png/SoWkIImgAStDuL9NUB6ywUdw-IyQMf_rBNtQlvWhCwyajIWjCJbLmJ-fEBMeBBL8ePfB0GXA2r8IIr8rYakJibAJIwmKWY4CJQvQe2bFTkn-kMW6kX4mDL0J4bDIulEXXch065PmUpJ1YefIS_FBKWchoyiloKohXAihre0uv6dhzYTx9p-VrG9nqTDryvxtRNY-SVVxFJrFTYzzqRJm-T8LJtPlVxPWpvCTkvxiw-PApaaiBbO8BibFpWueoanEXRfLkm34iL98CpE1yE4M8HmI7GkH8ifVsiHwJ1k7pvvrJNsnjGKOKK_spW6w7HvlGBz2F0ttAzHFddbbgSKb-KKm7-KbvgPQ0NrQb9cN3X791Al8JSqhYIykAGB6RdebgW8ySGuEwytFD-_cWjcZfrTZXqWqLWeGzt0XWXQa06O4Dda5NLra0q3clsYSydvF1tAq0Vttic7MY_tjwC7qRDhEPvkdFjdH1myPcFvEBeVKl1HWSWS0" alt="链接" /></p>
<div class="tabs" id="观察者模式"><ul class="nav-tabs"><li class="tab active"><a href="#观察者模式-1">Rust</a></li><li class="tab"><a href="#观察者模式-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="观察者模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::any::Any;</span><br><span class="line"><span class="keyword">use</span> std::rc::Rc;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察者接口，定义了接收通知的方法</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">update</span>(&amp;<span class="keyword">self</span>, subject: &amp;<span class="keyword">dyn</span> Subject);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 主题接口，定义了添加观察者、删除观察者以及通知观察者的方法</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Subject</span>: Any &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">add_observer</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, observer: Rc&lt;<span class="keyword">dyn</span> Observer&gt;);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">remove_observer</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, observer: Rc&lt;<span class="keyword">dyn</span> Observer&gt;) <span class="punctuation">-&gt;</span> <span class="type">bool</span>;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">notify_observers</span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">as_any</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">dyn</span> Any;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的主题实现类，以股票价格为例</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">StockPrice</span> &#123;</span><br><span class="line">    price: <span class="type">f64</span>,</span><br><span class="line">    observers: <span class="type">Vec</span>&lt;Rc&lt;<span class="keyword">dyn</span> Observer&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Subject</span> <span class="keyword">for</span> <span class="title class_">StockPrice</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">add_observer</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, observer: Rc&lt;<span class="keyword">dyn</span> Observer&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>.observers.<span class="title function_ invoke__">push</span>(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">remove_observer</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, observer: Rc&lt;<span class="keyword">dyn</span> Observer&gt;) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(index) = <span class="keyword">self</span></span><br><span class="line">            .observers</span><br><span class="line">            .<span class="title function_ invoke__">iter</span>()</span><br><span class="line">            .<span class="title function_ invoke__">position</span>(|o| &#123;</span><br><span class="line">                std::ptr::<span class="title function_ invoke__">addr_eq</span>(&amp;**o <span class="keyword">as</span> *<span class="keyword">const</span> <span class="keyword">dyn</span> Observer, &amp;*observer <span class="keyword">as</span> *<span class="keyword">const</span> <span class="keyword">dyn</span> Observer)</span><br><span class="line">            &#125;) &#123;</span><br><span class="line">            <span class="keyword">self</span>.observers.<span class="title function_ invoke__">remove</span>(index);</span><br><span class="line">            <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">notify_observers</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">observer</span> <span class="keyword">in</span> &amp;<span class="keyword">self</span>.observers &#123;</span><br><span class="line">            observer.<span class="title function_ invoke__">update</span>(<span class="keyword">self</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">as_any</span>(&amp;<span class="keyword">self</span>) <span class="punctuation">-&gt;</span> &amp;<span class="keyword">dyn</span> Any &#123;</span><br><span class="line">        <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 投资者作为观察者的具体实现类</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Investor</span> &#123;</span><br><span class="line">    name: <span class="type">String</span>,</span><br><span class="line">    investment_strategy: <span class="type">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Observer</span> <span class="keyword">for</span> <span class="title class_">Investor</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">update</span>(&amp;<span class="keyword">self</span>, subject: &amp;<span class="keyword">dyn</span> Subject) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(stock_price) = subject.<span class="title function_ invoke__">as_any</span>().downcast_ref::&lt;StockPrice&gt;() &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">&quot;投资者 &#123;&#125; 收到股票价格更新通知，当前价格: &#123;&#125;&quot;</span>, <span class="keyword">self</span>.name, stock_price.price);</span><br><span class="line">            <span class="comment">// 根据投资策略进行决策，这里只是简单示例</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.investment_strategy == <span class="string">&quot;买入&quot;</span> &amp;&amp; stock_price.price &lt; <span class="number">100.0</span> &#123;</span><br><span class="line">                <span class="built_in">println!</span>(<span class="string">&quot;投资者 &#123;&#125; 决定买入&quot;</span>, <span class="keyword">self</span>.name);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">self</span>.investment_strategy == <span class="string">&quot;卖出&quot;</span> &amp;&amp; stock_price.price &gt; <span class="number">100.0</span> &#123;</span><br><span class="line">                <span class="built_in">println!</span>(<span class="string">&quot;投资者 &#123;&#125; 决定卖出&quot;</span>, <span class="keyword">self</span>.name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">stock_price</span> = StockPrice &#123;</span><br><span class="line">        price: <span class="number">90.0</span>,</span><br><span class="line">        observers: <span class="type">Vec</span>::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">investor1</span>: Rc&lt;<span class="keyword">dyn</span> Observer&gt; = Rc::<span class="title function_ invoke__">new</span>(Investor &#123;</span><br><span class="line">        name: <span class="string">&quot;张三&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">        investment_strategy: <span class="string">&quot;买入&quot;</span>.<span class="title function_ invoke__">to_string</span>(),</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">investor2</span>: Rc&lt;<span class="keyword">dyn</span> Observer&gt; = Rc::<span class="title function_ invoke__">new</span>(Investor &#123;</span><br><span class="line">        name: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;李四&quot;</span>),</span><br><span class="line">        investment_strategy: <span class="type">String</span>::<span class="title function_ invoke__">from</span>(<span class="string">&quot;卖出&quot;</span>),</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加张三和李四作为观察者</span></span><br><span class="line">    stock_price.<span class="title function_ invoke__">add_observer</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;investor1));</span><br><span class="line">    stock_price.<span class="title function_ invoke__">add_observer</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;investor2));</span><br><span class="line">    stock_price.price = <span class="number">110.0</span>;</span><br><span class="line">    stock_price.<span class="title function_ invoke__">notify_observers</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 移除李四作为观察者</span></span><br><span class="line">    stock_price.<span class="title function_ invoke__">remove_observer</span>(Rc::<span class="title function_ invoke__">clone</span>(&amp;investor2));</span><br><span class="line">    stock_price.price = <span class="number">99.0</span>;</span><br><span class="line">    stock_price.<span class="title function_ invoke__">notify_observers</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="观察者模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察者接口，定义了接收通知的方法</span></span><br><span class="line"><span class="keyword">type</span> Observer <span class="keyword">interface</span> &#123;</span><br><span class="line">	Update(subject Subject)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主题接口，定义了添加观察者、删除观察者以及通知观察者的方法</span></span><br><span class="line"><span class="keyword">type</span> Subject <span class="keyword">interface</span> &#123;</span><br><span class="line">	AddObserver(observer Observer) <span class="type">bool</span></span><br><span class="line">	RemoveObserver(observer Observer) <span class="type">bool</span></span><br><span class="line">	NotifyObservers()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的主题实现类，以股票价格为例</span></span><br><span class="line"><span class="keyword">type</span> StockPrice <span class="keyword">struct</span> &#123;</span><br><span class="line">	Price     <span class="type">float64</span></span><br><span class="line">	Observers []Observer</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *StockPrice)</span></span> AddObserver(observer Observer) <span class="type">bool</span> &#123;</span><br><span class="line">	s.Observers = <span class="built_in">append</span>(s.Observers, observer)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *StockPrice)</span></span> RemoveObserver(observer Observer) <span class="type">bool</span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i, o := <span class="keyword">range</span> s.Observers &#123;</span><br><span class="line">		<span class="keyword">if</span> o == observer &#123;</span><br><span class="line">			s.Observers = <span class="built_in">append</span>(s.Observers[:i], s.Observers[i+<span class="number">1</span>:]...)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *StockPrice)</span></span> NotifyObservers() &#123;</span><br><span class="line">	<span class="keyword">for</span> _, observer := <span class="keyword">range</span> s.Observers &#123;</span><br><span class="line">		observer.Update(s)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 投资者作为观察者的具体实现类</span></span><br><span class="line"><span class="keyword">type</span> Investor <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name               <span class="type">string</span></span><br><span class="line">	InvestmentStrategy <span class="type">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *Investor)</span></span> Update(subject Subject) &#123;</span><br><span class="line">	<span class="keyword">if</span> stockPrice, ok := subject.(*StockPrice); ok &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;投资者 %s 收到股票价格更新通知，当前价格: %f\n&quot;</span>, i.Name, stockPrice.Price)</span><br><span class="line">		<span class="comment">// 根据投资策略进行决策，这里只是简单示例</span></span><br><span class="line">		<span class="keyword">if</span> i.InvestmentStrategy == <span class="string">&quot;买入&quot;</span> &amp;&amp; stockPrice.Price &lt; <span class="number">100.0</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;投资者 %s 决定买入\n&quot;</span>, i.Name)</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> i.InvestmentStrategy == <span class="string">&quot;卖出&quot;</span> &amp;&amp; stockPrice.Price &gt; <span class="number">100.0</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;投资者 %s 决定卖出\n&quot;</span>, i.Name)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	stockPrice := &amp;StockPrice&#123;</span><br><span class="line">		Price:     <span class="number">90.0</span>,</span><br><span class="line">		Observers: []Observer&#123;&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	investor1 := &amp;Investor&#123;</span><br><span class="line">		Name:               <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">		InvestmentStrategy: <span class="string">&quot;买入&quot;</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	investor2 := &amp;Investor&#123;</span><br><span class="line">		Name:               <span class="string">&quot;李四&quot;</span>,</span><br><span class="line">		InvestmentStrategy: <span class="string">&quot;卖出&quot;</span>,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	stockPrice.AddObserver(investor1)</span><br><span class="line">	stockPrice.AddObserver(investor2)</span><br><span class="line"></span><br><span class="line">	stockPrice.Price = <span class="number">110.0</span></span><br><span class="line">	stockPrice.NotifyObservers()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="状态模式"><a class="markdownIt-Anchor" href="#状态模式"></a> 状态模式</h4>
<p>状态模式<span style="color:red"><strong>允许一个对象在其内部状态改变时改变其行为方式，核心通过将对象的不同状态封装成独立的类，并让对象的行为依赖于当前所处的状态，使得代码结构更加清晰、易于维护和扩展，状态机的实现就是使用了该模式</strong></span>。</p>
<p>该模式具有以下应用场景：</p>
<ul>
<li>交通信号灯控制系统：交通信号灯有不同的状态，如红灯、绿灯、黄灯。在不同状态下，信号灯的行为不同，例如红灯时禁止通行，绿灯时允许通行，黄灯时警示通行。使用状态模式，可以将每个信号灯状态封装成一个独立的类，交通信号灯对象根据当前所处的状态类来执行相应的行为，当状态发生变化时（如从绿灯变为黄灯），只需切换到对应的状态类，信号灯的行为就会相应改变。</li>
<li>媒体播放器应用：媒体播放器有多种状态，如播放、暂停、停止等。在播放状态下，可以进行调节音量、快进、快退等操作；在暂停状态下，可以恢复播放或停止播放；在停止状态下，可以开始播放等。通过状态模式，把每个状态对应的操作封装在各自的状态类中，媒体播放器对象根据当前状态来执行合适的操作，当用户进行操作导致状态改变时（如点击暂停按钮使播放状态变为暂停状态），播放器的可执行操作也随之改变。</li>
<li>订单处理系统：订单在处理过程中有不同状态，如已下单、已支付、已发货、已完成等。不同状态下订单的处理逻辑和可执行操作不同，例如已下单状态下可以修改订单信息，已支付状态下可以安排发货，已发货状态下可以跟踪物流，已完成状态下可以进行订单评价等。利用状态模式，将每个订单状态对应的处理逻辑封装成独立的状态类，订单对象依据当前所处的状态来执行相应的操作，随着订单处理流程推进状态发生变化，其行为也相应改变。</li>
</ul>
<p>该模式具有以下特点:</p>
<ul>
<li>状态封装与独立性：将不同的状态及其相关行为封装成独立的状态类，每个状态类负责处理该状态下对象的特定行为，使得状态相关的逻辑更加清晰、易于理解和维护。不同状态类之间相互独立，修改一个状态类的行为不会影响到其他状态类。</li>
<li>行为随状态变化：对象的行为由其当前所处的状态决定，当状态发生变化时，对象自动切换到对应的状态类，从而改变其行为方式。这种动态的行为改变使得代码能够更好地适应对象在不同状态下的不同需求，无需使用大量的条件判断语句来处理不同状态下的行为差异。</li>
<li>易于扩展新状态：当需要添加新的状态及其相关行为时，只需创建一个新的状态类并实现相应的接口或继承相关的抽象类，然后在对象中添加逻辑以切换到这个新状态即可。对现有代码的改动较小，符合开闭原则，便于系统的扩展。</li>
</ul>
<p>该模式具有以下的缺点：</p>
<ul>
<li>类数量增加：随着状态数量的增加，需要创建相应数量的状态类，可能导致类的数量过多，增加了代码的复杂性和维护成本。尤其是在一些简单的场景中，如果过度使用状态模式，可能会使代码变得臃肿，反而不利于理解和维护。</li>
<li>状态切换逻辑复杂：在对象中需要正确处理状态之间的切换逻辑，确保在合适的时机切换到正确的状态类。如果状态切换逻辑处理不当，可能会导致程序出现错误的行为或进入不合理的状态，这需要仔细设计和测试状态切换的条件和流程。</li>
</ul>
<p>该模式遵循以下设计原则：</p>
<ul>
<li>单一职责原则（SRP）：状态模式将与特定状态相关的行为局部化到一个状态中，并且将不同状态的行为分割开来，满足单一职责原则</li>
</ul>
<p>如下的代码示例中，上下文对象<code>Context</code>的行为依赖于不同的<code>State</code>对象：</p>
<div class="tabs" id="状态模式"><ul class="nav-tabs"><li class="tab active"><a href="#状态模式-1">Rust</a></li><li class="tab"><a href="#状态模式-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="状态模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象状态接口，定义了不同状态下共有的方法</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle</span>(&amp;<span class="keyword">self</span>, context: &amp;Context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文对象，用于持有当前状态并执行状态相关操作</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Context</span> &#123;</span><br><span class="line">    state: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> State&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Context</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(initial_state: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> State&gt;) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        Context &#123; state: initial_state &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">set_state</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, new_state: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> State&gt;) &#123;</span><br><span class="line">        <span class="keyword">self</span>.state = new_state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">request</span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.state.<span class="title function_ invoke__">handle</span>(<span class="keyword">self</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态类：红灯状态，以交通信号灯为例</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">RedLightState</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">State</span> <span class="keyword">for</span> <span class="title class_">RedLightState</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle</span>(&amp;<span class="keyword">self</span>, context: &amp;Context) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;红灯亮，禁止通行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态类：绿灯状态，以交通信号灯为例</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GreenLightState</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">State</span> <span class="keyword">for</span> <span class="title class_">GreenLightState</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle</span>(&amp;<span class="keyword">self</span>, context: &amp;Context) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;绿灯亮，允许通行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态类：黄灯状态，以交通信号灯为例</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">YellowLightState</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">State</span> <span class="keyword">for</span> <span class="title class_">YellowLightState</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle</span>(&amp;<span class="keyword">self</span>, context: &amp;Context) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;黄灯亮，警示通行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码，模拟交通信号灯状态变化</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">context</span> = Context::<span class="title function_ invoke__">new</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(RedLightState));</span><br><span class="line"></span><br><span class="line">    context.<span class="title function_ invoke__">request</span>();</span><br><span class="line"></span><br><span class="line">    context.<span class="title function_ invoke__">set_state</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(GreenLightState));</span><br><span class="line">    context.<span class="title function_ invoke__">request</span>();</span><br><span class="line"></span><br><span class="line">    context.<span class="title function_ invoke__">set_state</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(YellowLightState));</span><br><span class="line">    context.<span class="title function_ invoke__">request</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="状态模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象状态接口，定义了不同状态下共有的方法</span></span><br><span class="line"><span class="keyword">type</span> State <span class="keyword">interface</span> &#123;</span><br><span class="line">	Handle(context *Context)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文对象，用于持有当前状态并执行状态相关操作</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line">	State State</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span></span> New(initialState State) *Context &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;Context&#123;State: initialState&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span></span> SetState(newState State) &#123;</span><br><span class="line">	c.State = newState</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span></span> Request() &#123;</span><br><span class="line">	c.State.Handle(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态类：红灯状态，以交通信号灯为例</span></span><br><span class="line"><span class="keyword">type</span> RedLightState <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RedLightState)</span></span> Handle(context *Context) &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;红灯亮，禁止通行&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态类：绿灯状态，以交通信号灯为例</span></span><br><span class="line"><span class="keyword">type</span> GreenLightState <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *GreenLightState)</span></span> Handle(context *Context) &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;绿灯亮，允许通行&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态类：黄灯状态，以交通信号灯为例</span></span><br><span class="line"><span class="keyword">type</span> YellowLightState <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(y *YellowLightState)</span></span> Handle(context *Context) &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;黄灯亮，警示通行&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码，模拟交通信号灯状态变化</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	context := &amp;Context&#123;&#125;</span><br><span class="line">	context.SetState(&amp;RedLightState&#123;&#125;)</span><br><span class="line"></span><br><span class="line">	context.Request()</span><br><span class="line"></span><br><span class="line">	context.SetState(&amp;GreenLightState&#123;&#125;)</span><br><span class="line">	context.Request()</span><br><span class="line"></span><br><span class="line">	context.SetState(&amp;YellowLightState&#123;&#125;)</span><br><span class="line">	context.Request()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="策略模式"><a class="markdownIt-Anchor" href="#策略模式"></a> 策略模式</h4>
<p>策略模式<span style="color:red"><strong>从实现的形式上来看和状态模式很像，都会在对象的上下文对象内部保存一个和其行为有关的状态或者策略类，不同的是它们的应用场景，策略模式用于和策略有关的场景而已，它定义了一系列可互换的算法或策略，并将每个策略封装成独立的类，使得它们可以在运行时根据需要进行替换，从而让对象的行为能够根据所选择的策略而改变</strong></span>。</p>
<p>该模式具有以下应用场景：</p>
<ul>
<li>电商促销活动：在电商平台中，经常会有各种促销活动，如满减、折扣、赠品等不同的优惠策略。可以将每种优惠策略封装成一个独立的类，订单结算系统根据当前的促销活动选择相应的策略类来计算订单的最终价格。例如，在 “双十一” 活动期间可能采用满减策略，而在店庆活动时可能采用折扣策略，通过切换策略类就能轻松实现不同促销活动下的价格计算。</li>
<li>文件加密与解密：对于文件的加密和解密操作，存在多种加密算法，如 AES、DES、RSA 等。将每种加密算法封装成一个独立的策略类，文件处理程序在需要加密或解密文件时，根据用户的选择或文件的安全级别等因素，选用合适的策略类来执行相应的操作，这样可以方便地替换加密算法而不影响文件处理程序的其他部分。</li>
<li>游戏角色移动方式：在游戏中，角色的移动方式有多种，比如步行、跑步、跳跃、飞行等不同的策略。可以把每种移动方式都封装成一个独立的策略类，游戏角色对象根据游戏场景、角色状态（如是否拥有飞行道具等）等因素，选择合适的策略类来实现其移动行为，当角色获得新的能力或处于不同场景时，能够灵活切换移动策略。</li>
</ul>
<p>该模式具有以下的特点：</p>
<ul>
<li>算法封装与独立性：将不同的算法或策略封装成独立的类，每个策略类负责实现特定的算法逻辑，使得算法相关的代码更加清晰、易于理解和维护。不同策略类之间相互独立，修改一个策略类的算法不会影响到其他策略类。</li>
<li>可替换性与灵活性：在运行时可以根据具体需求灵活地替换策略类，从而改变对象的行为方式。这使得系统能够快速适应不同的业务场景或用户需求，无需对大量代码进行修改，只需切换所采用的策略即可。</li>
<li>易于扩展新策略：当需要添加新的策略及其相关算法时，只需创建一个新的策略类并实现相应的接口或继承相关的抽象类，然后在需要使用策略的地方添加逻辑以选择这个新策略即可。对现有代码的改动较小，符合开闭原则，便于系统的扩展。</li>
</ul>
<p>该模式具有以下缺点：</p>
<ul>
<li>类数量增加：随着策略数量的增加，需要创建相应数量的策略类，可能导致类的数量过多，增加了代码的复杂性和维护成本。尤其是在一些简单的场景中，如果过度使用策略模式，可能会使代码变得臃肿，反而不利于理解和维护。</li>
<li>策略选择逻辑复杂：在使用策略模式的地方，需要正确处理策略的选择逻辑，确保在合适的时机选择正确的策略类。如果策略选择逻辑处理不当，可能会导致程序出现错误的行为或选择了不合适的策略，这需要仔细设计和测试策略选择的条件和流程。</li>
</ul>
<p>该模式遵循以下设计原则：</p>
<ul>
<li>开闭原则（OCP）：策略模式提供了对开闭原则的支持，可以在不修改原有系统的基础上，选择不同的行为，也可以额外扩展其他行为。</li>
<li>单一职责原则（SRP）：每个策略类只负责一个算法的实现，符合单一职责原则</li>
</ul>
<p>如下是策略模式的UML类图：<br />
<img data-src="//www.plantuml.com/plantuml/png/SoWkIImgAStDuL9NUBvsslEfIv_rBNtQlvWhCwyajIWjCJbL8RYaAB4aDRrIePfB0GXIArAJIqjIDH9pyqlpIgmKqinCDBbgWTgVxLxujBqVOiZpZRkvadCIYuiLt4fpSe9IKqgJIpBpyz2CqYx9A4ejpiZFIG4R0n4hWYb64YFHJfVCucIGGdJhKg3YyI1XOen_igFhoOxkPzFQ4MOxvmC3fg84PcGnr0ehU311nFDIopKmvJGLh606eDWS3rEAxWIW6vwsRdw-UJSNrd3KqwknWniEDFlfkddF-pPmmVnFG1dCAxgwoB8W2ryqJdc_fmFPzoyRPhtOtuxkt6VJTZxRFFN9ZZv83C1qTd8vfEQb01CL0000" alt="链接" /></p>
<div class="tabs" id="策略模式"><ul class="nav-tabs"><li class="tab active"><a href="#策略模式-1">Rust</a></li><li class="tab"><a href="#策略模式-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="策略模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 策略接口，定义了执行策略的方法</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Strategy</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">execute</span>(&amp;<span class="keyword">self</span>, amount: <span class="type">f64</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 满减策略类</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FullReductionStrategy</span> &#123;</span><br><span class="line">    threshold: <span class="type">f64</span>,</span><br><span class="line">    reduction: <span class="type">f64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Strategy</span> <span class="keyword">for</span> <span class="title class_">FullReductionStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">execute</span>(&amp;<span class="keyword">self</span>, amount: <span class="type">f64</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> amount &gt;= <span class="keyword">self</span>.threshold &#123;</span><br><span class="line">            amount - <span class="keyword">self</span>.reduction</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            amount</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 折扣策略类</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">DiscountStrategy</span> &#123;</span><br><span class="line">    discount_rate: <span class="type">f64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Strategy</span> <span class="keyword">for</span> <span class="title class_">DiscountStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">execute</span>(&amp;<span class="keyword">self</span>, amount: <span class="type">f64</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">        amount * (<span class="number">1.0</span> - <span class="keyword">self</span>.discount_rate)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用策略的上下文类</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Context</span> &#123;</span><br><span class="line">    strategy: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Strategy&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Context</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">new</span>(strategy: <span class="type">Box</span>&lt;<span class="keyword">dyn</span> Strategy&gt;) <span class="punctuation">-&gt;</span> <span class="keyword">Self</span> &#123;</span><br><span class="line">        Context &#123; strategy: strategy &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">execute_strategy</span>(&amp;<span class="keyword">self</span>, amount: <span class="type">f64</span>) <span class="punctuation">-&gt;</span> <span class="type">f64</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.strategy.<span class="title function_ invoke__">execute</span>(amount)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码，模拟电商促销活动中的价格计算</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">amount</span> = <span class="number">100.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用满减策略</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">full_reduction_strategy</span> = FullReductionStrategy &#123;</span><br><span class="line">        threshold: <span class="number">80.0</span>,</span><br><span class="line">        reduction: <span class="number">20.0</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">context</span> = Context::<span class="title function_ invoke__">new</span>(<span class="type">Box</span>::<span class="title function_ invoke__">new</span>(full_reduction_strategy));</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">final_amount</span> = context.<span class="title function_ invoke__">execute_strategy</span>(amount);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;使用满减策略后的价格: &#123;&#125;&quot;</span>, final_amount);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用折扣策略</span></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">discount_strategy</span> = DiscountStrategy &#123;</span><br><span class="line">        discount_rate: <span class="number">0.2</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    context.strategy = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(discount_strategy);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">final_amount</span> = context.<span class="title function_ invoke__">execute_strategy</span>(amount);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;使用折扣策略后的价格: &#123;&#125;&quot;</span>, final_amount);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="策略模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 策略接口，定义了执行策略的方法</span></span><br><span class="line"><span class="keyword">type</span> Strategy <span class="keyword">interface</span> &#123;</span><br><span class="line">    Execute(amount <span class="type">float64</span>) <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 满减策略类</span></span><br><span class="line"><span class="keyword">type</span> FullReductionStrategy <span class="keyword">struct</span> &#123;</span><br><span class="line">    Threshold <span class="type">float64</span></span><br><span class="line">    Reduction <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *FullReductionStrategy)</span></span> Execute(amount <span class="type">float64</span>) <span class="type">float64</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> amount &gt;= f.Threshold &#123;</span><br><span class="line">        <span class="keyword">return</span> amount - f.Reduction</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> amount</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 折扣策略类</span></span><br><span class="line"><span class="keyword">type</span> DiscountStrategy <span class="keyword">struct</span> &#123;</span><br><span class="line">    DiscountRate <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *DiscountStrategy)</span></span> Execute(amount <span class="type">float64</span>) <span class="type">float64</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> amount * (<span class="number">1.0</span> - d.DiscountRate)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用策略的上下文类</span></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line">    Strategy Strategy</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span></span> New(Strategy Strategy) *Context &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;Context&#123;Strategy: Strategy&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Context)</span></span> ExecuteStrategy(amount <span class="type">float64</span>) <span class="type">float64</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> c.Strategy.Execute(amount)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码，模拟电商促销活动中的价格计算</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    amount := <span class="number">100.0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用满减策略</span></span><br><span class="line">    fullReductionStrategy := &amp;FullReductionStrategy&#123;</span><br><span class="line">        Threshold: <span class="number">80.0</span>,</span><br><span class="line">        Reduction: <span class="number">20.0</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    context := &amp;Context&#123;Strategy: fullReductionStrategy&#125;</span><br><span class="line">    finalAmount := context.ExecuteStrategy(amount)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;使用满减策略后的价格: %f\n&quot;</span>, finalAmount)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用折扣策略</span></span><br><span class="line">    discountStrategy := &amp;DiscountStrategy&#123;</span><br><span class="line">        DiscountRate: <span class="number">0.2</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    context.Strategy = discountStrategy</span><br><span class="line">    finalAmount = context.ExecuteStrategy(amount)</span><br><span class="line">    fmt.Printf(<span class="string">&quot;使用折扣策略后的暗码: %f\n&quot;</span>, finalAmount)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="模板方法"><a class="markdownIt-Anchor" href="#模板方法"></a> 模板方法</h4>
<p>模板方法<span style="color:red"><strong>在一个抽象类中定义了一个算法或者对象行为的的骨架（即模板方法），这个模板方法包含了一系列的步骤，其中一些步骤的具体实现被延迟到子类中。通过这种方式，子类可以在不改变算法整体结构的情况下，重新定义某些特定步骤的实现，从而实现不同的行为</strong></span>。</p>
<p>该模式具有以下应用场景：</p>
<ul>
<li>数据访问层操作：在数据库应用中，对于不同类型的数据实体（如用户、订单、产品等），数据访问层通常需要执行一些通用的操作，比如连接数据库、执行查询语句、处理查询结果、关闭数据库连接等。可以使用模板方法模式，在一个抽象的数据访问类中定义这些通用操作的模板方法，将如构建具体查询语句、处理不同类型结果集等特定步骤的实现留给具体的数据访问子类（如用户数据访问类、订单数据访问类等），这样既能保证数据访问操作的整体流程一致，又能根据不同的数据实体进行个性化的处理。</li>
<li>文件处理流程：当处理不同类型的文件（如文本文件、图像文件、音频文件等）时，可能存在一些通用的处理步骤，比如打开文件、读取文件内容、进行某种处理（如对文本文件进行文本解析，对图像文件进行图像处理等）、写入处理结果（如果需要）、关闭文件等。通过模板方法模式，在一个抽象的文件处理类中定义这个通用的文件处理流程模板方法，而将针对不同文件类型的具体处理步骤（如文本解析算法、图像处理算法等）放到具体的文件处理子类（如文本文件处理类、图像文件处理类等）中实现，以适应不同文件类型的处理需求。</li>
<li>游戏角色创建流程：在游戏开发中，创建不同类型的游戏角色（如战士、法师、刺客等）通常会遵循一些通用的步骤，比如分配基础属性（生命值、攻击力、防御力等）、设置角色外观、赋予初始技能等。可以利用模板方法模式，在一个抽象的角色创建类中定义这个创建角色的通用流程模板方法，将如根据不同角色类型分配特定属性值、设置特定外观、赋予特定初始技能等步骤的实现留给具体的角色创建子类（如战士角色创建类、法师角色创建类等），这样可以在保证角色创建整体流程规范的同时，实现不同角色类型的差异化创建。</li>
</ul>
<p>该模式具有以下特点：</p>
<ul>
<li>算法框架定义：在抽象类中清晰地定义了算法的整体框架（模板方法），明确了一系列的步骤顺序，使得整个算法的流程结构一目了然，便于理解和维护。不同的子类遵循这个统一的框架进行实现，保证了算法执行的一致性和规范性。</li>
<li>步骤实现延迟到子类：将算法中的某些特定步骤的具体实现延迟到子类中，使得子类可以根据自身的需求和特点灵活地重新定义这些步骤的实现方式，从而实现不同的行为效果。这种方式既保证了整体算法的通用性，又兼顾了子类的个性化需求。</li>
<li>代码复用与可扩展性：通过在抽象类中定义通用的模板方法和部分通用步骤的实现，实现了代码的复用，减少了代码的冗余。同时，当需要添加新的子类来实现不同的行为时，只需按照模板方法的框架，在新子类中实现特定步骤的新实现即可，很容易实现系统的扩展。</li>
</ul>
<p>该模式具有以下缺点：</p>
<ul>
<li>子类实现约束：子类必须遵循抽象类中定义的模板方法的步骤顺序和框架，如果子类需要对模板方法进行较大幅度的修改或不按照规定的步骤顺序实现，可能会导致代码的逻辑混乱，破坏整个算法的正常运行。因此，子类的实现相对受到一定的约束，灵活性有限。</li>
<li>抽象类理解难度：对于初学者或不熟悉模板方法模式的开发人员来说，理解抽象类中定义的模板方法以及其中各个步骤的含义和作用可能会有一定的难度，尤其是当模板方法包含较多的步骤和复杂的逻辑时，这可能会增加代码的理解成本。</li>
</ul>
<p>该模式遵循以下设计原则：</p>
<ul>
<li>单一职责原则（SRP）：模板方法模式将算法的框架和步骤的具体实现分离，符合单一职责原则。</li>
<li>开闭原则（OCP）：模板方法模式允许对算法的扩展开放，对修改关闭，可以通过添加新的子类来扩展算法的行为。</li>
</ul>
<p>如下的实现中，抽象类（Rust中用Trait，<code>FileProcessor</code>）中定义了处理文件的基本流程（即模板），打开文件然后处理文件内容，只是不同文件的处理方式不同，可以在子类中处理：</p>
<p><img data-src="//www.plantuml.com/plantuml/png/SoWkIImgAStDuL9NUDQrzyN6XSytxdw_f-DPtzAd_OkVxbtqT4__axsJd_TjUB-daoiphoIrA2qnELN1BJCdDQ0eFpcrk3Y_IA6QIm482Y3y-3IWd0Q8Y2z8BCcmKYWkAT84AyWlICt3BPkSar-SYf2s0ji1aSf8p4l9WSZ59-S37P5NWgAc5kZwfwtRGGwTrV9iMlkpEMk0v9FTsvukQNa-eGte9QxadCJYOeMGr8eIR4xN9kXsRVoEryRZUcsIdFzqzhwdpVtOdU-PcvYUEXZT3_R0vkURTtDXXB2UNeqTMdAnKdYwRXumIN61_KEqQeVKl1HWIWK0" alt="链接" /></p>
<div class="tabs" id="模板方法"><ul class="nav-tabs"><li class="tab active"><a href="#模板方法-1">Rust</a></li><li class="tab"><a href="#模板方法-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="模板方法-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::cell::RefCell;</span><br><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> std::io;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象类，定义模板方法及部分通用步骤</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">FileProcessor</span> &#123;</span><br><span class="line">    <span class="comment">// 模板方法，定义文件处理的通用流程</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">process_file</span>(&amp;<span class="keyword">self</span>, file_path: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> io::<span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">file_result</span> = <span class="keyword">self</span>.<span class="title function_ invoke__">open_file</span>(file_path)?;</span><br><span class="line">        <span class="keyword">self</span>.<span class="title function_ invoke__">handle_file_content</span>(file_result)?;</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通用步骤：打开文件</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">open_file</span>(&amp;<span class="keyword">self</span>, file_path: &amp;<span class="type">str</span>) <span class="punctuation">-&gt;</span> io::<span class="type">Result</span>&lt;RefCell&lt;File&gt;&gt; &#123;</span><br><span class="line">        <span class="keyword">match</span> File::<span class="title function_ invoke__">open</span>(file_path) &#123;</span><br><span class="line">            <span class="title function_ invoke__">Ok</span>(f) =&gt; <span class="title function_ invoke__">Ok</span>(RefCell::<span class="title function_ invoke__">new</span>(f)),</span><br><span class="line">            <span class="title function_ invoke__">Err</span>(e) =&gt; <span class="title function_ invoke__">Err</span>(e),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 抽象步骤：处理文件内容，具体实现留给子类</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle_file_content</span>(&amp;<span class="keyword">self</span>, file: RefCell&lt;File&gt;) <span class="punctuation">-&gt;</span> io::<span class="type">Result</span>&lt;()&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的文本文件处理类</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TextFileProcessor</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">FileProcessor</span> <span class="keyword">for</span> <span class="title class_">TextFileProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle_file_content</span>(&amp;<span class="keyword">self</span>, file: RefCell&lt;File&gt;) <span class="punctuation">-&gt;</span> io::<span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">        <span class="comment">// 这里可以实现具体的文本解析等操作</span></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;正在处理文本文件内容&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的图像文件处理类</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ImageFileProcessor</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">FileProcessor</span> <span class="keyword">for</span> <span class="title class_">ImageFileProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">handle_file_content</span>(&amp;<span class="keyword">self</span>, file: RefCell&lt;File&gt;) <span class="punctuation">-&gt;</span> io::<span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">        <span class="comment">// 这里可以实现具体的图像处理等操作</span></span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;正在处理图像文件内容&quot;</span>);</span><br><span class="line">        <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() <span class="punctuation">-&gt;</span> io::<span class="type">Result</span>&lt;()&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">text_file_processor</span> = TextFileProcessor &#123;&#125;;</span><br><span class="line">    text_file_processor.<span class="title function_ invoke__">process_file</span>(<span class="string">&quot;bin/state.rs&quot;</span>)?;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">image_file_processor</span> = ImageFileProcessor &#123;&#125;;</span><br><span class="line">    image_file_processor.<span class="title function_ invoke__">process_file</span>(<span class="string">&quot;bin/mediator.rs&quot;</span>)?;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="模板方法-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象类，定义模板方法及部分通用步骤</span></span><br><span class="line"><span class="keyword">type</span> FileProcessor <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// 模板方法，定义文件处理的通用流程</span></span><br><span class="line">	ProcessFile(filePath <span class="type">string</span>)</span><br><span class="line">	<span class="comment">// 通用步骤：打开文件</span></span><br><span class="line">	OpenFile(filePath <span class="type">string</span>) (*os.File, <span class="type">error</span>)</span><br><span class="line">	<span class="comment">// 通用步骤：关闭文件</span></span><br><span class="line">	CloseFile(file *os.File) <span class="type">error</span></span><br><span class="line">	<span class="comment">// 抽象步骤：处理文件内容，具体实现留给子类</span></span><br><span class="line">	HandleFileContent(file *os.File) <span class="type">error</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的文本文件处理类</span></span><br><span class="line"><span class="keyword">type</span> TextFileProcessor <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *TextFileProcessor)</span></span> ProcessFile(filePath <span class="type">string</span>) &#123;</span><br><span class="line">	file, err := t.OpenFile(filePath)</span><br><span class="line">	<span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err := t.HandleFileContent(file); err == <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> err := t.CloseFile(file); err == <span class="literal">nil</span> &#123;</span><br><span class="line">				fmt.Println(<span class="string">&quot;文本文件处理成功&quot;</span>)</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				fmt.Println(<span class="string">&quot;关闭文本文件失败&quot;</span>)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;处理文本文件内容失败&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;打开文本文件失败&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *TextFileProcessor)</span></span> OpenFile(filePath <span class="type">string</span>) (*os.File, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> os.Open(filePath)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *TextFileProcessor)</span></span> CloseFile(file *os.File) <span class="type">error</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> file.Close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *TextFileProcessor)</span></span> HandleFileContent(file *os.File) <span class="type">error</span> &#123;</span><br><span class="line">	<span class="comment">// 这里可以实现具体的文本解析等操作</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;正在处理文本文件内容&quot;</span>)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的图像文件处理类</span></span><br><span class="line"><span class="keyword">type</span> ImageFileProcessor <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *ImageFileProcessor)</span></span> ProcessFile(filePath <span class="type">string</span>) &#123;</span><br><span class="line">	file, err := i.OpenFile(filePath)</span><br><span class="line">	<span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> err := i.HandleFileContent(file); err == <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> err := i.CloseFile(file); err == <span class="literal">nil</span> &#123;</span><br><span class="line">				fmt.Println(<span class="string">&quot;文本文件处理成功&quot;</span>)</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				fmt.Println(<span class="string">&quot;关闭图像文件失败&quot;</span>)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">&quot;处理图像文件内容失败&quot;</span>)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;打开图像文件失败&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *ImageFileProcessor)</span></span> OpenFile(filePath <span class="type">string</span>) (*os.File, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> os.Open(filePath)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *ImageFileProcessor)</span></span> CloseFile(file *os.File) <span class="type">error</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> file.Close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i *ImageFileProcessor)</span></span> HandleFileContent(file *os.File) <span class="type">error</span> &#123;</span><br><span class="line">	<span class="comment">// 这里可以实现具体的图像处理等操作</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;正在处理图像文件内容&quot;</span>)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	textFileProcessor := &amp;TextFileProcessor&#123;&#125;</span><br><span class="line">	textFileProcessor.ProcessFile(<span class="string">&quot;test.txt&quot;</span>)</span><br><span class="line"></span><br><span class="line">	imageFileProcessor := &amp;ImageFileProcessor&#123;&#125;</span><br><span class="line">	imageFileProcessor.ProcessFile(<span class="string">&quot;test.jpg&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
<h4 id="访问者模式"><a class="markdownIt-Anchor" href="#访问者模式"></a> 访问者模式</h4>
<p>访问者模式<span style="color:red"><strong>核心是将数据结构与作用于该数据结构上的操作分离开来，通过定义一个访问者接口，其中包含了对不同类型元素进行访问操作的方法，然后让具体的访问者类实现这些方法来执行特定的操作。而数据结构中的元素则提供一个接受访问者的接口，使得访问者可以遍历数据结构并对其中的元素执行相应操作。就像小米粥和馒头都可以被人吃，但是吃法不一样，所以可以将小米粥和馒头抽象出来形成一个Food抽象对象，把吃法形成一个新的接口Visitor，Food中包含一个方法accepct，这个方法会传入一个Visitor对象的实例，而Visitor中会实现喝小米粥和吃馒头这两个方法，在具体的食物类中进行调用</strong></span>。</p>
<p>该模式具有以下应用场景：</p>
<ul>
<li>编译器的语法分析：在编译器设计中，需要对抽象语法树（AST）进行遍历并执行各种操作，如语义检查、代码生成等。抽象语法树由不同类型的节点（如表达式节点、语句节点等）组成，形成了一种复杂的数据结构。使用访问者模式，可以定义一个访问者接口，包含针对不同类型节点进行语义检查和代码生成等操作的方法。然后创建具体的访问者类（如语义检查访问者、代码生成访问者等）来实现这些方法，通过让抽象语法树的节点接受这些访问者并遍历自身，实现对整个抽象语法树的相应操作，这样可以将不同的分析和处理逻辑与抽象语法树的结构清晰地分离开来。</li>
<li>图形绘制系统中的图形操作：在图形绘制系统中，存在多种不同类型的图形（如圆形、矩形、三角形等），这些图形组成了一个图形数据结构。当需要对这些图形进行不同的操作，如计算图形面积、绘制图形轮廓、填充图形颜色等时，可以采用访问者模式。定义一个访问者接口，其中有针对不同图形类型进行上述操作的方法。然后创建具体的访问者类（如面积计算访问者、轮廓绘制访问者、颜色填充访问者等）来实现这些方法，让图形对象接受访问者并允许访问者遍历图形数据结构中的各个图形，从而实现对不同图形的相应操作，将操作逻辑与图形数据结构分离开来。</li>
<li>员工组织结构中的数据统计与分析：在企业的员工组织结构中，存在不同层级的部门和员工，形成了一个树形的数据结构。当需要对这个组织结构进行各种统计和分析操作，如计算部门员工总数、统计各部门平均薪资、查找特定技能员工等时，可以运用访问者模式。定义一个访问者接口，包含针对部门和员工进行上述各种统计和分析操作的方法。接着创建具体的访问者类（如员工总数统计访问者、平均薪资统计访问者、特定技能员工查找访问者等）来实现这些方法，让部门和员工对象接受访问者并支持访问者遍历整个组织结构，以便实现对组织结构数据的相应操作，将统计分析逻辑与组织结构数据结构相分离。</li>
</ul>
<p>该模式具有以下特点：</p>
<ul>
<li>数据结构与操作分离：将对数据结构中元素的操作逻辑从数据结构本身中分离出来，通过定义访问者接口和具体访问者类来实现特定的操作，使得数据结构的定义更加纯粹，专注于存储和组织数据，而操作逻辑则可以独立地进行扩展和修改，互不影响。</li>
<li>可扩展性：当需要添加新的操作类型时，只需创建一个新的访问者类并实现访问者接口中的相应方法即可，无需对现有的数据结构及其元素类进行大规模的修改。同样，当数据结构中新增元素类型时，只需在现有访问者接口中添加针对新元素类型的访问方法，并在相应的具体访问者类中实现这些方法，也能轻松应对，便于系统的扩展。</li>
<li>多态性体现：访问者模式充分利用了多态性，通过让数据结构中的元素接受访问者并调用访问者的相应方法，根据访问者的具体类型执行不同的操作，实现了同一数据结构可以被不同访问者以不同方式处理的效果，增强了代码的灵活性和复用性。</li>
</ul>
<p>该模式具有以下缺点：</p>
<ul>
<li>违反封装原则风险：在访问者模式中，数据结构中的元素需要向访问者暴露自身的一些内部信息，以便访问者能够进行相应的操作。这可能会在一定程度上违反对象的封装原则，如果处理不当，可能会导致数据结构的稳定性和安全性受到影响，例如外部访问者可能会错误地修改数据结构中的关键信息。</li>
<li>增加复杂性：由于引入了访问者接口、具体访问者类以及数据结构元素接受访问者的相关机制，使得代码的整体结构变得更加复杂，尤其是对于初学者或不熟悉该模式的开发人员来说，理解和维护起来可能会有一定的难度，增加了代码的理解成本。</li>
<li>访问者与元素耦合度：虽然数据结构与操作在一定程度上实现了分离，但具体的访问者类与数据结构中的元素类之间存在一定的耦合度。当数据结构或访问者发生较大变化时，可能需要同时对另一方进行相应的修改，例如当数据结构中的元素类型发生重大改变时，可能需要修改多个访问者类中的相关方法，反之亦然。</li>
</ul>
<p>该模式遵循以下设计原则：</p>
<ul>
<li>开闭原则（OCP）：访问者模式支持对扩展开放，可以添加新的访问者而不需要修改对象结构。</li>
<li>单一职责原则（SRP）：每个访问者应该只有一个职责，即一个访问者类对应一个操作。</li>
</ul>
<p>以下是访问者设计模式的类图示例：</p>
<p><img data-src="//www.plantuml.com/plantuml/png/fPFDJkf07CNtVOhPNMuQMDtSHHS6unkeSKl6Cj19oaUc0oxKX0qgBZ3H20cA1emXRgg463Lyy3BqWnMlOELF9zMWWhAPF_nFVkSCFOqQ73EUI-dI7-IQmt7LT0j5ktnhdTn8DCq9Is2Le2rgK9vXQ5T2tYV_zYscKgRg90I7WjQcvz-0W16LutJIquX9GUl-65HoHa7e3mhQXCcJxNl9h8k1rM_QntsttN3QtK2o3GrdoImNLbMIvQ4yX5Nyr3D4yMdKFmEGXvZqQjRbWJTBgeuD0-Bx89dXECqP2ahy_mS_B8bshky4MbnPq7Ted6i1k4PeKkC_TnizbzpMgJ0K_vtljuqDyaixKGrm7DURJklUDHkEMHMhcVig8_XzNsIUuLYFOMyHSFssHVBYDP8Nwj7qDXsdqvK26IEHlHNHRmLPvfLJVf0WntG73HCRuJnl2MxpTu14uN3GRZIeku-LIUy8oZWkrDpX8JmFk_9YTyv1yE7DdFHA8iUdHEZWuaG8_mKGQhOSCqhIyLnAVmK0" alt="链接" /></p>
<div class="tabs" id="访问者模式"><ul class="nav-tabs"><li class="tab active"><a href="#访问者模式-1">Rust</a></li><li class="tab"><a href="#访问者模式-2">Go</a></li></ul><div class="tab-content"><div class="tab-pane active" id="访问者模式-1"><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 访问者接口，定义了对不同类型元素进行访问操作的方法</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">visit_circle</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, circle: &amp;Circle);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">visit_rectangle</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, rectangle: &amp;Rectangle);</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">visit_triangle</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, triangle: &amp;Triangle);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图形抽象类，提供接受访问者的接口</span></span><br><span class="line"><span class="keyword">trait</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">accept</span>(&amp;<span class="keyword">self</span>, visitor: &amp;<span class="keyword">mut</span> <span class="keyword">dyn</span> Visitor);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体图形类：圆形</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    radius: <span class="type">f64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Shape</span> <span class="keyword">for</span> <span class="title class_">Circle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">accept</span>(&amp;<span class="keyword">self</span>, visitor: &amp;<span class="keyword">mut</span> <span class="keyword">dyn</span> Visitor) &#123;</span><br><span class="line">        visitor.<span class="title function_ invoke__">visit_circle</span>(<span class="keyword">self</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体图形类：矩形</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    width: <span class="type">f64</span>,</span><br><span class="line">    height: <span class="type">f64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Shape</span> <span class="keyword">for</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">accept</span>(&amp;<span class="keyword">self</span>, visitor: &amp;<span class="keyword">mut</span> <span class="keyword">dyn</span> Visitor) &#123;</span><br><span class="line">        visitor.<span class="title function_ invoke__">visit_rectangle</span>(<span class="keyword">self</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体图形类：三角形</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Triangle</span> &#123;</span><br><span class="line">    base: <span class="type">f64</span>,</span><br><span class="line">    height: <span class="type">f64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Shape</span> <span class="keyword">for</span> <span class="title class_">Triangle</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">accept</span>(&amp;<span class="keyword">self</span>, visitor: &amp;<span class="keyword">mut</span> <span class="keyword">dyn</span> Visitor) &#123;</span><br><span class="line">        visitor.<span class="title function_ invoke__">visit_triangle</span>(<span class="keyword">self</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体访问者类：面积计算访问者</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">AreaVisitor</span> &#123;</span><br><span class="line">    total_area: <span class="type">f64</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">Visitor</span> <span class="keyword">for</span> <span class="title class_">AreaVisitor</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">visit_circle</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, circle: &amp;Circle) &#123;</span><br><span class="line">        <span class="keyword">self</span>.total_area += std::<span class="type">f64</span>::consts::PI * circle.radius * circle.radius;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">visit_rectangle</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, rectangle: &amp;Rectangle) &#123;</span><br><span class="line">        <span class="keyword">self</span>.total_area += rectangle.width * rectangle.height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">visit_triangle</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, triangle: &amp;Triangle) &#123;</span><br><span class="line">        <span class="keyword">self</span>.total_area += <span class="number">0.5</span> * triangle.base * triangle.height;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">circle</span> = Circle &#123; radius: <span class="number">2.0</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">rectangle</span> = Rectangle &#123; width: <span class="number">3.0</span>, height: <span class="number">4.0</span> &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">triangle</span> = Triangle &#123; base: <span class="number">5.0</span>, height: <span class="number">6.0</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">area_visitor</span> = AreaVisitor &#123; total_area: <span class="number">0.0</span> &#125;;</span><br><span class="line"></span><br><span class="line">    circle.<span class="title function_ invoke__">accept</span>(&amp;<span class="keyword">mut</span> area_visitor);</span><br><span class="line">    rectangle.<span class="title function_ invoke__">accept</span>(&amp;<span class="keyword">mut</span> area_visitor);</span><br><span class="line">    triangle.<span class="title function_ invoke__">accept</span>(&amp;<span class="keyword">mut</span> area_visitor);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;总面积: &#123;&#125;&quot;</span>, area_visitor.total_area);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="访问者模式-2"><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问者接口，定义了对不同类型元素进行访问操作的方法</span></span><br><span class="line"><span class="keyword">type</span> Visitor <span class="keyword">interface</span> &#123;</span><br><span class="line">	VisitCircle(circle *Circle)</span><br><span class="line">	VisitRectangle(rectangle *Rectangle)</span><br><span class="line">	VisitTriangle(triangle *Triangle)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图形抽象类，提供接受访问者的接口</span></span><br><span class="line"><span class="keyword">type</span> Shape <span class="keyword">interface</span> &#123;</span><br><span class="line">	Accept(visitor Visitor)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体图形类：圆形</span></span><br><span class="line"><span class="keyword">type</span> Circle <span class="keyword">struct</span> &#123;</span><br><span class="line">	Radius <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Circle)</span></span> Accept(visitor Visitor) &#123;</span><br><span class="line">	visitor.VisitCircle(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体图形类：矩形</span></span><br><span class="line"><span class="keyword">type</span> Rectangle <span class="keyword">struct</span> &#123;</span><br><span class="line">	Width  <span class="type">float64</span></span><br><span class="line">	Height <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Rectangle)</span></span> Accept(visitor Visitor) &#123;</span><br><span class="line">	visitor.VisitRectangle(r)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体图形类：三角形</span></span><br><span class="line"><span class="keyword">type</span> Triangle <span class="keyword">struct</span> &#123;</span><br><span class="line">	Base   <span class="type">float64</span></span><br><span class="line">	Height <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *Triangle)</span></span> Accept(visitor Visitor) &#123;</span><br><span class="line">	visitor.VisitTriangle(t)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体访问者类：面积计算访问者</span></span><br><span class="line"><span class="keyword">type</span> AreaVisitor <span class="keyword">struct</span> &#123;</span><br><span class="line">	TotalArea <span class="type">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *AreaVisitor)</span></span> VisitCircle(circle *Circle) &#123;</span><br><span class="line">	a.TotalArea += <span class="number">3.141592653589793</span> * circle.Radius * circle.Radius</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *AreaVisitor)</span></span> VisitRectangle(rectangle *Rectangle) &#123;</span><br><span class="line">	a.TotalArea += rectangle.Width * rectangle.Height</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *AreaVisitor)</span></span> VisitTriangle(triangle *Triangle) &#123;</span><br><span class="line">	a.TotalArea += <span class="number">0.5</span> * triangle.Base * triangle.Height</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	circle := &amp;Circle&#123;Radius: <span class="number">2.0</span>&#125;</span><br><span class="line">	rectangle := &amp;Rectangle&#123;Width: <span class="number">3.0</span>, Height: <span class="number">4.0</span>&#125;</span><br><span class="line">	triangle := &amp;Triangle&#123;Base: <span class="number">5.0</span>, Height: <span class="number">6.0</span>&#125;</span><br><span class="line"></span><br><span class="line">	areaVisitor := &amp;AreaVisitor&#123;TotalArea: <span class="number">0.0</span>&#125;</span><br><span class="line"></span><br><span class="line">	circle.Accept(areaVisitor)</span><br><span class="line">	rectangle.Accept(areaVisitor)</span><br><span class="line">	triangle.Accept(areaVisitor)</span><br><span class="line"></span><br><span class="line">	fmt.Printf(<span class="string">&quot;总面积: %f\n&quot;</span>, areaVisitor.TotalArea)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div></div>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.jpeg" alt="MichaelFu 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/alipay.jpeg" alt="MichaelFu 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>MichaelFu
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://blog.fudenglong.site/2024/11/19/Design-Patterns/example-design-patterns/" title="设计模式及其示例">https://blog.fudenglong.site/2024/11/19/Design-Patterns/example-design-patterns/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" rel="tag"># 设计模式</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/03/14/eBPF/common-tools-install/" rel="prev" title="常用的eBPF工具安装及简单介绍">
                  <i class="fa fa-angle-left"></i> 常用的eBPF工具安装及简单介绍
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/07/19/K8S/mysql-deploy/" rel="next" title="K8S集群中部署MySQL">
                  K8S集群中部署MySQL <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">辽ICP备15012817号-2 </a>
  </div>
  <div class="copyright">
    &copy; 2020 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">MichaelFu</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">1.4m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">21:31</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/gamelife1314" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/comments.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/utils.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/motion.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/sidebar.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/next-boot.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/bookmark.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/pjax.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/third-party/search/local-search.min.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.3.0/pdfobject.min.js"},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/third-party/tags/pdf.min.js"></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":"dark","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.min.js"}}</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/third-party/tags/mermaid.min.js"></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/third-party/fancybox.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/third-party/pace.min.js"></script>


  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">


  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":false,"delay":true,"timeout":5000,"priority":true,"url":"https://blog.fudenglong.site/2024/11/19/Design-Patterns/example-design-patterns/"}</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/third-party/quicklink.min.js"></script>
<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"gamelife1314/gamelife1314.github.io","issue_term":"title","theme":"github-light"}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.21.1/third-party/comments/utterances.min.js"></script>

</body>
</html>
